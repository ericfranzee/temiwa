"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8253],{91967:function(e,s,a){var t=a(3827);a(64090),s.Z=e=>(0,t.jsxs)("svg",{width:e.size||"20",height:e.size||"20",...e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("g",{clipPath:"url(#clip0_1_9251)",children:(0,t.jsx)("path",{d:"M9.66825 11.4667L10.8449 12.6434L17.8999 5.58838L19.0783 6.76671L10.8449 15L5.54159 9.69671L6.71992 8.51838L8.49075 10.2892L9.66825 11.4659V11.4667ZM9.66992 9.11004L13.7966 4.98254L14.9716 6.15754L10.8449 10.285L9.66992 9.11004ZM7.31409 13.8225L6.13659 15L0.833252 9.69671L2.01159 8.51838L3.18909 9.69588L3.18825 9.69671L7.31409 13.8225Z",fill:"currentColor"})}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_1_9251",children:(0,t.jsx)("rect",{width:"20",height:"20",fill:"white"})})})]})},58253:function(e,s,a){a.r(s),a.d(s,{default:function(){return $}});var t=a(3827),l=a(64090),i=a(58121),r=a(24499),d=a(34734),n=a(89539),c=a.n(n),o=a(91967),m=a(3014),x=a.n(m),h=a(70577),u=a(24228),g=a(32635),p=a(20703);let f=e=>{let{data:s,inProgress:a,onClear:l,isMine:i}=e,{t:r}=(0,g.$G)();return(0,t.jsxs)("div",{className:(0,d.Z)("flex items-center gap-2 w-full ",a?"mb-4":"mb-1"),children:[(0,t.jsx)("div",{className:(0,d.Z)("h-full w-0.5 rounded-full",i?"bg-white":"bg-blue-link","image"===s.type&&a&&"min-h-[80px]",("text"===s.type||void 0===s.type)&&a&&"min-h-[30px]",("text"===s.type||void 0===s.type)&&!a&&"min-h-[14px]","image"===s.type&&!a&&"min-h-[60px]")}),(0,t.jsxs)("div",{className:"flex items-center justify-between flex-1",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[a&&(0,t.jsx)("span",{className:"text-xs text-blue-link",children:r("replying.to")}),"image"===s.type?(0,t.jsx)(p.default,{src:s.message,alt:s.message,width:60,height:60,className:"max-h-[60px] object-contain"}):(0,t.jsx)("span",{className:"text-sm line-clamp-1",children:s.message})]}),!!l&&(0,t.jsx)(h.h,{onClick:l,children:(0,t.jsx)(u.Z,{size:20})})]})]})},v=e=>{let{data:s,userId:a,repliedMessage:l}=e;return(0,t.jsx)("div",{className:"flex flex-col space-y-2 text-xs max-w-xs mx-2 order-2 items-end",children:(0,t.jsxs)("div",{className:(0,d.Z)("pl-4 py-2 relative rounded-lg  text-base flex flex-col  ",a===s.senderId?"rounded-br-none bg-primary text-white pr-14":"rounded-bl-none bg-gray-card pr-12 dark:text-dark"),children:[l&&(0,t.jsx)(f,{data:l,inProgress:!1,isMine:s.senderId===a}),s.message,(0,t.jsxs)("div",{className:"flex items-center absolute bottom-1 right-1 gap-1",children:[(0,t.jsx)("span",{className:(0,d.Z)(a===s.senderId&&"text-white","text-xs"),children:c()(s.time).format("HH:mm")}),a===s.senderId&&(0,t.jsx)("div",{className:"text-white",children:s.read?(0,t.jsx)(o.Z,{size:12}):(0,t.jsx)(x(),{size:12})})]})]})})},j=e=>{let{data:s,userId:a,repliedMessage:l}=e;return(0,t.jsxs)("div",{className:"relative max-w-xs mx-2 order-2 ",children:[(0,t.jsxs)("div",{className:(0,d.Z)("p-1 relative rounded-lg  text-base flex flex-col ",a===s.senderId?"rounded-br-none bg-primary text-white ":"rounded-bl-none bg-gray-card"),children:[l&&(0,t.jsx)(f,{data:l,inProgress:!1,isMine:s.senderId===a}),(0,t.jsx)(p.default,{src:s.message,alt:s.message,height:200,width:200,className:"w-auto object-cover rounded-md "})]}),(0,t.jsxs)("div",{className:"flex items-center absolute bottom-1 right-2 gap-1",style:{textShadow:"1px 1px 2px black"},children:[(0,t.jsx)("span",{className:(0,d.Z)("text-xs drop-shadow-3xl text-white"),children:c()(s.time).format("HH:mm")}),a===s.senderId&&(0,t.jsx)("div",{className:"text-white",children:s.read?(0,t.jsx)(o.Z,{className:"checkIcon",size:12}):(0,t.jsx)(x(),{className:"checkIcon",size:12})})]})]})};var y=a(92708),b=a(3615);let w=e=>{let{icon:s,text:a,danger:l,onClick:i}=e;return(0,t.jsx)(y.v.Item,{children:e=>{let{active:r,close:n}=e;return(0,t.jsxs)("button",{onClick:()=>{i(),n()},className:(0,d.Z)("px-3 py-2 inline-flex items-center gap-5 hover:bg-gray-segment dark:hover:bg-gray-inputBorder",r&&"bg-gray-segment",l&&"text-red"),children:[s,a]})}})};var I=a(64164),N=a.n(I),k=a(38715),Z=a.n(k),L=a(77497),S=a(19009);let D=e=>{let{data:s,userId:a,onReply:n,onEdit:c,onDelete:o,chatId:m}=e,{t:x}=(0,g.$G)(),[h,u]=(0,l.useState)(null),p=()=>{n(s),c(null)},f=()=>{c(s),n(null)},I=async e=>{if(m){let s=(0,i.ad)(r.Z),a=(0,S.JU)(s,"chat",m,"message",e);await (0,i.QT)(a).then(e=>{let s=e.data();u({id:e.id,message:null==s?void 0:s.message,time:null==s?void 0:s.time,replyDocId:null==s?void 0:s.replyDocId,senderId:null==s?void 0:s.senderId,type:null==s?void 0:s.type,read:null==s?void 0:s.read,isLast:!1})})}};return(0,l.useEffect)(()=>{(null==s?void 0:s.replyDocId)&&I(s.replyDocId)},[null==s?void 0:s.replyDocId]),(0,t.jsx)("div",{className:"chat-message",children:(0,t.jsxs)(y.v,{as:"div",className:"relative inline-block text-left w-full",children:[(0,t.jsx)("div",{children:(0,t.jsx)(y.v.Button,{as:l.Fragment,children:(0,t.jsxs)("div",{className:(0,d.Z)("flex items-end",a===s.senderId&&"justify-end"),children:["image"===s.type&&(0,t.jsx)(j,{repliedMessage:h,data:s,userId:a}),("text"===s.type||void 0===s.type)&&(0,t.jsx)(v,{data:s,userId:a,repliedMessage:h})]})})}),(0,t.jsx)(b.u,{as:l.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,t.jsxs)(y.v.Items,{className:(0,d.Z)("absolute z-[2] mt-2 divide-y divide-gray-100 rounded-md bg-white dark:bg-darkBg shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none flex flex-col overflow-hidden",s.senderId===a?"origin-top-right right-2":"origin-top-left left-2"),children:[(0,t.jsx)(w,{onClick:()=>{p()},icon:(0,t.jsx)(N(),{}),text:x("reply")}),s.senderId===a&&(0,t.jsx)(w,{onClick:()=>{f()},icon:(0,t.jsx)(Z(),{}),text:x("edit")}),s.senderId===a&&(0,t.jsx)(w,{danger:!0,onClick:()=>o(s),icon:(0,t.jsx)(L.Z,{}),text:x("delete")})]})})]})})};var M=a(61916);let E=(0,l.forwardRef)((e,s)=>{let{messages:a,onReply:l,onEdit:i,onDelete:r,chatId:d}=e,{t:n}=(0,g.$G)(),o=(0,M.Z)(e=>e.user);return 0===a.length?(0,t.jsx)("div",{className:"flex-1  flex items-center justify-center",children:(0,t.jsx)("span",{children:n("there.are.no.messages")})}):(0,t.jsxs)("div",{id:"messages",className:"flex flex-col space-y-4 px-3 overflow-y-auto scrollbar-thumb-blue scrollbar-thumb-rounded scrollbar-track-blue-lighter scrollbar-w-2 scrolling-touch flex-1",children:[a.map(e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-center text-xs my-2",children:c()(e.date).format("DD MMM, YY")}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:e.messages.map(e=>(0,t.jsx)(D,{onEdit:i,onReply:l,data:e,userId:null==o?void 0:o.id,onDelete:r,chatId:d},e.id))})]},e.date)),(0,t.jsx)("div",{ref:s})]})});var z=a(5731),C=a.n(z),B=a(50120),J=a.n(B),R=a(41991),U=a(82670),_=a(87957),F=a(42776),H=a(85777),G=a(30072),P=a(24226);let T=R.object({message:R.string().required(),type:R.string()}),Y=e=>{let{chatId:s,editedMessage:a,repliedMessage:d,clearEditMessage:n,clearReplyMessage:c}=e,{t:o}=(0,g.$G)(),{mutate:m,isLoading:x}=(0,H.H)(),p=(0,M.Z)(e=>e.user),v=(0,l.useRef)(null),{register:j,handleSubmit:y,reset:b,setValue:w}=(0,U.cI)({resolver:(0,_.X)(T)}),I=async e=>{if(s){b();let t=(0,i.ad)(r.Z),l=(0,S.JU)(t,"chat",s);if(a)n(),await (0,S.r7)((0,S.JU)(t,"chat",s,"message",a.id),{message:e.message}),a.isLast&&await (0,S.r7)(l,{lastMessage:e.message,time:(0,i.Bt)()});else{await (0,S.r7)(l,{lastMessage:e.message,time:(0,i.Bt)()});let a={read:!1,time:new Date().toISOString(),message:e.message,senderId:null==p?void 0:p.id};e.type&&(a.type=e.type),d&&(a.replyDocId=d.id,c()),await (0,S.ET)((0,i.hJ)(t,"chat",s,"message"),a)}}else(0,F.vU)(o("chat.is.not.created"))};return(0,l.useEffect)(()=>{(null==a?void 0:a.message)&&w("message",a.message)},[null==a?void 0:a.message]),(0,t.jsxs)("div",{className:"border-t border-gray-200 px-4 py-4   w-full bg-white dark:bg-dark dark:border-gray-bold",children:[a&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col mb-4",children:[(0,t.jsx)("span",{className:"text-xs text-blue-link",children:o("editing")}),(0,t.jsx)("span",{className:"text-sm line-clamp-1",children:a.message})]}),(0,t.jsx)(h.h,{onClick:n,children:(0,t.jsx)(u.Z,{size:20})})]}),x&&(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)(P.Z,{size:24}),(0,t.jsx)("span",{className:"text-sm",children:o("uploading.image")})]}),d&&(0,t.jsx)(f,{data:d,inProgress:!0,onClear:c}),(0,t.jsx)("form",{onSubmit:y(I),children:(0,t.jsxs)("div",{className:"relative max-h-max",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{ref:v,onChange:e=>{let{files:s}=e.target;if(null==s?void 0:s.length){let e=new FormData;[...s].forEach(s=>{s&&e.append("image",s,s.name)}),e.append("type",G.X.USER),m(e,{onSuccess:async e=>{await I({message:e.data.title,type:"image"})},onError:()=>{(0,F.vU)(o("failed.to.upload"))}})}},type:"file",accept:"image/png, image/jpg, image/jpeg, image/webp",hidden:!0}),(0,t.jsx)("textarea",{...j("message"),placeholder:o("message"),rows:1,className:"w-full focus:outline-none focus:placeholder-gray-400 text-gray-600 placeholder-gray-600 pl-3 pr-24 bg-gray-200 dark:bg-gray-darkSegment dark:text-white rounded-2xl py-3 resize-none"})]}),(0,t.jsxs)("div",{className:"absolute  right-0 inset-y-0 items-center max-h-max flex gap-2 ",children:[(0,t.jsx)(h.h,{onClick:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.click()},type:"button",children:(0,t.jsx)(C(),{})}),(0,t.jsx)(h.h,{type:"submit",size:"large",children:(0,t.jsx)(J(),{})})]})]})})]})},O=e=>{let s=new Date(Date.now()).toISOString(),a=[];return e.forEach(e=>{if(c()(e.time).isSame(c()(s),"day")){let t=a.findIndex(s=>c()(s.date).isSame(c()(e.time),"day"));t<0?a.push({date:s,messages:[e]}):a[t].messages.push(e)}else s=e.time}),a};var X=a(54965),$=e=>{let{recieverId:s}=e,[a,d]=(0,l.useState)([]),n=(0,l.useRef)(null),o=(0,M.Z)(e=>e.user),[m,x]=(0,l.useState)(),[h,u]=(0,l.useState)(!1),[g,p]=(0,l.useState)(null),[f,v]=(0,l.useState)(null),j=(0,i.ad)(r.Z),y=(0,l.useRef)(!1),b=async()=>{var e;let a=(0,i.hJ)(j,"chat"),t=(0,i.IO)(a,(0,i.ar)("ids","array-contains-any",[null==o?void 0:o.id,s]),(0,i.Xo)("time","desc"));await (0,i.PL)(t).then(async e=>{let a=e.docs.map(e=>{let a=e.data(),t=a.ids.includes(null==o?void 0:o.id),l=a.ids.includes(s),i={id:e.id,ids:a.ids,time:a.time,lastMessage:a.lastMessage};if(t&&l)return i}).find(e=>void 0!==e);a?x(a.id):y.current||(y.current=!0,await (0,S.ET)((0,i.hJ)(j,"chat"),{ids:[null==o?void 0:o.id,s],time:(0,i.Bt)()}).then(e=>{x(e.id)}).catch(()=>{y.current=!1}))}).catch(async()=>{y.current=!0,await (0,S.ET)((0,i.hJ)(j,"chat"),{ids:[null==o?void 0:o.id,s],time:(0,i.Bt)()}).then(e=>{x(e.id)})}),null===(e=n.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,l.useEffect)(()=>{(null==o?void 0:o.id)&&(u(!0),b().catch(()=>{u(!1)}))},[s,null==o?void 0:o.id]);let w=async()=>{if(m){let e=(0,i.IO)((0,i.hJ)(j,"chat",m,"message")),s=(0,i.cf)(e,async e=>{let s=[],a=(0,i.qs)(j);e.forEach(e=>{let t=e.ref,l=e.data();s.push({id:e.id,message:l.message,time:l.time,read:l.read,senderId:l.senderId,type:l.type,replyDocId:l.replyDocId,isLast:!1}),l.senderId===(null==o?void 0:o.id)||l.read||a.update(t,{read:!0})}),s.sort((e,s)=>c()(e.time).isAfter(c()(s.time))?1:-1),s[e.size-1]&&(s[e.size-1].isLast=!0),d(O(s)),u(!1),await a.commit()});return()=>{s()}}return()=>void 0};(0,l.useEffect)(()=>{w()},[m]),(0,l.useEffect)(()=>{var e;null===(e=n.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[a]);let I=(0,l.useCallback)(async e=>{if(m){var s,t;await (0,i.oe)((0,i.JU)(j,"chat",m,"message",e.id));let l=(0,i.JU)(j,"chat",m),r=null==a?void 0:null===(t=a.at(-1))||void 0===t?void 0:null===(s=t.messages)||void 0===s?void 0:s.at(-2);e.isLast&&await (0,S.r7)(l,{lastMessage:r?r.message:"",time:(0,i.Bt)()})}},[m,a]);return(0,t.jsxs)("div",{className:"flex flex-col h-full chat-body",children:[h?(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(X.W,{centered:!0})}):(0,t.jsx)(E,{onEdit:e=>v(e),onReply:e=>p(e),messages:a,onDelete:I,chatId:m,ref:n}),(0,t.jsx)(Y,{clearEditMessage:()=>v(null),clearReplyMessage:()=>p(null),editedMessage:f,repliedMessage:g,chatId:m})]})}},24499:function(e,s,a){let t=(0,a(26142).ZF)({apiKey:"AIzaSyBnyg4rjjOAsCqDuYYGZQBjp6RYn3DSa7Y",authDomain:"temi-wa.firebaseapp.com",projectId:"temi-wa",storageBucket:"temi-wa.firebasestorage.app",messagingSenderId:"356560069025",appId:"1:356560069025:web:edf9898fd9d93c9c5d2be0",measurementId:"G-RFXH2826HJ"});s.Z=t}}]);