"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5591],{91967:function(e,t,a){var i=a(3827);a(64090),t.Z=e=>(0,i.jsxs)("svg",{width:e.size||"20",height:e.size||"20",...e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("g",{clipPath:"url(#clip0_1_9251)",children:(0,i.jsx)("path",{d:"M9.66825 11.4667L10.8449 12.6434L17.8999 5.58838L19.0783 6.76671L10.8449 15L5.54159 9.69671L6.71992 8.51838L8.49075 10.2892L9.66825 11.4659V11.4667ZM9.66992 9.11004L13.7966 4.98254L14.9716 6.15754L10.8449 10.285L9.66992 9.11004ZM7.31409 13.8225L6.13659 15L0.833252 9.69671L2.01159 8.51838L3.18909 9.69588L3.18825 9.69671L7.31409 13.8225Z",fill:"currentColor"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0_1_9251",children:(0,i.jsx)("rect",{width:"20",height:"20",fill:"white"})})})]})},60140:function(e,t,a){a.d(t,{b:function(){return l}});var i=a(3827),n=a(64090);let s=e=>{let{threshold:t=.1,root:a=null,rootMargin:i="50%",enabled:s=!1,onScreen:r=()=>null}=e,l=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=null==l?void 0:l.current;if(!s||!e)return;let n=new IntersectionObserver(e=>e.forEach(e=>{e.isIntersecting&&r()}),{threshold:t,root:a,rootMargin:i});return n.observe(e),()=>{n.unobserve(e)}},[null==l?void 0:l.current,s]),l};var r=a(29541);let l=e=>{let{hasMore:t,loadMore:a,loading:n=!1,children:l}=e,o=s({enabled:!!t&&!n,onScreen:()=>{a()},rootMargin:"30px",threshold:.2});return(0,i.jsxs)(i.Fragment,{children:[l,n&&(0,i.jsx)("div",{className:"flex justify-center my-7",children:(0,i.jsx)(r.Z,{})}),(0,i.jsx)("span",{"aria-label":"bottom",ref:o,style:{visibility:"hidden"}})]})}},35591:function(e,t,a){a.r(t),a.d(t,{NotificationPanel:function(){return k}});var i=a(3827);a(64090);var n=a(32635),s=a(91967),r=a(64095),l=a(9988),o=a(8186),d=a(56804),c=a(80991),u=a(34734),x=a(61916),f=a(2868),m=a(16777),p=a(60140),h=a(24232),v=a(89539),g=a.n(v),b=a(47907),y=a(47001),j=a(23564);let N=e=>{let{data:t,onClick:a}=e,n=(0,b.useRouter)(),s=(0,r.NL)(),{hourFormat:l}=(0,j.L)(),{mutate:c}=(0,o.D)({mutationFn:()=>d.B.readById(t.id),onMutate:async()=>{let e=s.getQueryData(["notificationStatistics"]),a=s.getQueryData(["notifications"],{exact:!1});return s.setQueryData(["notificationStatistics"],a=>a?{...a,[t.type]:a[t.type]-1<0?0:a[t.type]-1,notification:a.notification-1<0?0:a.notification-1}:e),s.setQueriesData({queryKey:["notifications"],exact:!1},e=>e?{...e,pages:e.pages.map(e=>{var a;return{...e,data:null===(a=e.data)||void 0===a?void 0:a.map(e=>e.id===t.id?{...e,read_at:new Date(Date.now()).toISOString()}:e)}})}:a),{prevStatistics:e,prevNotifications:a}},onError:(e,t,a)=>{s.setQueryData(["notificationStatistics"],null==a?void 0:a.prevStatistics),s.setQueriesData({queryKey:["notifications"],exact:!1},null==a?void 0:a.prevNotifications)},onSettled:async()=>{await s.invalidateQueries(["notificationStatistics"]),await s.invalidateQueries(["notifications"])}});return(0,i.jsxs)("button",{onClick:e=>{var i,s;if(c(),(null===(i=t.data)||void 0===i?void 0:i.id)&&y.VW[t.model_type]){n.push("/".concat(y.VW[t.model_type],"/").concat(null===(s=t.data)||void 0===s?void 0:s.id),{scroll:!1});return}a&&a(),e.preventDefault(),e.stopPropagation()},className:"bg-gray-faq dark:bg-gray-darkSegment rounded-2xl p-5 relative text-start",children:[!t.read_at&&(0,i.jsx)("div",{className:"absolute top-4 right-4 w-2.5 h-2.5 rounded-full bg-primary"}),(0,i.jsx)("span",{className:"text-xs font-medium text-gray-disabledTab",children:g()(t.created_at).format("DD MMM, YY ".concat(l))}),(0,i.jsx)("div",{className:"text-base font-medium leading-7 mt-2 line-clamp-2",children:t.body})]})},w=(0,h.default)(()=>Promise.all([a.e(4705),a.e(1411),a.e(2666)]).then(a.bind(a,28010)).then(e=>({default:e.NotificationEmptyList})),{loadableGenerated:{webpack:()=>[28010]}}),L=e=>{let{type:t,onCardClick:a,limitHeight:n}=e,s=(0,x.Z)(e=>e.user),{data:r,isLoading:l,fetchNextPage:o,hasNextPage:c,isFetchingNextPage:h}=(0,f.N)(["notifications",t],e=>{let{pageParam:a=1}=e;return d.B.getAll({type:t,column:"id",sort:"desc",perPage:4,page:a})},{getNextPageParam:e=>e.links.next&&e.meta.current_page+1,enabled:!!s}),v=(0,m.v)(null==r?void 0:r.pages);return v&&(null==v?void 0:v.length)===0||!s?(0,i.jsx)(w,{}):l?(0,i.jsxs)("div",{className:"flex flex-col gap-2.5 animate-pulse",children:[(0,i.jsx)("div",{className:"bg-gray-200 rounded-xl h-32"}),(0,i.jsx)("div",{className:"bg-gray-200 rounded-xl h-32"}),(0,i.jsx)("div",{className:"bg-gray-200 rounded-xl h-32"})]}):(0,i.jsx)("div",{className:(0,u.Z)(n&&"md:max-h-[500px] sm:max-h-[400px] max-h-[350px] overflow-y-auto"),children:(0,i.jsx)(p.b,{loadMore:o,hasMore:c,loading:h,children:(0,i.jsx)("div",{className:"flex flex-col gap-2.5 pb-10",children:null==v?void 0:v.map(e=>(0,i.jsx)(N,{data:e,onClick:a},e.id))})})})},_=[{label:"all",type:"notification"},{label:"news",type:"news_publish"},{label:"orders",type:"status_changed"}],k=e=>{let{onCardClick:t,limitHeight:a=!0}=e,{t:f}=(0,n.$G)(),m=(0,r.NL)(),p=(0,x.Z)(e=>e.user),{data:h,isLoading:v}=(0,l.a)(["notificationStatistics"],()=>d.B.statistics(),{enabled:!!p}),{mutate:g}=(0,o.D)({mutationFn:()=>d.B.readAll(),onMutate:async()=>{let e=m.getQueryData(["notificationStatistics"]),t=m.getQueryData(["notifications"],{exact:!1});return m.setQueryData(["notificationStatistics"],t=>t?{notification:0,status_changed:0,news_publish:0,new_order:0,new_user_by_referral:0,transaction:0}:e),m.setQueriesData({queryKey:["notifications"],exact:!1},e=>e?{...e,pages:e.pages.map(e=>{var t;return{...e,data:null===(t=e.data)||void 0===t?void 0:t.map(e=>({...e,read_at:new Date(Date.now()).toISOString()}))}})}:t),{prevStatistics:e,prevNotifications:t}},onError:(e,t,a)=>{m.setQueryData(["notificationStatistics"],null==a?void 0:a.prevStatistics),m.setQueriesData({queryKey:["notifications"],exact:!1},null==a?void 0:a.prevNotifications)},onSettled:async()=>{await m.invalidateQueries(["notificationStatistics"]),await m.invalidateQueries(["notifications"])}});return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-[22px] font-semibold",children:f("notifications")}),!v&&(0,i.jsx)("button",{onClick:()=>g(),className:"focus-ring",children:(0,i.jsxs)("div",{className:"flex items-center gap-2 border-b border-dark dark:border-white",children:[(0,i.jsx)(s.Z,{}),(0,i.jsx)("span",{className:"text-xs font-semibold",children:f("mark.as.read")})]})})]}),(0,i.jsxs)(c.O.Group,{children:[(0,i.jsx)(c.O.List,{className:"flex gap-5 space-x-1 mt-7 border-b border-gray-border",children:e=>{let{selectedIndex:t}=e;return(0,i.jsx)(i.Fragment,{children:_.map((e,a)=>(0,i.jsxs)(c.O,{className:e=>{let{selected:t}=e;return(0,u.Z)("focus-ring outline-none flex items-center gap-2.5 ring-offset-2",t?"border-b-2 border-dark dark:border-white":"text-gray-disabledTab pb-px")},children:[(0,i.jsx)("span",{className:"text-base font-medium",children:f(e.label)}),!!(null==h?void 0:h[e.type])&&(null==h?void 0:h[e.type])!==0&&p&&(0,i.jsx)("div",{className:(0,u.Z)("h-4 p-1 flex items-center justify-center rounded-full ",t===a?"bg-dark dark:bg-white":"bg-gray-disabledTab"),children:(0,i.jsx)("span",{className:"text-xs text-white dark:text-dark",children:null==h?void 0:h[e.type]})})]},e.type))})}}),(0,i.jsx)(c.O.Panels,{className:"mt-2",children:_.map(e=>(0,i.jsx)(c.O.Panel,{className:"mt-4",children:(0,i.jsx)(L,{type:e.type,onCardClick:t,limitHeight:a})},e.type))})]})]})}},23564:function(e,t,a){a.d(t,{L:function(){return n}});var i=a(98313);let n=()=>{let{settings:e}=(0,i.r)();return{hourFormat:(null==e?void 0:e.hour_format)||"HH:mm"}}},16777:function(e,t,a){a.d(t,{v:function(){return i}});let i=e=>null==e?void 0:e.reduce((e,t)=>e.concat(t.data),[])}}]);