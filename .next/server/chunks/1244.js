"use strict";exports.id=1244,exports.ids=[1244],exports.modules={2504:(e,s,t)=>{t.d(s,{Z:()=>i});var a=t(95344);t(3729);let i=e=>(0,a.jsxs)("svg",{width:e.size||"20",height:e.size||"20",...e,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("g",{clipPath:"url(#clip0_1_9251)",children:a.jsx("path",{d:"M9.66825 11.4667L10.8449 12.6434L17.8999 5.58838L19.0783 6.76671L10.8449 15L5.54159 9.69671L6.71992 8.51838L8.49075 10.2892L9.66825 11.4659V11.4667ZM9.66992 9.11004L13.7966 4.98254L14.9716 6.15754L10.8449 10.285L9.66992 9.11004ZM7.31409 13.8225L6.13659 15L0.833252 9.69671L2.01159 8.51838L3.18909 9.69588L3.18825 9.69671L7.31409 13.8225Z",fill:"currentColor"})}),a.jsx("defs",{children:a.jsx("clipPath",{id:"clip0_1_9251",children:a.jsx("rect",{width:"20",height:"20",fill:"white"})})})]})},1244:(e,s,t)=>{t.r(s),t.d(s,{default:()=>X});var a=t(95344),i=t(3729),l=t(29127),r=t(87521),d=t(42473),n=t(48869),c=t.n(n),m=t(2504),o=t(9385),x=t.n(o),h=t(56086),g=t(4340),p=t(9758),u=t(89410);let f=({data:e,inProgress:s,onClear:t,isMine:i})=>{let{t:l}=(0,p.$G)();return(0,a.jsxs)("div",{className:(0,d.Z)("flex items-center gap-2 w-full ",s?"mb-4":"mb-1"),children:[a.jsx("div",{className:(0,d.Z)("h-full w-0.5 rounded-full",i?"bg-white":"bg-blue-link","image"===e.type&&s&&"min-h-[80px]",("text"===e.type||void 0===e.type)&&s&&"min-h-[30px]",("text"===e.type||void 0===e.type)&&!s&&"min-h-[14px]","image"===e.type&&!s&&"min-h-[60px]")}),(0,a.jsxs)("div",{className:"flex items-center justify-between flex-1",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[s&&a.jsx("span",{className:"text-xs text-blue-link",children:l("replying.to")}),"image"===e.type?a.jsx(u.default,{src:e.message,alt:e.message,width:60,height:60,className:"max-h-[60px] object-contain"}):a.jsx("span",{className:"text-sm line-clamp-1",children:e.message})]}),!!t&&a.jsx(h.h,{onClick:t,children:a.jsx(g.Z,{size:20})})]})]})},j=({data:e,userId:s,repliedMessage:t})=>a.jsx("div",{className:"flex flex-col space-y-2 text-xs max-w-xs mx-2 order-2 items-end",children:(0,a.jsxs)("div",{className:(0,d.Z)("pl-4 py-2 relative rounded-lg  text-base flex flex-col  ",s===e.senderId?"rounded-br-none bg-primary text-white pr-14":"rounded-bl-none bg-gray-card pr-12 dark:text-dark"),children:[t&&a.jsx(f,{data:t,inProgress:!1,isMine:e.senderId===s}),e.message,(0,a.jsxs)("div",{className:"flex items-center absolute bottom-1 right-1 gap-1",children:[a.jsx("span",{className:(0,d.Z)(s===e.senderId&&"text-white","text-xs"),children:c()(e.time).format("HH:mm")}),s===e.senderId&&a.jsx("div",{className:"text-white",children:e.read?a.jsx(m.Z,{size:12}):a.jsx(x(),{size:12})})]})]})}),y=({data:e,userId:s,repliedMessage:t})=>(0,a.jsxs)("div",{className:"relative max-w-xs mx-2 order-2 ",children:[(0,a.jsxs)("div",{className:(0,d.Z)("p-1 relative rounded-lg  text-base flex flex-col ",s===e.senderId?"rounded-br-none bg-primary text-white ":"rounded-bl-none bg-gray-card"),children:[t&&a.jsx(f,{data:t,inProgress:!1,isMine:e.senderId===s}),a.jsx(u.default,{src:e.message,alt:e.message,height:200,width:200,className:"w-auto object-cover rounded-md "})]}),(0,a.jsxs)("div",{className:"flex items-center absolute bottom-1 right-2 gap-1",style:{textShadow:"1px 1px 2px black"},children:[a.jsx("span",{className:(0,d.Z)("text-xs drop-shadow-3xl text-white"),children:c()(e.time).format("HH:mm")}),s===e.senderId&&a.jsx("div",{className:"text-white",children:e.read?a.jsx(m.Z,{className:"checkIcon",size:12}):a.jsx(x(),{className:"checkIcon",size:12})})]})]});var v=t(69724),b=t(63816);let w=({icon:e,text:s,danger:t,onClick:i})=>a.jsx(v.v.Item,{children:({active:l,close:r})=>(0,a.jsxs)("button",{onClick:()=>{i(),r()},className:(0,d.Z)("px-3 py-2 inline-flex items-center gap-5 hover:bg-gray-segment dark:hover:bg-gray-inputBorder",l&&"bg-gray-segment",t&&"text-red"),children:[e,s]})});var I=t(67039),N=t.n(I),k=t(33276),L=t.n(k),Z=t(52138),M=t(83289);let S=({data:e,userId:s,onReply:t,onEdit:n,onDelete:c,chatId:m})=>{let{t:o}=(0,p.$G)(),[x,h]=(0,i.useState)(null),g=()=>{t(e),n(null)},u=()=>{n(e),t(null)},f=async e=>{if(m){let s=(0,l.ad)(r.Z),t=(0,M.JU)(s,"chat",m,"message",e);await (0,l.QT)(t).then(e=>{let s=e.data();h({id:e.id,message:s?.message,time:s?.time,replyDocId:s?.replyDocId,senderId:s?.senderId,type:s?.type,read:s?.read,isLast:!1})})}};return(0,i.useEffect)(()=>{e?.replyDocId&&f(e.replyDocId)},[e?.replyDocId]),a.jsx("div",{className:"chat-message",children:(0,a.jsxs)(v.v,{as:"div",className:"relative inline-block text-left w-full",children:[a.jsx("div",{children:a.jsx(v.v.Button,{as:i.Fragment,children:(0,a.jsxs)("div",{className:(0,d.Z)("flex items-end",s===e.senderId&&"justify-end"),children:["image"===e.type&&a.jsx(y,{repliedMessage:x,data:e,userId:s}),("text"===e.type||void 0===e.type)&&a.jsx(j,{data:e,userId:s,repliedMessage:x})]})})}),a.jsx(b.u,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,a.jsxs)(v.v.Items,{className:(0,d.Z)("absolute z-[2] mt-2 divide-y divide-gray-100 rounded-md bg-white dark:bg-darkBg shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none flex flex-col overflow-hidden",e.senderId===s?"origin-top-right right-2":"origin-top-left left-2"),children:[a.jsx(w,{onClick:()=>{g()},icon:a.jsx(N(),{}),text:o("reply")}),e.senderId===s&&a.jsx(w,{onClick:()=>{u()},icon:a.jsx(L(),{}),text:o("edit")}),e.senderId===s&&a.jsx(w,{danger:!0,onClick:()=>c(e),icon:a.jsx(Z.Z,{}),text:o("delete")})]})})]})})};var D=t(92232);let E=(0,i.forwardRef)(({messages:e,onReply:s,onEdit:t,onDelete:i,chatId:l},r)=>{let{t:d}=(0,p.$G)(),n=(0,D.Z)(e=>e.user);return 0===e.length?a.jsx("div",{className:"flex-1  flex items-center justify-center",children:a.jsx("span",{children:d("there.are.no.messages")})}):(0,a.jsxs)("div",{id:"messages",className:"flex flex-col space-y-4 px-3 overflow-y-auto scrollbar-thumb-blue scrollbar-thumb-rounded scrollbar-track-blue-lighter scrollbar-w-2 scrolling-touch flex-1",children:[e.map(e=>(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-center text-xs my-2",children:c()(e.date).format("DD MMM, YY")}),a.jsx("div",{className:"flex flex-col gap-2",children:e.messages.map(e=>a.jsx(S,{onEdit:t,onReply:s,data:e,userId:n?.id,onDelete:i,chatId:l},e.id))})]},e.date)),a.jsx("div",{ref:r})]})});var z=t(42229),C=t.n(z),J=t(22606),B=t.n(J),R=t(84502),U=t(60708),P=t(96040),T=t(1475),F=t(69019),H=t(11458),G=t(12818);let O=R.object({message:R.string().required(),type:R.string()}),$=({chatId:e,editedMessage:s,repliedMessage:t,clearEditMessage:d,clearReplyMessage:n})=>{let{t:c}=(0,p.$G)(),{mutate:m,isLoading:o}=(0,F.H)(),x=(0,D.Z)(e=>e.user),u=(0,i.useRef)(null),{register:j,handleSubmit:y,reset:v,setValue:b}=(0,U.cI)({resolver:(0,P.X)(O)}),w=async a=>{if(e){v();let i=(0,l.ad)(r.Z),c=(0,M.JU)(i,"chat",e);if(s)d(),await (0,M.r7)((0,M.JU)(i,"chat",e,"message",s.id),{message:a.message}),s.isLast&&await (0,M.r7)(c,{lastMessage:a.message,time:(0,l.Bt)()});else{await (0,M.r7)(c,{lastMessage:a.message,time:(0,l.Bt)()});let s={read:!1,time:new Date().toISOString(),message:a.message,senderId:x?.id};a.type&&(s.type=a.type),t&&(s.replyDocId=t.id,n()),await (0,M.ET)((0,l.hJ)(i,"chat",e,"message"),s)}}else(0,T.vU)(c("chat.is.not.created"))};return(0,i.useEffect)(()=>{s?.message&&b("message",s.message)},[s?.message]),(0,a.jsxs)("div",{className:"border-t border-gray-200 px-4 py-4   w-full bg-white dark:bg-dark dark:border-gray-bold",children:[s&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col mb-4",children:[a.jsx("span",{className:"text-xs text-blue-link",children:c("editing")}),a.jsx("span",{className:"text-sm line-clamp-1",children:s.message})]}),a.jsx(h.h,{onClick:d,children:a.jsx(g.Z,{size:20})})]}),o&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(G.Z,{size:24}),a.jsx("span",{className:"text-sm",children:c("uploading.image")})]}),t&&a.jsx(f,{data:t,inProgress:!0,onClear:n}),a.jsx("form",{onSubmit:y(w),children:(0,a.jsxs)("div",{className:"relative max-h-max",children:[(0,a.jsxs)("div",{children:[a.jsx("input",{ref:u,onChange:e=>{let{files:s}=e.target;if(s?.length){let e=new FormData;[...s].forEach(s=>{s&&e.append("image",s,s.name)}),e.append("type",H.X.USER),m(e,{onSuccess:async e=>{await w({message:e.data.title,type:"image"})},onError:()=>{(0,T.vU)(c("failed.to.upload"))}})}},type:"file",accept:"image/png, image/jpg, image/jpeg, image/webp",hidden:!0}),a.jsx("textarea",{...j("message"),placeholder:c("message"),rows:1,className:"w-full focus:outline-none focus:placeholder-gray-400 text-gray-600 placeholder-gray-600 pl-3 pr-24 bg-gray-200 dark:bg-gray-darkSegment dark:text-white rounded-2xl py-3 resize-none"})]}),(0,a.jsxs)("div",{className:"absolute  right-0 inset-y-0 items-center max-h-max flex gap-2 ",children:[a.jsx(h.h,{onClick:()=>u.current?.click(),type:"button",children:a.jsx(C(),{})}),a.jsx(h.h,{type:"submit",size:"large",children:a.jsx(B(),{})})]})]})})]})},_=e=>{let s=new Date(Date.now()).toISOString(),t=[];return e.forEach(e=>{if(c()(e.time).isSame(c()(s),"day")){let a=t.findIndex(s=>c()(s.date).isSame(c()(e.time),"day"));a<0?t.push({date:s,messages:[e]}):t[a].messages.push(e)}else s=e.time}),t};var V=t(17329);let X=({recieverId:e})=>{let[s,t]=(0,i.useState)([]),d=(0,i.useRef)(null),n=(0,D.Z)(e=>e.user),[m,o]=(0,i.useState)(),[x,h]=(0,i.useState)(!1),[g,p]=(0,i.useState)(null),[u,f]=(0,i.useState)(null),j=(0,l.ad)(r.Z),y=(0,i.useRef)(!1),v=async()=>{let s=(0,l.hJ)(j,"chat"),t=(0,l.IO)(s,(0,l.ar)("ids","array-contains-any",[n?.id,e]),(0,l.Xo)("time","desc"));await (0,l.PL)(t).then(async s=>{let t=s.docs.map(s=>{let t=s.data(),a=t.ids.includes(n?.id),i=t.ids.includes(e),l={id:s.id,ids:t.ids,time:t.time,lastMessage:t.lastMessage};if(a&&i)return l}).find(e=>void 0!==e);t?o(t.id):y.current||(y.current=!0,await (0,M.ET)((0,l.hJ)(j,"chat"),{ids:[n?.id,e],time:(0,l.Bt)()}).then(e=>{o(e.id)}).catch(()=>{y.current=!1}))}).catch(async()=>{y.current=!0,await (0,M.ET)((0,l.hJ)(j,"chat"),{ids:[n?.id,e],time:(0,l.Bt)()}).then(e=>{o(e.id)})}),d.current?.scrollIntoView({behavior:"smooth"})};(0,i.useEffect)(()=>{n?.id&&(h(!0),v().catch(()=>{h(!1)}))},[e,n?.id]);let b=async()=>{if(m){let e=(0,l.IO)((0,l.hJ)(j,"chat",m,"message")),s=(0,l.cf)(e,async e=>{let s=[],a=(0,l.qs)(j);e.forEach(e=>{let t=e.ref,i=e.data();s.push({id:e.id,message:i.message,time:i.time,read:i.read,senderId:i.senderId,type:i.type,replyDocId:i.replyDocId,isLast:!1}),i.senderId===n?.id||i.read||a.update(t,{read:!0})}),s.sort((e,s)=>c()(e.time).isAfter(c()(s.time))?1:-1),s[e.size-1]&&(s[e.size-1].isLast=!0),t(_(s)),h(!1),await a.commit()});return()=>{s()}}return()=>void 0};(0,i.useEffect)(()=>{b()},[m]),(0,i.useEffect)(()=>{d.current?.scrollIntoView({behavior:"smooth"})},[s]);let w=(0,i.useCallback)(async e=>{if(m){await (0,l.oe)((0,l.JU)(j,"chat",m,"message",e.id));let t=(0,l.JU)(j,"chat",m),a=s?.at(-1)?.messages?.at(-2);e.isLast&&await (0,M.r7)(t,{lastMessage:a?a.message:"",time:(0,l.Bt)()})}},[m,s]);return(0,a.jsxs)("div",{className:"flex flex-col h-full chat-body",children:[x?a.jsx("div",{className:"flex-1",children:a.jsx(V.W,{centered:!0})}):a.jsx(E,{onEdit:e=>f(e),onReply:e=>p(e),messages:s,onDelete:w,chatId:m,ref:d}),a.jsx($,{clearEditMessage:()=>f(null),clearReplyMessage:()=>p(null),editedMessage:u,repliedMessage:g,chatId:m})]})}}};