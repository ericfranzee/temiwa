"use strict";exports.id=4259,exports.ids=[4259],exports.modules={59601:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addAdminServicesToServer=t.registerAdminService=void 0;let n=[];function r(e,t){n.push({getServiceDefinition:e,getHandlers:t})}function i(e){for(let{getServiceDefinition:t,getHandlers:r}of n)e.addService(t(),r())}t.registerAdminService=r,t.addAdminServicesToServer=i},84934:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffTimeout=void 0;let n=1e3,r=1.6,i=12e4,s=.2;function a(e,t){return Math.random()*(t-e)+e}class o{constructor(e,t){this.callback=e,this.initialDelay=n,this.multiplier=r,this.maxDelay=i,this.jitter=s,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,n;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null===(n=(t=this.timerId).unref)||void 0===n||n.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+a(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null===(t=(e=this.timerId).ref)||void 0===t||t.call(e)}unref(){var e,t;this.hasRef=!1,null===(t=(e=this.timerId).unref)||void 0===t||t.call(e)}getEndTime(){return this.endTime}}t.BackoffTimeout=o},78931:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallCredentials=void 0;let r=n(62252);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,n)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((n,r)=>{e.getRequestMetadata(t.service_url,(e,t)=>{if(e){r(e);return}if(!t){r(Error("Headers not set by metadata plugin"));return}n(t)})})).then(e=>{let t=new r.Metadata;for(let n of Object.keys(e))t.add(n,e[n]);n(null,t)},e=>{n(e)})})}static createEmpty(){return new l}}t.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new r.Metadata;for(let n of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(n);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,n)=>t._equals(e.creds[n]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,n)=>{this.metadataGenerator(e,(e,r)=>{void 0!==r?t(r):n(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new r.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},46749:(e,t)=>{function n(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length}Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptingListenerImpl=t.isInterceptingListener=void 0,t.isInterceptingListener=n;class r{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}t.InterceptingListenerImpl=r},38445:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getNextCallNumber=void 0;let n=0;function r(){return n++}t.getNextCallNumber=r},78439:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClientDuplexStreamImpl=t.ClientWritableStreamImpl=t.ClientReadableStreamImpl=t.ClientUnaryCallImpl=t.callErrorFromStatus=void 0;let r=n(82361),i=n(12781),s=n(32678);function a(e,t){let n=`${e.code} ${s.Status[e.code]}: ${e.details}`,r=Error(n),i=`${r.stack}
for call at
${t}`;return Object.assign(Error(n),e,{stack:i})}t.callErrorFromStatus=a;class o extends r.EventEmitter{constructor(){super()}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}}t.ClientUnaryCallImpl=o;class l extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}}t.ClientReadableStreamImpl=l;class u extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_write(e,t,n){var r;let i={callback:n},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(r=this.call)||void 0===r||r.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientWritableStreamImpl=u;class c extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}_write(e,t,n){var r;let i={callback:n},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(r=this.call)||void 0===r||r.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientDuplexStreamImpl=c},92528:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelCredentials=void 0;let r=n(24404),i=n(78931),s=n(43009);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,n,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(n,"Certificate chain"),t&&!n)throw Error("Private key must be given with accompanying certificate chain");if(!t&&n)throw Error("Certificate chain must be given with accompanying private key");return new u((0,r.createSecureContext)({ca:null!==(o=null!=e?e:(0,s.getDefaultRootsData)())&&void 0!==o?o:void 0,key:null!=t?t:void 0,cert:null!=n?n:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}t.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},79387:(e,t)=>{function n(e,t){let n=Object.keys(e).sort(),r=Object.keys(t).sort();if(n.length!==r.length)return!1;for(let i=0;i<n.length;i+=1)if(n[i]!==r[i]||e[n[i]]!==t[r[i]])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.channelOptionsEqual=t.recognizedOptions=void 0,t.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},t.channelOptionsEqual=n},46261:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelImplementation=void 0;let r=n(92528),i=n(21118);class s{constructor(e,t,n){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof r.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(n&&"object"!=typeof n)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,n)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,n){this.internalChannel.watchConnectivityState(e,t,n)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,n,r,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,n,r,i)}}t.ChannelImplementation=s},5993:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.getChannelzServiceDefinition=t.getChannelzHandlers=t.unregisterChannelzRef=t.registerChannelzSocket=t.registerChannelzServer=t.registerChannelzSubchannel=t.registerChannelzChannel=t.ChannelzCallTracker=t.ChannelzChildrenTracker=t.ChannelzTrace=void 0;let r=n(41808),i=n(33955),s=n(32678),a=n(23906),o=n(59601),l=n(35085);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let f=32;class p{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,n){let r=new Date;this.events.push({description:t,severity:e,timestamp:r,childChannel:(null==n?void 0:n.kind)==="channel"?n:void 0,childSubchannel:(null==n?void 0:n.kind)==="subchannel"?n:void 0}),this.events.length>=2*f&&(this.events=this.events.slice(f)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:N(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:N(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}t.ChannelzTrace=p;class g{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,n,r;switch(e.kind){case"channel":{let n=null!==(t=this.channelChildren.get(e.id))&&void 0!==t?t:{ref:e,count:0};n.count+=1,this.channelChildren.set(e.id,n);break}case"subchannel":{let t=null!==(n=this.subchannelChildren.get(e.id))&&void 0!==n?n:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!==(r=this.socketChildren.get(e.id))&&void 0!==r?r:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let n=[];for(let{ref:e}of this.socketChildren.values())n.push(e);return{channels:e,subchannels:t,sockets:n}}}t.ChannelzChildrenTracker=g;class m{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}t.ChannelzCallTracker=m;let y=1;function v(){return y++}let b=[],S=[],T=[],C=[];function w(e,t,n){let r=v(),i={id:r,name:e,kind:"channel"};return n&&(b[r]={ref:i,getInfo:t}),i}function E(e,t,n){let r=v(),i={id:r,name:e,kind:"subchannel"};return n&&(S[r]={ref:i,getInfo:t}),i}function I(e,t){let n=v(),r={id:n,kind:"server"};return t&&(T[n]={ref:r,getInfo:e}),r}function _(e,t,n){let r=v(),i={id:r,name:e,kind:"socket"};return n&&(C[r]={ref:i,getInfo:t}),i}function R(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete S[e.id];return;case"server":delete T[e.id];return;case"socket":delete C[e.id];return}}function k(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function A(e){return""===e?[]:[].concat(...e.split(":").map(e=>k(e)))}function D(e){if((0,r.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,r.isIPv6)(e))return null;{let t,n;let r=e.indexOf("::");-1===r?(t=e,n=""):(t=e.substring(0,r),n=e.substring(r+2));let i=Buffer.from(A(t)),s=Buffer.from(A(n)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function x(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function N(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function O(e){let t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:x(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:N(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function M(e,t){let n=Number.parseInt(e.request.channel_id),r=b[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+n});return}t(null,{channel:O(r)})}function P(e,t){let n=Number.parseInt(e.request.max_results),r=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){let e=b[i];if(void 0!==e&&(r.push(O(e)),r.length>=n))break}t(null,{channel:r,end:i>=T.length})}function L(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:N(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function B(e,t){let n=Number.parseInt(e.request.server_id),r=T[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+n});return}t(null,{server:L(r)})}function F(e,t){let n=Number.parseInt(e.request.max_results),r=[],i=Number.parseInt(e.request.start_server_id);for(;i<T.length;i++){let e=T[i];if(void 0!==e&&(r.push(L(e)),r.length>=n))break}t(null,{server:r,end:i>=T.length})}function j(e,t){let n=Number.parseInt(e.request.subchannel_id),r=S[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+n});return}let i=r.getInfo();t(null,{subchannel:{ref:c(r.ref),data:{target:i.target,state:x(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:N(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function U(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(t=D(e.host))&&void 0!==t?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function V(e,t){var n,r,i,a,o;let l=Number.parseInt(e.request.socket_id),u=C[l];if(void 0===u){t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});return}let c=u.getInfo(),h=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(n=c.security.cipherSuiteStandardName)&&void 0!==n?n:void 0,other_name:null!==(r=c.security.cipherSuiteOtherName)&&void 0!==r?r:void 0,local_certificate:null!==(i=c.security.localCertificate)&&void 0!==i?i:void 0,remote_certificate:null!==(a=c.security.remoteCertificate)&&void 0!==a?a:void 0}}:null;t(null,{socket:{ref:d(u.ref),local:c.localAddress?U(c.localAddress):null,remote:c.remoteAddress?U(c.remoteAddress):null,remote_name:null!==(o=c.remoteName)&&void 0!==o?o:void 0,security:h,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:N(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:N(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:N(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:N(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function z(e,t){let n=Number.parseInt(e.request.server_id),r=T[n];if(void 0===r){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+n});return}let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=r.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<o.length&&(!(o[u].id>=i)||(l.push(d(o[u])),!(l.length>=a)));u++);t(null,{socket_ref:l,end:u>=o.length})}function q(){return{GetChannel:M,GetTopChannels:P,GetServer:B,GetServers:F,GetSubchannel:j,GetSocket:V,GetServerSockets:z}}t.registerChannelzChannel=w,t.registerChannelzSubchannel=E,t.registerChannelzServer=I,t.registerChannelzSocket=_,t.unregisterChannelzRef=R,t.getChannelzHandlers=q;let G=null;function K(){if(G)return G;let e=(0,n(58715).J_)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return G=(0,l.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service}function $(){(0,o.registerAdminService)(K,q)}t.getChannelzServiceDefinition=K,t.setup=$},68601:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getInterceptingCall=t.InterceptingCall=t.RequesterBuilder=t.ListenerBuilder=t.InterceptorConfigurationError=void 0;let r=n(62252),i=n(46749),s=n(32678),a=n(75437);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}t.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}t.ListenerBuilder=l;class u{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}t.RequesterBuilder=u;let c={onReceiveMetadata:(e,t)=>{t(e)},onReceiveMessage:(e,t)=>{t(e)},onReceiveStatus:(e,t)=>{t(e)}},h={start:(e,t,n)=>{n(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class d{constructor(e,t){var n,r,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!==(n=t.start)&&void 0!==n?n:h.start,sendMessage:null!==(r=t.sendMessage)&&void 0!==r?r:h.sendMessage,halfClose:null!==(i=t.halfClose)&&void 0!==i?i:h.halfClose,cancel:null!==(s=t.cancel)&&void 0!==s?s:h.cancel}:this.requester=h}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var n,r,s,a,o,l;let u={onReceiveMetadata:null!==(r=null===(n=null==t?void 0:t.onReceiveMetadata)||void 0===n?void 0:n.bind(t))&&void 0!==r?r:e=>{},onReceiveMessage:null!==(a=null===(s=null==t?void 0:t.onReceiveMessage)||void 0===s?void 0:s.bind(t))&&void 0!==a?a:e=>{},onReceiveStatus:null!==(l=null===(o=null==t?void 0:t.onReceiveStatus)||void 0===o?void 0:o.bind(t))&&void 0!==l?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,u,(e,t)=>{var n,r,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!==(n=t.onReceiveMetadata)&&void 0!==n?n:c.onReceiveMetadata,onReceiveMessage:null!==(r=t.onReceiveMessage)&&void 0!==r?r:c.onReceiveMessage,onReceiveStatus:null!==(s=t.onReceiveStatus)&&void 0!==s?s:c.onReceiveStatus};a=new i.InterceptingListenerImpl(e,u)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,n=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,n),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function f(e,t,n){var r,i;let s=null!==(r=n.deadline)&&void 0!==r?r:1/0,a=n.host,o=null!==(i=n.parent)&&void 0!==i?i:null,l=n.propagate_flags,u=n.credentials,c=e.createCall(t,s,a,o,l);return u&&c.setCredentials(u),c}t.InterceptingCall=d;class p{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let n;try{n=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,n)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let n=null;this.call.start(e,{onReceiveMetadata:e=>{var n;null===(n=null==t?void 0:t.onReceiveMetadata)||void 0===n||n.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){n={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new r.Metadata},this.call.cancelWithStatus(n.code,n.details);return}null===(i=null==t?void 0:t.onReceiveMessage)||void 0===i||i.call(t,o)},onReceiveStatus:e=>{var r,i;n?null===(r=null==t?void 0:t.onReceiveStatus)||void 0===r||r.call(t,n):null===(i=null==t?void 0:t.onReceiveStatus)||void 0===i||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class g extends p{constructor(e,t){super(e,t)}start(e,t){var n,r;let i=!1,s={onReceiveMetadata:null!==(r=null===(n=null==t?void 0:t.onReceiveMetadata)||void 0===n?void 0:n.bind(t))&&void 0!==r?r:e=>{},onReceiveMessage:e=>{var n;i=!0,null===(n=null==t?void 0:t.onReceiveMessage)||void 0===n||n.call(t,e)},onReceiveStatus:e=>{var n,r;i||null===(n=null==t?void 0:t.onReceiveMessage)||void 0===n||n.call(t,null),null===(r=null==t?void 0:t.onReceiveStatus)||void 0===r||r.call(t,e)}};super.start(e,s),this.call.startRead()}}class m extends p{}function y(e,t,n){let r=f(e,n.path,t);return n.responseStream?new m(r,n):new g(r,n)}function v(e,t,n,r){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},n,{method_definition:t});return i.reduceRight((e,t)=>n=>t(n,e),e=>y(r,e,t))(s)}t.getInterceptingCall=v},69800:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;let r=n(78439),i=n(46261),s=n(33955),a=n(32678),o=n(62252),l=n(68601),u=Symbol(),c=Symbol(),h=Symbol(),d=Symbol();function f(e){return"function"==typeof e}function p(e){return e.stack.split("\n").slice(1).join("\n")}class g{constructor(e,t,n={}){var r,s;if(n=Object.assign({},n),this[c]=null!==(r=n.interceptors)&&void 0!==r?r:[],delete n.interceptors,this[h]=null!==(s=n.interceptor_providers)&&void 0!==s?s:[],delete n.interceptor_providers,this[c].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=n.callInvocationTransformer,delete n.callInvocationTransformer,n.channelOverride)this[u]=n.channelOverride;else if(n.channelFactoryOverride){let r=n.channelFactoryOverride;delete n.channelFactoryOverride,this[u]=r(e,t,n)}else this[u]=new i.ChannelImplementation(e,t,n)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){let n=r=>{let i;if(r){t(Error("Failed to connect before the deadline"));return}try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,n)}catch(e){t(Error("The channel has been closed"))}};setImmediate(n)}checkOptionalUnaryResponseArguments(e,t,n){if(f(e))return{metadata:new o.Metadata,options:{},callback:e};if(f(t))return e instanceof o.Metadata?{metadata:e,options:{},callback:t}:{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&f(n)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:n}}makeUnaryRequest(e,t,n,i,s,o,f){var g,m;let y=this.checkOptionalUnaryResponseArguments(s,o,f),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:n},b={argument:i,metadata:y.metadata,call:new r.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(b=this[d](b));let S=b.call,T={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(g=b.callOptions.interceptors)&&void 0!==g?g:[],callInterceptorProviders:null!==(m=b.callOptions.interceptor_providers)&&void 0!==m?m:[]},C=(0,l.getInterceptingCall)(T,b.methodDefinition,b.callOptions,b.channel);S.call=C;let w=null,E=!1,I=Error();return C.start(b.metadata,{onReceiveMetadata:e=>{S.emit("metadata",e)},onReceiveMessage(e){null!==w&&C.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),w=e},onReceiveStatus(e){if(!E){if(E=!0,e.code===a.Status.OK){if(null===w){let t=p(I);b.callback((0,r.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,w)}else{let t=p(I);b.callback((0,r.callErrorFromStatus)(e,t))}I=null,S.emit("status",e)}}}),C.sendMessage(i),C.halfClose(),S}makeClientStreamRequest(e,t,n,i,s,o){var f,g;let m=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:n},v={metadata:m.metadata,call:new r.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:m.options,callback:m.callback};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(f=v.callOptions.interceptors)&&void 0!==f?f:[],callInterceptorProviders:null!==(g=v.callOptions.interceptor_providers)&&void 0!==g?g:[]},T=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=T;let C=null,w=!1,E=Error();return T.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==C&&T.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),C=e},onReceiveStatus(e){if(!w){if(w=!0,e.code===a.Status.OK){if(null===C){let t=p(E);v.callback((0,r.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,C)}else{let t=p(E);v.callback((0,r.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let n,r;return e instanceof o.Metadata?(n=e,r=t||{}):(r=e||{},n=new o.Metadata),{metadata:n,options:r}}makeServerStreamRequest(e,t,n,i,s,o){var f,g;let m=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:n},v={argument:i,metadata:m.metadata,call:new r.ClientReadableStreamImpl(n),channel:this[u],methodDefinition:y,callOptions:m.options};this[d]&&(v=this[d](v));let b=v.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(f=v.callOptions.interceptors)&&void 0!==f?f:[],callInterceptorProviders:null!==(g=v.callOptions.interceptor_providers)&&void 0!==g?g:[]},T=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=T;let C=!1,w=Error();return T.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!C){if(C=!0,b.push(null),e.code!==a.Status.OK){let t=p(w);b.emit("error",(0,r.callErrorFromStatus)(e,t))}w=null,b.emit("status",e)}}}),T.sendMessage(i),T.halfClose(),b}makeBidiStreamRequest(e,t,n,i,s){var o,f;let g=this.checkMetadataAndOptions(i,s),m={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:n},y={metadata:g.metadata,call:new r.ClientDuplexStreamImpl(t,n),channel:this[u],methodDefinition:m,callOptions:g.options};this[d]&&(y=this[d](y));let v=y.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(o=y.callOptions.interceptors)&&void 0!==o?o:[],callInterceptorProviders:null!==(f=y.callOptions.interceptor_providers)&&void 0!==f?f:[]},S=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=S;let T=!1,C=Error();return S.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!T){if(T=!0,v.push(null),e.code!==a.Status.OK){let t=p(C);v.emit("error",(0,r.callErrorFromStatus)(e,t))}C=null,v.emit("status",e)}}}),v}}t.Client=g},59286:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(n||(t.CompressionAlgorithms=n={}))},44299:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionFilterFactory=t.CompressionFilter=void 0;let r=n(59796),i=n(59286),s=n(32678),a=n(78152),o=n(97504),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let n=e;t&&(n=await this.compressMessage(n));let r=Buffer.allocUnsafe(n.length+5);return r.writeUInt8(t?1:0,0),r.writeUInt32BE(n.length,1),n.copy(r,5),r}async readMessage(e){let t=1===e.readUInt8(0),n=e.slice(5);return t&&(n=await this.decompressMessage(n)),n}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){let n=Buffer.allocUnsafe(e.length+5);return n.writeUInt8(0,0),n.writeUInt32BE(e.length,1),e.copy(n,5),n}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends u{compressMessage(e){return new Promise((t,n)=>{r.deflate(e,(e,r)=>{e?n(e):t(r)})})}decompressMessage(e){return new Promise((t,n)=>{r.inflate(e,(e,r)=>{e?n(e):t(r)})})}}class d extends u{compressMessage(e){return new Promise((t,n)=>{r.gzip(e,(e,r)=>{e?n(e):t(r)})})}decompressMessage(e){return new Promise((t,n)=>{r.unzip(e,(e,r)=>{e?n(e):t(r)})})}}class f extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function p(e){switch(e){case"identity":return new c;case"deflate":return new h;case"gzip":return new d;default:return new f(e)}}class g extends a.BaseFilter{constructor(e,t){var n;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";let r=e["grpc.default_compression_algorithm"];if(void 0!==r){if(l(r)){let e=i.CompressionAlgorithms[r],s=null===(n=t.serverSupportedEncodingHeader)||void 0===n?void 0:n.split(",");(!s||s.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=p(this.currentCompressionAlgorithm))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${r}`)}}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=p(e))}e.remove("grpc-encoding");let n=e.get("grpc-accept-encoding")[0];return n&&(this.sharedFilterConfig.serverSupportedEncodingHeader=n,n.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let n;let r=await e;return n=!(this.sendCompression instanceof c)&&((null!==(t=r.flags)&&void 0!==t?t:0)&2)==0,{message:await this.sendCompression.writeMessage(r.message,n),flags:r.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}t.CompressionFilter=g;class m{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new g(this.options,this.sharedFilterConfig)}}t.CompressionFilterFactory=m},33955:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(n||(t.ConnectivityState=n={}))},32678:(e,t)=>{var n,r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=t.Propagate=t.LogVerbosity=t.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(n||(t.Status=n={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(r||(t.LogVerbosity=r={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(i||(t.Propagate=i={})),t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},82155:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.restrictControlPlaneStatusCode=void 0;let r=n(32678),i=[r.Status.OK,r.Status.INVALID_ARGUMENT,r.Status.NOT_FOUND,r.Status.ALREADY_EXISTS,r.Status.FAILED_PRECONDITION,r.Status.ABORTED,r.Status.OUT_OF_RANGE,r.Status.DATA_LOSS];function s(e,t){return i.includes(e)?{code:r.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${r.Status[e]} ${t}`}:{code:e,details:t}}t.restrictControlPlaneStatusCode=s},7931:(e,t)=>{function n(...e){let t=1/0;for(let n of e){let e=n instanceof Date?n.getTime():n;e<t&&(t=e)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.deadlineToString=t.getRelativeTimeout=t.getDeadlineTimeoutString=t.minDeadline=void 0,t.minDeadline=n;let r=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function i(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let n=Math.max(e-t,0);for(let[e,t]of r){let r=n/t;if(r<1e8)return String(Math.ceil(r))+e}throw Error("Deadline is too far in the future")}t.getDeadlineTimeoutString=i;let s=2147483647;function a(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>s?1/0:t}function o(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}t.getRelativeTimeout=a,t.deadlineToString=o},95330:(e,t)=>{function n(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}}function r(e){return 1e3*e.seconds+e.nanos/1e6|0}function i(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}Object.defineProperty(t,"__esModule",{value:!0}),t.isDuration=t.durationToMs=t.msToDuration=void 0,t.msToDuration=n,t.durationToMs=r,t.isDuration=i},75437:(e,t)=>{function n(e){return e instanceof Error?e.message:String(e)}function r(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCode=t.getErrorMessage=void 0,t.getErrorMessage=n,t.getErrorCode=r},30345:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OutlierDetectionLoadBalancingConfig=t.BaseSubchannelWrapper=t.registerAdminService=t.FilterStackFactory=t.BaseFilter=t.PickResultType=t.QueuePicker=t.UnavailablePicker=t.ChildLoadBalancerHandler=t.subchannelAddressToString=t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.registerLoadBalancerType=t.createChildChannelControlHelper=t.BackoffTimeout=t.durationToMs=t.uriToString=t.createResolver=t.registerResolver=t.log=t.trace=void 0;var r=n(97504);Object.defineProperty(t,"trace",{enumerable:!0,get:function(){return r.trace}}),Object.defineProperty(t,"log",{enumerable:!0,get:function(){return r.log}});var i=n(40492);Object.defineProperty(t,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(t,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=n(18429);Object.defineProperty(t,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=n(95330);Object.defineProperty(t,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=n(84934);Object.defineProperty(t,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=n(27176);Object.defineProperty(t,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(t,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(t,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(t,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var u=n(23906);Object.defineProperty(t,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});var c=n(982);Object.defineProperty(t,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});var h=n(17064);Object.defineProperty(t,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(t,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(t,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=n(78152);Object.defineProperty(t,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var f=n(2472);Object.defineProperty(t,"FilterStackFactory",{enumerable:!0,get:function(){return f.FilterStackFactory}});var p=n(59601);Object.defineProperty(t,"registerAdminService",{enumerable:!0,get:function(){return p.registerAdminService}});var g=n(21407);Object.defineProperty(t,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return g.BaseSubchannelWrapper}});var m=n(81433);Object.defineProperty(t,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return m.OutlierDetectionLoadBalancingConfig}})},2472:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FilterStackFactory=t.FilterStack=void 0;class n{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}t.FilterStack=n;class r{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new r([...this.factories])}createFilter(){return new n(this.factories.map(e=>e.createFilter()))}}t.FilterStackFactory=r},78152:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFilter=void 0;class n{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}t.BaseFilter=n},82039:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getProxiedConnection=t.mapProxyName=void 0;let r=n(97504),i=n(32678),s=n(40492),a=n(13685),o=n(24404),l=n(97504),u=n(23906),c=n(18429),h=n(57310),d="proxy";function f(e){l.trace(i.LogVerbosity.DEBUG,d,e)}function p(){let e,t="",n="";if(process.env.grpc_proxy)n="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)n="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};n="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return(0,r.log)(i.LogVerbosity.ERROR,`cannot parse value of "${n}" env var`),{}}if("http:"!==e.protocol)return(0,r.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,r.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),f("Proxy server "+l.address+" set by environment variable "+n),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(f("No proxy server list set by environment variable "+t),e.split(",")):[]}function m(e,t){var n;let r={target:e,extraOptions:{}};if((null!==(n=t["grpc.enable_http_proxy"])&&void 0!==n?n:1)===0||"unix"===e.scheme)return r;let i=p();if(!i.address)return r;let s=(0,c.splitHostPort)(e.path);if(!s)return r;let a=s.host;for(let t of g())if(t===a)return f("Not using proxy for target in no_proxy list: "+(0,c.uriToString)(e)),r;let o={"grpc.http_connect_target":(0,c.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}}function y(e,t,n){if(!("grpc.http_connect_target"in t))return Promise.resolve({});let l=t["grpc.http_connect_target"],h=(0,c.parseUri)(l);if(null===h)return Promise.resolve({});let d={method:"CONNECT",path:h.path},p={Host:h.path};(0,u.isTcpSubchannelAddress)(e)?(d.host=e.host,d.port=e.port):d.socketPath=e.path,"grpc.http_connect_creds"in t&&(p["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),d.headers=p;let g=(0,u.subchannelAddressToString)(e);return f("Using proxy "+g+" to connect to "+d.path),new Promise((e,t)=>{let l=a.request(d);l.once("connect",(a,u,p)=>{var m;if(l.removeAllListeners(),u.removeAllListeners(),200===a.statusCode){if(f("Successfully connected to "+d.path+" through proxy "+g),"secureContext"in n){let r=(0,s.getDefaultAuthority)(h),i=(0,c.splitHostPort)(r),a=null!==(m=null==i?void 0:i.host)&&void 0!==m?m:r,l=o.connect(Object.assign({host:a,servername:a,socket:u},n),()=>{f("Successfully established a TLS connection to "+d.path+" through proxy "+g),e({socket:l,realTarget:h})});l.on("error",e=>{f("Failed to establish a TLS connection to "+d.path+" through proxy "+g+" with error "+e.message),t()})}else f("Successfully established a plaintext connection to "+d.path+" through proxy "+g),e({socket:u,realTarget:h})}else(0,r.log)(i.LogVerbosity.ERROR,"Failed to connect to "+d.path+" through proxy "+g+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,r.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+g+" with error "+e.message),t()}),l.end()})}t.mapProxyName=m,t.getProxiedConnection=y},22165:(e,t,n)=>{m={value:!0},m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=m=t.Rz=m=m=m=m=m=m=t.SF=t.K9=void 0;let r=n(78931);m={enumerable:!0,get:function(){return r.CallCredentials}};let i=n(46261);m={enumerable:!0,get:function(){return i.ChannelImplementation}};let s=n(59286);m={enumerable:!0,get:function(){return s.CompressionAlgorithms}};let a=n(33955);m={enumerable:!0,get:function(){return a.ConnectivityState}};let o=n(92528);m={enumerable:!0,get:function(){return o.ChannelCredentials}};let l=n(69800);m={enumerable:!0,get:function(){return l.Client}};let u=n(32678);m={enumerable:!0,get:function(){return u.LogVerbosity}},m={enumerable:!0,get:function(){return u.Status}},m={enumerable:!0,get:function(){return u.Propagate}};let c=n(97504),h=n(35085);Object.defineProperty(t,"Rz",{enumerable:!0,get:function(){return h.loadPackageDefinition}}),m={enumerable:!0,get:function(){return h.makeClientConstructor}},m={enumerable:!0,get:function(){return h.makeClientConstructor}};let d=n(62252);Object.defineProperty(t,"SF",{enumerable:!0,get:function(){return d.Metadata}});let f=n(57691);m={enumerable:!0,get:function(){return f.Server}};let p=n(74181);m={enumerable:!0,get:function(){return p.ServerCredentials}};let g=n(39932);m={enumerable:!0,get:function(){return g.StatusBuilder}},t.K9={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:r.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:r.CallCredentials.createFromGoogleCredential,createEmpty:r.CallCredentials.createEmpty},m=e=>e.close(),m=(e,t,n)=>e.waitForReady(t,n),m=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},m=(e,t,n)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},m=e=>{c.setLogger(e)},m=e=>{c.setLoggerVerbosity(e)},m=e=>l.Client.prototype.getChannel.call(e);var m,y=n(68601);m={enumerable:!0,get:function(){return y.ListenerBuilder}},m={enumerable:!0,get:function(){return y.RequesterBuilder}},m={enumerable:!0,get:function(){return y.InterceptingCall}},m={enumerable:!0,get:function(){return y.InterceptorConfigurationError}};var v=n(5993);m={enumerable:!0,get:function(){return v.getChannelzServiceDefinition}},m={enumerable:!0,get:function(){return v.getChannelzHandlers}};var b=n(59601);m={enumerable:!0,get:function(){return b.addAdminServicesToServer}},m=n(30345);let S=n(54605),T=n(45862),C=n(53562),w=n(56170),E=n(62255),I=n(81433),_=n(5993);(()=>{S.setup(),T.setup(),C.setup(),w.setup(),E.setup(),I.setup(),_.setup()})()},21118:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InternalChannel=void 0;let r=n(92528),i=n(82380),s=n(42328),a=n(17064),o=n(32678),l=n(2472),u=n(44299),c=n(40492),h=n(97504),d=n(25538),f=n(82039),p=n(18429),g=n(33955),m=n(5993),y=n(60980),v=n(7931),b=n(63003),S=n(38445),T=n(82155),C=n(44398),w=n(21407),E=2147483647,I=1e3,_=18e5,R=new Map,k=16777216,A=1048576;class D extends w.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,n,r,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class x{constructor(e,t,n){var y,v,b,S,w,x,N,O;if(this.credentials=t,this.options=n,this.connectivityState=g.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof r.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(n&&"object"!=typeof n)throw TypeError("Channel options must be an object");this.originalTarget=e;let M=(0,p.parseUri)(e);if(null===M)throw Error(`Could not parse target name "${e}"`);let P=(0,c.mapUriDefaultScheme)(M);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},E),null===(v=(y=this.callRefTimer).unref)||void 0===v||v.call(y),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,c.getDefaultAuthority)(P);let L=(0,f.mapProxyName)(P,n);this.target=L.target,this.options=Object.assign({},this.options,L.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!==(b=n["grpc.use_local_subchannel_pool"])&&void 0!==b?b:0)===0),this.retryBufferTracker=new C.MessageBufferTracker(null!==(S=n["grpc.retry_buffer_size"])&&void 0!==S?S:k,null!==(w=n["grpc.per_rpc_retry_buffer_size"])&&void 0!==w?w:A),this.keepaliveTime=null!==(x=n["grpc.keepalive_time_ms"])&&void 0!==x?x:-1,this.idleTimeoutMs=Math.max(null!==(N=n["grpc.client_idle_timeout_ms"])&&void 0!==N?N:_,I);let B={createSubchannel:(e,t)=>{let n=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);n.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",n.getChannelzRef());let r=new D(n,this);return this.wrappedSubchannels.add(r),r},updateState:(e,t)=>{this.currentPicker=t;let n=this.pickQueue.slice();for(let e of(this.pickQueue=[],this.callRefTimerUnref(),n))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,B,n,(e,t)=>{e.retryThrottling?R.set(this.getTarget(),new C.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,R.get(this.getTarget()))):R.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],this.callRefTimerUnref(),e))t.getConfig();this.configSelectionQueue=[]})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,T.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let n of(this.configSelectionQueue=[],this.callRefTimerUnref(),t))n.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new d.MaxMessageSizeFilterFactory(this.options),new u.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(n,void 0,2));let F=Error();(0,h.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(O=F.stack)||void 0===O?void 0:O.substring(F.stack.indexOf("\n")+1)))}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,h.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,n,r;(null===(t=(e=this.callRefTimer).hasRef)||void 0===t?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(r=(n=this.callRefTimer).ref)||void 0===r||r.call(n))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(t=(e=this.callRefTimer).unref)||void 0===t||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,h.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+g.ConnectivityState[this.connectivityState]+" -> "+g.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+g.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==g.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(g.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer)}maybeStartIdleTimer(){var e,t;0===this.callCount&&(this.idleTimer=setTimeout(()=>{this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()},this.idleTimeoutMs),null===(t=(e=this.idleTimer).unref)||void 0===t||t.call(e))}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1,this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,n,r,i){let s=(0,S.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new y.LoadBalancingCall(this,e,t,n,r,i,s)}createRetryingCall(e,t,n,r,i){let s=(0,S.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new C.RetryingCall(this,e,t,n,r,i,s,this.retryBufferTracker,R.get(this.getTarget()))}createInnerCall(e,t,n,r,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,n,r,i):this.createRetryingCall(e,t,n,r,i)}createResolvingCall(e,t,n,r,i){let s=(0,S.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,v.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=n?n:this.defaultAuthority,parentCall:r},l=new b.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(g.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,p.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,n){if(this.connectivityState===g.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let r=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s){process.nextTick(n,Error("Deadline passed without connectivity state change"));return}r=setTimeout(()=>{this.removeConnectivityStateWatcher(i),n(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:n,timer:r};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,n,r,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===g.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,n,r,i)}}t.InternalChannel=x},982:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChildLoadBalancerHandler=void 0;let r=n(27176),i=n(33955),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var n;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null===(n=this.parent.currentChild)||void 0===n||n.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!==(e=this.parent.pendingChild)&&void 0!==e?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,n){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),n=(0,r.createLoadBalancer)(t,e);e.setChild(n),null===this.currentChild?(this.currentChild=n,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=n,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,n)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}t.ChildLoadBalancerHandler=a},81433:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.OutlierDetectionLoadBalancer=t.OutlierDetectionLoadBalancingConfig=void 0;let i=n(33955),s=n(32678),a=n(95330),o=n(30345),l=n(27176),u=n(982),c=n(17064),h=n(23906),d=n(21407),f=n(97504),p="outlier_detection";function g(e){f.trace(s.LogVerbosity.DEBUG,p,e)}let m="outlier_detection",y=(null!==(r=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==r?r:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function S(e,t,n,r){if(t in e&&typeof e[t]!==n){let i=r?`${r}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${n}, got ${typeof e[t]}`)}}function T(e,t,n){let r=n?`${n}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=999999999))throw Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function C(e,t,n){let r=n?`${n}.${t}`:t;if(S(e,t,"number",n),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}class w{constructor(e,t,n,r,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=n?n:3e5,this.maxEjectionPercent=null!=r?r:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return m}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new w(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(T(e,"interval"),T(e,"base_ejection_time"),T(e,"max_ejection_time"),C(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");S(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),C(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),S(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),S(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");C(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),C(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),S(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),S(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new w(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!==(t=e.max_ejection_percent)&&void 0!==t?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}t.OutlierDetectionLoadBalancingConfig=w;class E extends d.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,n,r)=>{if(this.childSubchannelState=n,!this.ejected)for(let e of this.stateListeners)e(this,t,n,r)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function I(){return{success:0,failure:0}}class _{constructor(){this.activeBucket=I(),this.inactiveBucket=I()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=I()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class R{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==c.PickResultType.COMPLETE)return t;{let e=t.subchannel,n=e.getMapEntry();if(!n)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let r=t.onCallEnded;return this.countCalls&&(r=e=>{var r;e===s.Status.OK?n.counter.addSuccess():n.counter.addFailure(),null===(r=t.onCallEnded)||void 0===r||r.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:r})}}}}class k{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new u.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,n)=>{let r=e.createSubchannel(t,n),i=this.addressMap.get((0,h.subchannelAddressToString)(t)),s=new E(r,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,n)=>{t===i.ConnectivityState.READY?e.updateState(t,new R(n,this.isCountingEnabled())):e.updateState(t,n)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;g("Running success rate check");let n=t.request_volume,r=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();g("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+n),s+a>=n&&(r+=1,i.push(s/(s+a)))}if(g("Found "+r+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),r<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-t.stdev_factor/1e3*o;for(let[r,i]of(g("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<n)continue;let o=s/(s+a);if(g("Checking candidate "+r+" successRate="+o),o<l){let n=100*Math.random();g("Candidate "+r+" randomNumber="+n+" enforcement_percentage="+t.enforcement_percentage),n<t.enforcement_percentage&&(g("Ejecting candidate "+r),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;g("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let n=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(n+=1);if(!(n<t.minimum_hosts))for(let[n,r]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=r.counter.getLastSuccesses(),s=r.counter.getLastFailures();if(g("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume)&&100*s/(s+i)>t.threshold){let i=100*Math.random();g("Candidate "+n+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(g("Ejecting candidate "+n),this.eject(r,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,n;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null===(n=(t=this.ejectionTimer).unref)||void 0===n||n.call(t)}runChecks(){let e=new Date;if(g("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,n]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===n.currentEjectionTimestamp)n.ejectionTimeMultiplier>0&&(n.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),r=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(n.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*n.ejectionTimeMultiplier,Math.max(e,r))),i<new Date&&(g("Unejecting "+t),this.uneject(n))}}updateAddressList(e,t,n){if(!(t instanceof w))return;let r=new Set;for(let t of e)r.add((0,h.subchannelAddressToString)(t));for(let e of r)this.addressMap.has(e)||(g("Adding map entry for "+e),this.addressMap.set(e,{counter:new _,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())r.has(e)||(g("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,n),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig()){if(this.timerStartTime){g("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else g("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets()}else for(let e of(g("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return m}}function A(){y&&(0,o.registerLoadBalancerType)(m,k,w)}t.OutlierDetectionLoadBalancer=k,t.setup=A},56170:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.PickFirstLoadBalancer=t.shuffled=t.PickFirstLoadBalancingConfig=void 0;let r=n(27176),i=n(33955),s=n(17064),a=n(97504),o=n(32678),l="pick_first";function u(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let c="pick_first",h=250;class d{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return c}toJsonObject(){return{[c]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new d(!0===e.shuffleAddressList)}}t.PickFirstLoadBalancingConfig=d;class f{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function p(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let n=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}return t}t.shuffled=p;class g{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,n,r,i)=>{this.onSubchannelStateUpdate(e,t,n,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new f(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,n,r){var s;if(null===(s=this.currentPick)||void 0===s?void 0:s.realSubchannelEquals(e)){n!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){n===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),n===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,r&&(this.lastError=r),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,n]of this.children.entries())if(t>=e){let e=n.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,n;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(u("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null===(t=this.children[e])||void 0===t||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null===(n=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},h)).unref)||void 0===n?void 0:n.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(u("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)e.subchannel!==this.currentPick&&e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}updateAddressList(e,t){if(!(t instanceof d))return;t.getShuffleAddressList()&&(e=p(e));let n=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of n)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=n,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY){this.pickSubchannel(e);return}for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}exitIdle(){}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return c}}function m(){(0,r.registerLoadBalancerType)(c,g,d),(0,r.registerDefaultLoadBalancerType)(c)}t.PickFirstLoadBalancer=g,t.setup=m},62255:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.RoundRobinLoadBalancer=void 0;let r=n(27176),i=n(33955),s=n(17064),a=n(23906),o=n(97504),l=n(32678),u="round_robin";function c(e){o.trace(l.LogVerbosity.DEBUG,u,e)}let h="round_robin";class d{getLoadBalancerName(){return h}constructor(){}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class f{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class p{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,n,r,s)=>{this.calculateAndUpdateState(),(n===i.ConnectivityState.TRANSIENT_FAILURE||n===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new f(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}function g(){(0,r.registerLoadBalancerType)(h,p,d)}t.RoundRobinLoadBalancer=p,t.setup=g},27176:(e,t)=>{function n(e,t){var n,r,i,s,a,o,l,u,c,h;return{createSubchannel:null!==(r=null===(n=t.createSubchannel)||void 0===n?void 0:n.bind(t))&&void 0!==r?r:e.createSubchannel.bind(e),updateState:null!==(s=null===(i=t.updateState)||void 0===i?void 0:i.bind(t))&&void 0!==s?s:e.updateState.bind(e),requestReresolution:null!==(o=null===(a=t.requestReresolution)||void 0===a?void 0:a.bind(t))&&void 0!==o?o:e.requestReresolution.bind(e),addChannelzChild:null!==(u=null===(l=t.addChannelzChild)||void 0===l?void 0:l.bind(t))&&void 0!==u?u:e.addChannelzChild.bind(e),removeChannelzChild:null!==(h=null===(c=t.removeChannelzChild)||void 0===c?void 0:c.bind(t))&&void 0!==h?h:e.removeChannelzChild.bind(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.isLoadBalancerNameRegistered=t.createLoadBalancer=t.registerDefaultLoadBalancerType=t.registerLoadBalancerType=t.createChildChannelControlHelper=void 0,t.createChildChannelControlHelper=n;let r={},i=null;function s(e,t,n){r[e]={LoadBalancer:t,LoadBalancingConfig:n}}function a(e){i=e}function o(e,t){let n=e.getLoadBalancerName();return n in r?new r[n].LoadBalancer(t):null}function l(e){return e in r}function u(e,t=!1){for(let t of e)if(t.getLoadBalancerName() in r)return t;return t&&i?new r[i].LoadBalancingConfig:null}function c(e){if(!(null!==e&&"object"==typeof e))throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let n=t[0];if(n in r)return r[n].LoadBalancingConfig.createFromJson(e[n]);throw Error(`Unrecognized load balancing config name ${n}`)}t.registerLoadBalancerType=s,t.registerDefaultLoadBalancerType=a,t.createLoadBalancer=o,t.isLoadBalancerNameRegistered=l,t.getFirstUsableConfig=u,t.validateLoadBalancingConfig=c},60980:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LoadBalancingCall=void 0;let r=n(33955),i=n(32678),s=n(7931),a=n(62252),o=n(17064),l=n(18429),u=n(97504),c=n(82155),h=n(85158),d="load_balancing_call";class f{constructor(e,t,n,r,i,s,a){var o,u;this.channel=e,this.callConfig=t,this.methodName=n,this.host=r,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let c=this.methodName.split("/"),h="";c.length>=2&&(h=c[1]);let d=null!==(u=null===(o=(0,l.splitHostPort)(this.host))||void 0===o?void 0:o.host)&&void 0!==u?u:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){u.trace(i.LogVerbosity.DEBUG,d,"["+this.callNumber+"] "+e)}outputStatus(e,t){var n,r;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null===(n=this.listener)||void 0===n||n.onReceiveStatus(i),null===(r=this.onCallEnded)||void 0===r||r.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let n=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=n.subchannel?"("+n.subchannel.getChannelzRef().id+") "+n.subchannel.getAddress():""+n.subchannel;switch(this.trace("Pick result: "+o.PickResultType[n.pickResultType]+" subchannel: "+l+" status: "+(null===(e=n.status)||void 0===e?void 0:e.code)+" "+(null===(t=n.status)||void 0===t?void 0:t.details)),n.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let c=this.metadata.clone();if(c.merge(e),c.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),n.subchannel.getConnectivityState()!==r.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+r.ConnectivityState[n.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&c.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=n.subchannel.getRealSubchannel().createCall(c,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===h.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null===(o=(t=this.callConfig).onCommitted)||void 0===o||o.call(t),null===(u=n.onCallStarted)||void 0===u||u.call(n),this.onCallEnded=n.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:n}=(0,c.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:n,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:u,details:d}=(0,c.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:u,details:d,metadata:n.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,c.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:n.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var n;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(n=this.child)||void 0===n||n.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}t.LoadBalancingCall=f},97504:(e,t,n)=>{var r,i,s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.isTracerEnabled=t.trace=t.log=t.setLoggerVerbosity=t.setLogger=t.getLogger=void 0;let o=n(32678),l=n(77282),u=n(81513).i8,c={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},h=o.LogVerbosity.ERROR;switch((null!==(i=null!==(r=process.env.GRPC_NODE_VERBOSITY)&&void 0!==r?r:process.env.GRPC_VERBOSITY)&&void 0!==i?i:"").toUpperCase()){case"DEBUG":h=o.LogVerbosity.DEBUG;break;case"INFO":h=o.LogVerbosity.INFO;break;case"ERROR":h=o.LogVerbosity.ERROR;break;case"NONE":h=o.LogVerbosity.NONE}let d=()=>c;t.getLogger=d;let f=e=>{c=e};t.setLogger=f;let p=e=>{h=e};t.setLoggerVerbosity=p;let g=(e,...t)=>{let n;if(e>=h){switch(e){case o.LogVerbosity.DEBUG:n=c.debug;break;case o.LogVerbosity.INFO:n=c.info;break;case o.LogVerbosity.ERROR:n=c.error}n||(n=c.error),n&&n.bind(c)(...t)}};t.log=g;let m=null!==(a=null!==(s=process.env.GRPC_NODE_TRACE)&&void 0!==s?s:process.env.GRPC_TRACE)&&void 0!==a?a:"",y=new Set,v=new Set;for(let e of m.split(","))e.startsWith("-")?v.add(e.substring(1)):y.add(e);let b=y.has("all");function S(e,n,r){T(n)&&(0,t.log)(e,new Date().toISOString()+" | v"+u+" "+l.pid+" | "+n+" | "+r)}function T(e){return!v.has(e)&&(b||y.has(e))}t.trace=S,t.isTracerEnabled=T},35085:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadPackageDefinition=t.makeClientConstructor=void 0;let r=n(69800),i={unary:r.Client.prototype.makeUnaryRequest,server_stream:r.Client.prototype.makeServerStreamRequest,client_stream:r.Client.prototype.makeClientStreamRequest,bidi:r.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,n){n||(n={});class a extends r.Client{}return Object.keys(e).forEach(t=>{let n;if(s(t))return;let r=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");n=r.requestStream?r.responseStream?"bidi":"client_stream":r.responseStream?"server_stream":"unary";let l=r.requestSerialize,u=r.responseDeserialize,c=o(i[n],r.path,l,u);a.prototype[t]=c,Object.assign(a.prototype[t],r),r.originalName&&!s(r.originalName)&&(a.prototype[r.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,n,r){return function(...i){return e.call(this,t,n,r,...i)}}function l(e){return"format"in e}function u(e){let t={};for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n],i=n.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],u=t;for(let e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(r)?u[o]=r:u[o]=a(r,o,{})}return t}t.makeClientConstructor=a,t.loadPackageDefinition=u},25538:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MaxMessageSizeFilterFactory=t.MaxMessageSizeFilter=void 0;let r=n(78152),i=n(32678),s=n(62252);class a extends r.BaseFilter{constructor(e){super(),this.maxSendMessageSize=i.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=i.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}async sendMessage(e){if(-1===this.maxSendMessageSize)return e;{let t=await e;if(!(t.message.length>this.maxSendMessageSize))return t;throw{code:i.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new s.Metadata}}}async receiveMessage(e){if(-1===this.maxReceiveMessageSize)return e;{let t=await e;if(!(t.length>this.maxReceiveMessageSize))return t;throw{code:i.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new s.Metadata}}}}t.MaxMessageSizeFilter=a;class o{constructor(e){this.options=e}createFilter(){return new a(this.options)}}t.MaxMessageSizeFilterFactory=o},62252:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;let r=n(97504),i=n(32678),s=n(75437),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function u(e){return o.test(e)}function c(e){return e.endsWith("-bin")}function h(e){return!e.startsWith("grpc-")}function d(e){return e.toLowerCase()}function f(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t){if(c(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!u(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}}class p{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){f(e=d(e),t),this.internalRepr.set(e,[t])}add(e,t){f(e=d(e),t);let n=this.internalRepr.get(e);void 0===n?this.internalRepr.set(e,[t]):n.push(t)}remove(e){e=d(e),this.internalRepr.delete(e)}get(e){return e=d(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,n]of this.internalRepr)if(n.length>0){let r=n[0];e[t]=Buffer.isBuffer(r)?Buffer.from(r):r}return e}clone(){let e=new p(this.options),t=e.internalRepr;for(let[e,n]of this.internalRepr){let r=n.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,r)}return e}merge(e){for(let[t,n]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(n);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,n]of this.internalRepr)e[t]=n.map(g);return e}toJSON(){let e={};for(let[t,n]of this.internalRepr)e[t]=n;return e}static fromHttp2Headers(e){let t=new p;for(let n of Object.keys(e)){if(":"===n.charAt(0))continue;let a=e[n];try{c(n)?Array.isArray(a)?a.forEach(e=>{t.add(n,Buffer.from(e,"base64"))}):void 0!==a&&(h(n)?a.split(",").forEach(e=>{t.add(n,Buffer.from(e.trim(),"base64"))}):t.add(n,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(n,e)}):void 0!==a&&t.add(n,a)}catch(t){let e=`Failed to add metadata entry ${n}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,r.log)(i.LogVerbosity.ERROR,e)}}return t}}t.Metadata=p;let g=e=>Buffer.isBuffer(e)?e.toString("base64"):e},17064:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.QueuePicker=t.UnavailablePicker=t.PickResultType=void 0;let i=n(62252),s=n(32678);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(r||(t.PickResultType=r={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:r.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}t.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:r.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}t.QueuePicker=o},54605:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(40492),i=n(9523),s=n(73837),a=n(26262),o=n(32678),l=n(62252),u=n(97504),c=n(32678),h=n(18429),d=n(41808),f=n(84934),p="dns_resolver";function g(e){u.trace(c.LogVerbosity.DEBUG,p,e)}let m=443,y=3e4,v=s.promisify(i.resolveTxt),b=s.promisify(i.lookup);function S(...e){let t=[];for(let n=0;n<Math.max.apply(null,e.map(e=>e.length));n++)for(let r of e)n<r.length&&t.push(r[n]);return t}class T{constructor(e,t,n){var r,i,s;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,g("Resolver constructed for target "+(0,h.uriToString)(e));let a=(0,h.splitHostPort)(e.path);null===a?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,d.isIPv4)(a.host)||(0,d.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:null!==(r=a.port)&&void 0!==r?r:m}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=null!==(i=a.port)&&void 0!==i?i:m),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata};let u={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new f.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},u),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(s=n["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==s?s:y,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){g("Returning IP address for target "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)g("Failed to parse DNS address "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;g("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=b(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),n=e.filter(e=>6===e.family);this.latestLookupResult=S(n,t).map(e=>({host:e.address,port:+this.port}));let r="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";if(g("Resolved addresses for target "+(0,h.uriToString)(this.target)+": "+r),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(g("Resolution error for target "+(0,h.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=v(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===t?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?g('resolution update delayed by "min time between resolutions" rate limit'):g("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null}static getDefaultAuthority(e){return e.path}}function C(){(0,r.registerResolver)("dns",T),(0,r.registerDefaultScheme)("dns")}t.setup=C},53562:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(41808),i=n(32678),s=n(62252),a=n(40492),o=n(18429),l=n(97504),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}let h="ipv4",d="ipv6",f=443;class p{constructor(e,t,n){var a;this.listener=t,this.addresses=[],this.error=null,c("Resolver constructed for target "+(0,o.uriToString)(e));let l=[];if(!(e.scheme===h||e.scheme===d)){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(let t of e.path.split(",")){let n=(0,o.splitHostPort)(t);if(null===n||e.scheme===h&&!(0,r.isIPv4)(n.host)||e.scheme===d&&!(0,r.isIPv6)(n.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:n.host,port:null!==(a=n.port)&&void 0!==a?a:f})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})})}destroy(){}static getDefaultAuthority(e){return e.path.split(",")[0]}}function g(){(0,a.registerResolver)(h,p),(0,a.registerResolver)(d,p)}t.setup=g},45862:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(40492);class i{constructor(e,t,n){let r;this.listener=t,this.addresses=[],r=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:r}]}updateResolution(){process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{})}destroy(){}static getDefaultAuthority(e){return"localhost"}}function s(){(0,r.registerResolver)("unix",i)}t.setup=s},40492:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapUriDefaultScheme=t.getDefaultAuthority=t.createResolver=t.registerDefaultScheme=t.registerResolver=void 0;let r=n(18429),i={},s=null;function a(e,t){i[e]=t}function o(e){s=e}function l(e,t,n){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,n);throw Error(`No resolver could be created for target ${(0,r.uriToString)(e)}`)}function u(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,r.uriToString)(e)}`)}function c(e){return void 0!==e.scheme&&e.scheme in i?e:null!==s?{scheme:s,authority:void 0,path:(0,r.uriToString)(e)}:null}t.registerResolver=a,t.registerDefaultScheme=o,t.createResolver=l,t.getDefaultAuthority=u,t.mapUriDefaultScheme=c},63003:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingCall=void 0;let r=n(32678),i=n(7931),s=n(62252),a=n(97504),o=n(82155),l="resolving_call";class u{constructor(e,t,n,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=n.deadline,this.host=n.host,n.parentCall&&(n.flags&r.Propagate.CANCELLATION&&n.parentCall.on("cancelled",()=>{this.cancelWithStatus(r.Status.CANCELLED,"Cancelled by parent call")}),n.flags&r.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+n.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,n.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(r.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(r.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null===(e=this.listener)||void 0===e||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let n=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,n.sendMessageWithContext(e,t.message),this.pendingHalfClose&&n.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type){this.channel.queueCallForConfig(this);return}if("ERROR"===e.type){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==r.Status.OK){let{code:e,details:n}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:n,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null===(t=this.metadata)||void 0===t?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var n;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(n=this.child)||void 0===n||n.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}t.ResolvingCall=u},82380:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingLoadBalancer=void 0;let r=n(27176),i=n(26262),s=n(33955),a=n(40492),o=n(17064),l=n(84934),u=n(32678),c=n(62252),h=n(97504),d=n(32678),f=n(18429),p=n(982),g="resolving_load_balancer";function m(e){h.trace(d.LogVerbosity.DEBUG,g,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,n,r){for(let i of n.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,n,r){for(let i of n)if(v(e,t,i,r))return i;return null}function S(e){return function(t,n){var r,i;let s=t.split("/").filter(e=>e.length>0),a=null!==(r=s[0])&&void 0!==r?r:"",o=null!==(i=s[1])&&void 0!==i?i:"";if(e&&e.methodConfig)for(let t of y){let n=b(a,o,e.methodConfig,t);if(n)return{methodConfig:n,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class T{constructor(e,t,n,h,d){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,n["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(n["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new p.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(m("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,n,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===n?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(n):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!==(a=null==o?void 0:o.loadBalancingConfig)&&void 0!==a?a:[],h=(0,r.getFirstUsableConfig)(l,!0);if(null===h){this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});return}this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(d,null!=i?i:S(d))},onError:e=>{this.handleResolutionFailure(e)}},n);let f={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},f),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){m((0,f.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}t.ResolvingLoadBalancer=T},44398:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RetryingCall=t.MessageBufferTracker=t.RetryThrottler=void 0;let r=n(32678),i=n(62252),s=n(97504),a="retrying_call";class o{constructor(e,t,n){this.maxTokens=e,this.tokenRatio=t,n?this.tokens=n.tokens*(e/n.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}t.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var n;let r=null!==(n=this.allocatedPerCall.get(t))&&void 0!==n?n:0;return!(this.limitPerCall-r<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,r+e),this.totalAllocated+=e,!0)}free(e,t){var n;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let r=null!==(n=this.allocatedPerCall.get(t))&&void 0!==n?n:0;if(r<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${r}`);this.allocatedPerCall.set(t,r-e)}freeAll(e){var t;let n=null!==(t=this.allocatedPerCall.get(e))&&void 0!==t?t:0;if(this.totalAllocated<n)throw Error(`Invalid buffer allocation state: call ${e} allocated ${n} > total allocated ${this.totalAllocated}`);this.totalAllocated-=n,this.allocatedPerCall.delete(e)}}t.MessageBufferTracker=l;let u="grpc-previous-rpc-attempts";class c{constructor(e,t,n,r,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=n,this.host=r,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(r.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null===(t=this.listener)||void 0===t||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:n}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))n.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!==(t=this.writeBuffer[e-this.writeBufferOffset])&&void 0!==t?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(r.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[n,r]of this.underlyingCalls.entries())"ACTIVE"===r.state&&r.nextMessageToSend>e&&(e=r.nextMessageToSend,t=n);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===r.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null===(e=this.callConfig)||void 0===e?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let n=Math.random()*this.nextRetryBackoffSec*1e3,r=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,r),n}maybeRetryCall(e,t){let n;if("RETRY"!==this.state){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}if(null===e)n=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else n=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,n;if("RETRY"!==this.state){t(!1);return}(null===(n=null===(e=this.retryThrottler)||void 0===e?void 0:e.canRetryCall())||void 0===n||n)&&(t(!0),this.attempts+=1,this.startNewAttempt())},n)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,n){var r,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!==(r=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)&&void 0!==r?r:[],e.code)){let r;if(null===(i=this.retryThrottler)||void 0===i||i.addCallFailed(),null===n)r=0;else if(n<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else r=n;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},r)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null===(s=this.retryThrottler)||void 0===s||s.addCallFailed(),this.maybeRetryCall(n,n=>{n||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var n;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===r.Status.OK){null===(n=this.retryThrottler)||void 0===n||n.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,n;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let r=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(r.maxAttempts,5))return;let i=null!==(e=r.hedgingDelay)&&void 0!==e?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null===(n=(t=this.hedgingTimer).unref)||void 0===n||n.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let n=this.attempts-1,r=this.initialMetadata.clone();n>0&&r.set(u,`${n}`);let i=!1;e.start(r,{onReceiveMetadata:r=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,n>0&&r.set(u,`${n}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(r)},onReceiveMessage:n=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(n)},onReceiveStatus:r=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&n>0&&r.metadata.set(u,`${n}`),this.handleChildStatus(r,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,n;let r=this.underlyingCalls[e],i=r.nextMessageToSend;null===(n=(t=this.getBufferEntry(i)).callback)||void 0===n||n.call(t),this.clearSentMessages(),r.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let n=this.getBufferEntry(t.nextMessageToSend);switch(n.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},n.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var n;this.trace("write() called with message of length "+t.length);let r={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:r,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[r,s]of(null===(n=e.callback)||void 0===n||n.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(r)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let n=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===n.state&&n.nextMessageToSend===i&&n.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}t.RetryingCall=c},37061:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Http2ServerCallStream=t.ServerDuplexStreamImpl=t.ServerWritableStreamImpl=t.ServerReadableStreamImpl=t.ServerUnaryCallImpl=void 0;let r=n(82361),i=n(85158),s=n(12781),a=n(59796),o=n(73837),l=n(32678),u=n(62252),c=n(38326),h=n(97504),d=n(75437),f="server_call",p=(0,o.promisify)(a.unzip),g=(0,o.promisify)(a.inflate);function m(e){h.trace(l.LogVerbosity.DEBUG,f,e)}let y="grpc-message",v="grpc-status",b="grpc-timeout",S=/(\d{1,8})\s*([HMSmun])/,T={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},C={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},w={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},E={waitForTrailers:!0};class I extends r.EventEmitter{constructor(e,t,n){super(),this.call=e,this.metadata=t,this.request=n,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerUnaryCallImpl=I;class _ extends s.Readable{constructor(e,t,n,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=n,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,r)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerReadableStreamImpl=_;class R extends s.Writable{constructor(e,t,n,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=n,this.request=r,this.cancelled=!1,this.trailingMetadata=new u.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,n){try{let t=this.call.serializeMessage(e);if(!this.call.write(t)){this.call.once("drain",n);return}}catch(e){this.emit("error",{details:(0,d.getErrorMessage)(e),code:l.Status.INTERNAL})}n()}_final(e){this.call.sendStatus({code:l.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerWritableStreamImpl=R;class k extends s.Duplex{constructor(e,t,n,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=n,this.deserialize=r,this.cancelled=!1,this.trailingMetadata=new u.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerDuplexStreamImpl=k,k.prototype._read=_.prototype._read,k.prototype._write=R.prototype._write,k.prototype._final=R.prototype._final;class A extends r.EventEmitter{constructor(e,t,n){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=l.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=l.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;m("Request to method "+(null===(e=this.handler)||void 0===e?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:l.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in n&&(this.maxSendMessageSize=n["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in n&&(this.maxReceiveMessageSize=n["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return"deflate"===t?g(e.subarray(5)):"gzip"===t?p(e.subarray(5)):"identity"===t?e.subarray(5):Promise.reject({code:l.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,n=Object.assign(Object.assign(Object.assign({},w),C),t);this.stream.respond(n,E)}receiveMetadata(e){let t=u.Metadata.fromHttp2Headers(e);h.isTracerEnabled(f)&&m("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let n=t.get(b);if(n.length>0){let e=n[0].toString().match(S);if(null===e){let e=Error("Invalid deadline");return e.code=l.Status.OUT_OF_RANGE,this.sendError(e),t}let r=+e[1]*T[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+r),this.deadlineTimer=setTimeout(D,r,this),t.remove(b)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,n)=>{let{stream:r}=this,i=0,s=this,a=[],o=this.maxReceiveMessageSize;function u(e){if(i+=e.byteLength,-1!==o&&i>o){r.removeListener("data",u),r.removeListener("end",c),r.removeListener("error",c),n({code:l.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${o})`});return}a.push(e)}function c(o){if(r.removeListener("data",u),r.removeListener("end",c),r.removeListener("error",c),void 0!==o){n({code:l.Status.INTERNAL,details:o.message});return}if(0===i){n({code:l.Status.INTERNAL,details:"received empty unary message"});return}s.emit("receiveMessage");let h=Buffer.concat(a,i),d=1===h.readUInt8(0)?e:"identity",f=s.getDecompressedMessage(h,d);if(Buffer.isBuffer(f)){t(s.deserializeMessageWithInternalError(f));return}f.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>n(t.code?t:{code:l.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",u),this.stream.on("end",c),this.stream.on("error",c)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,d.getErrorMessage)(e),code:l.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),n=t.byteLength,r=Buffer.allocUnsafe(n+5);return r.writeUInt8(0,0),r.writeUInt32BE(n,1),t.copy(r,5),r}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,n,r){if(!this.checkCancelled()){if(void 0===n&&(n=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&n&&(e.metadata=n),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:l.Status.OK,details:"OK",metadata:n})}catch(e){this.sendError({details:(0,d.getErrorMessage)(e),code:l.Status.INTERNAL})}}}sendStatus(e){var t,n;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===l.Status.OK),!this.checkCancelled()){if(m("Request to method "+(null===(t=this.handler)||void 0===t?void 0:t.path)+" ended with status code: "+l.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let n=Object.assign({[v]:e.code,[y]:encodeURI(e.details)},null===(t=e.metadata)||void 0===t?void 0:t.toHttp2Headers());this.stream.sendTrailers(n),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[v]:e.code,[y]:encodeURI(e.details)},w),null===(n=e.metadata)||void 0===n?void 0:n.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}}sendError(e){let t={code:l.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize){this.sendError({code:l.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let n=new c.StreamDecoder,r=!1,i=!1,s=!1,a=async()=>{s||!r||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async r=>{let s=n.write(r);for(let n of(i=!0,this.stream.pause(),s)){if(-1!==this.maxReceiveMessageSize&&n.length>this.maxReceiveMessageSize){this.sendError({code:l.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${n.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let r=1===n.readUInt8(0)?t:"identity",i=await this.getDecompressedMessage(n,r);if(!i)return;await this.pushOrBufferMessage(e,i)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{r=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),n=e.push(t);if(null===t||!1===n){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){m("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}m("Received message of length "+t.length),this.isPushPending=!0;try{let n=await this.deserializeMessage(t);this.canPush?e.push(n)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(n)}catch(n){this.bufferedMessages.length=0;let t=(0,d.getErrorCode)(n);(null===t||t<l.Status.OK||t>l.Status.UNAUTHENTICATED)&&(t=l.Status.INTERNAL),e.emit("error",{details:(0,d.getErrorMessage)(n),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null===(e=this.stream.session)||void 0===e?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function D(e){let t=Error("Deadline exceeded");t.code=l.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}t.Http2ServerCallStream=A},74181:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCredentials=void 0;let r=n(43009);class i{static createInsecure(){return new s}static createSsl(e,t,n=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof n)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let n=t[e];if(null===n||"object"!=typeof n)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(n.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(n.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(n.cert_chain),s.push(n.private_key)}return new a({ca:e||(0,r.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:n,ciphers:r.CIPHER_SUITES})}}t.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},57691:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;let r=n(85158),i=n(32678),s=n(37061),a=n(74181),o=n(40492),l=n(97504),u=n(23906),c=n(18429),h=n(5993),d=2147483647,f=2147483647,p=2e4,{HTTP2_HEADER_PATH:g}=r.constants,m="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){let n=v(t);switch(e){case"unary":return(e,t)=>{t(n,null)};case"clientStream":return(e,t)=>{t(n,null)};case"serverStream":return e=>{e.emit("error",n)};case"bidi":return e=>{e.emit("error",n)};default:throw Error(`Invalid handlerType ${e}`)}}class S{constructor(e){var t,n,r,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,h.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!==(t=this.options["grpc.max_connection_age_ms"])&&void 0!==t?t:d,this.maxConnectionAgeGraceMs=null!==(n=this.options["grpc.max_connection_age_grace_ms"])&&void 0!==n?n:d,this.keepaliveTimeMs=null!==(r=this.options["grpc.keepalive_time_ms"])&&void 0!==r?r:f,this.keepaliveTimeoutMs=null!==(i=this.options["grpc.keepalive_timeout_ms"])&&void 0!==i?i:p,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,n,r;let i;let s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,u.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,u.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,n=e.getCipher(),r=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!==(t=n.standardName)&&void 0!==t?t:null,cipherSuiteOtherName:n.standardName?null:n.name,localCertificate:r&&"raw"in r?r.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(n=e.state.localWindowSize)&&void 0!==n?n:null,remoteFlowControlWindow:null!==(r=e.state.remoteWindowSize)&&void 0!==r?r:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let n=Object.keys(e);if(0===n.length)throw Error("Cannot add an empty service to a server");n.forEach(n=>{let r,i;let s=e[n];r=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[n];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(r,n),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,r))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let n=e[t];this.unregister(n.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,n){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof n)throw TypeError("callback must be a function");let s=(0,c.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=(0,o.mapUriDefaultScheme)(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let f={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?f.maxSessionMemory=this.options["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(f.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let p=(e,t)=>{process.nextTick(()=>n(e,t))},g=()=>{let e;if(t._isSecure()){let n=Object.assign(f,t._getSettings());n.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=r.createSecureServer(n)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=r.createServer(f);return e.setTimeout(0,y),this._setupHandlers(e),e},m=(e,t,n)=>0===e.length?Promise.resolve({port:t,count:n}):Promise.all(e.map(e=>{let n;this.trace("Attempting to bind "+(0,u.subchannelAddressToString)(e)),n=(0,u.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let r=g();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(e)+" with error "+t.message),i(t)};r.once("error",a),r.listen(n,()=>{let e;if(this.shutdown){r.close(),i(Error("bindAsync failed because server is shutdown"));return}let n=r.address();e="string"==typeof n?{path:n}:{host:n.address,port:n.port};let s=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:r,channelzRef:s}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(e)),i("port"in e?e.port:t),r.removeListener("error",a)})})})).then(e=>{let r=0;for(let n of e)if("number"==typeof n&&(r+=1,n!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:r+n}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],n=g();return new Promise((r,i)=>{let s=n=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(t)+" with error "+n.message),r(v(e.slice(1)))};n.once("error",s),n.listen(t,()=>{if(this.shutdown){n.close(),r({port:0,count:0});return}let t=n.address(),i={host:t.address,port:t.port},a=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:n,channelzRef:a}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(i)),r(m(e.slice(1),t.port,1)),n.removeListener("error",s)})})},b={onSuccessfulResolution:(t,n,r)=>{let s;if(b.onSuccessfulResolution=()=>{},this.shutdown&&p(Error("bindAsync failed because server is shutdown"),0),0===t.length){p(Error(`No addresses resolved for port ${e}`),0);return}(s=(0,u.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):m(t,t[0].port,0):m(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),p(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),p(null,e.port)},e=>{let n=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,n),p(Error(n),0)})},onError:e=>{p(Error(e.details),0)}};(0,o.createResolver)(d,b,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(r.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef)}register(e,t,n,r,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:n,deserialize:r,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef),e(t)},n=0;function r(){0==--n&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(n++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t)),r()}));this.sessions.forEach((e,t)=>{t.closed||(n+=1,t.close(r))}),0===n&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let n=t[r.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof n&&n.startsWith("application/grpc"))||(e.respond({[r.constants.HTTP2_HEADER_STATUS]:r.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,n=null){let r=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed()),r.sendError(e)}_channelzHandler(e,t){let n=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==n||n.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed();return}let r=t[g],a=this._retrieveHandler(r);if(!a){this._respondWithError(v(r),e,n);return}let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),n&&(o.once("streamEnd",e=>{e?n.streamTracker.addCallSucceeded():n.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{n.messagesSent+=1,n.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{n.messagesReceived+=1,n.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let n=t[g],r=this._retrieveHandler(n);if(!r){this._respondWithError(v(n),e,null);return}let a=new s.Http2ServerCallStream(e,r,this.options);this._runHandlerForCall(a,r,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${r.type}`})}_runHandlerForCall(e,t,n){var r;let i=e.receiveMetadata(n),s=null!==(r=i.get("grpc-encoding")[0])&&void 0!==r?r:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)T(e,t,i,s);else if("clientStream"===a)C(e,t,i,s);else if("serverStream"===a)w(e,t,i,s);else{if("bidi"!==a)return!1;E(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),n="null";t&&(n="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=n;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,n,i,s,a;if(!this.started){e.destroy();return}let o=(0,h.registerChannelzSocket)(null!==(t=e.socket.remoteAddress)&&void 0!==t?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let u=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+u),this.sessionChildrenTracker.refChild(o));let c=null,f=null,p=!1;if(this.maxConnectionAgeMs!==d){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;c=null===(i=(n=setTimeout(()=>{var t,n;p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+u);try{e.goaway(r.constants.NGHTTP2_NO_ERROR,2147483647,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==d&&(f=null===(n=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)||void 0===n?void 0:n.call(t))},this.maxConnectionAgeMs+s)).unref)||void 0===i?void 0:i.call(n)}let g=null===(a=(s=setInterval(()=>{var t,n;let r=null===(n=(t=setTimeout(()=>{p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+u),e.close()},this.keepaliveTimeoutMs)).unref)||void 0===n?void 0:n.call(t);try{e.ping((e,t,n)=>{clearTimeout(r)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)||void 0===a?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(p||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+u),this.sessionChildrenTracker.unrefChild(o),(0,h.unregisterChannelzRef)(o)),c&&clearTimeout(c),f&&clearTimeout(f),g&&clearTimeout(g),this.sessions.delete(e)})})}}async function T(e,t,n,r){try{let i=await e.receiveUnaryMessage(r);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,n,i);t.func(a,(t,n,r,i)=>{e.sendUnaryMessage(t,n,r,i)})}catch(t){e.sendError(t)}}function C(e,t,n,r){let i=new s.ServerReadableStreamImpl(e,n,t.deserialize,r);function a(t,n,r,s){i.destroy(),e.sendUnaryMessage(t,n,r,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function w(e,t,n,r){try{let i=await e.receiveUnaryMessage(r);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,n,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function E(e,t,n,r){let i=new s.ServerDuplexStreamImpl(e,n,t.serialize,t.deserialize,r);e.cancelled||t.func(i)}t.Server=S},26262:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndSelectServiceConfig=t.validateServiceConfig=t.validateRetryThrottling=void 0;let r=n(22037),i=n(32678),s=n(27176),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function h(e){var t;let n={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)n.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");n.waitForReady=e.waitForReady}if("timeout"in e){if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");n.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let r=e.timeout.substring(0,e.timeout.length-1).split(".");n.timeout={seconds:0|r[0],nanos:(null!==(t=r[1])&&void 0!==t?t:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");n.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");n.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e){if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");n.retryPolicy=u(e.retryPolicy)}else"hedgingPolicy"in e&&(n.hedgingPolicy=c(e.hedgingPolicy));return n}function d(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function f(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e){if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in e){if(Array.isArray(e.loadBalancingConfig))for(let n of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(n));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let n of e.methodConfig)t.methodConfig.push(h(n));"retryThrottling"in e&&(t.retryThrottling=d(e.retryThrottling));let n=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of n)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);n.push(t)}return t}function p(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:f(e.serviceConfig)};if("clientLanguage"in e){if(Array.isArray(e.clientLanguage))for(let n of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof n)t.clientLanguage.push(n);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in e){if(Array.isArray(e.clientHostname))for(let n of(t.clientHostname=[],e.clientHostname))if("string"==typeof n)t.clientHostname.push(n);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in e){if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage")}let n=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!n.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function g(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let n of e){let e=p(n);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let n of e.clientHostname)n===r.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let n of e.clientLanguage)n===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}function m(e,t){for(let n of e)if(n.length>0&&n[0].startsWith("grpc_config="))return g(JSON.parse(n.join("").substring(12)),t);return null}t.validateRetryThrottling=d,t.validateServiceConfig=f,t.extractAndSelectServiceConfig=m},39932:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBuilder=void 0;class n{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}t.StatusBuilder=n},38326:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(n||(n={}));class r{constructor(){this.readState=n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,r=0,i=[];for(;r<e.length;)switch(this.readState){case n.NO_DATA:this.readCompressFlag=e.slice(r,r+1),r+=1,this.readState=n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case n.READING_SIZE:if(t=Math.min(e.length-r,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,r,r+t),this.readSizeRemaining-=t,r+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=n.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=n.NO_DATA,i.push(e)}}break;case n.READING_MESSAGE:if(t=Math.min(e.length-r,this.readMessageRemaining),this.readPartialMessage.push(e.slice(r,r+t)),this.readMessageRemaining-=t,r+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=n.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}t.StreamDecoder=r},23906:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stringToSubchannelAddress=t.subchannelAddressToString=t.subchannelAddressEqual=t.isTcpSubchannelAddress=void 0;let r=n(41808);function i(e){return"port"in e}function s(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)}function a(e){return i(e)?e.host+":"+e.port:e.path}t.isTcpSubchannelAddress=i,t.subchannelAddressEqual=s,t.subchannelAddressToString=a;let o=443;function l(e,t){return(0,r.isIP)(e)?{host:e,port:null!=t?t:o}:{path:e}}t.stringToSubchannelAddress=l},87060:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelCall=void 0;let r=n(85158),i=n(22037),s=n(32678),a=n(62252),o=n(38326),l=n(97504),u=n(32678),c="subchannel_call";function h(e){for(let[t,n]of Object.entries(i.constants.errno))if(n===e)return t;return"Unknown system error "+e}class d{constructor(e,t,n,i,l){this.http2Stream=e,this.callEventTracker=t,this.listener=n,this.transport=i,this.callId=l,this.decoder=new o.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(e,t)=>{let n="";for(let t of Object.keys(e))n+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+n),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&r.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{if(!this.statusOutput)for(let t of(this.trace("receive HTTP/2 data frame of length "+e.length),this.decoder.write(e)))this.trace("parsed message of length "+t.length),this.callEventTracker.addMessageReceived(),this.tryPush(t)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let n;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null===(t=this.finalStatus)||void 0===t?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case r.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;n=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case r.constants.NGHTTP2_REFUSED_STREAM:n=s.Status.UNAVAILABLE,i="Stream refused by server";break;case r.constants.NGHTTP2_CANCEL:n=s.Status.CANCELLED,i="Call cancelled";break;case r.constants.NGHTTP2_ENHANCE_YOUR_CALM:n=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case r.constants.NGHTTP2_INADEQUATE_SECURITY:n=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case r.constants.NGHTTP2_INTERNAL_ERROR:n=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(n=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:n=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:n,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+h(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let n="";for(let t of Object.keys(e))n+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+n);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let r=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof r["grpc-status"]){let e=Number(r["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof r["grpc-message"]){try{o=decodeURI(r["grpc-message"])}catch(e){o=r["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null===(e=this.finalStatus)||void 0===e?void 0:e.code)===s.Status.OK?r.constants.NGHTTP2_NO_ERROR:r.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let n=t=>{process.nextTick(()=>{var n;let r=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(r=s.Status.INTERNAL),t&&this.cancelWithStatus(r,`Write error: ${t.message}`),null===(n=e.callback)||void 0===n||n.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,n)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}t.Http2SubchannelCall=d},21407:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseSubchannelWrapper=void 0;class n{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}t.BaseSubchannelWrapper=n},42328:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSubchannelPool=t.SubchannelPool=void 0;let r=n(79387),i=n(91727),s=n(23906),a=n(18429),o=n(62869),l=1e4;class u{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let n=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());n.length>0&&(e=!1),this.pool[t]=n}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null===(t=(e=this.cleanupTimer).unref)||void 0===t||t.call(e))}getOrCreateSubchannel(e,t,n,l){this.ensureCleanupTask();let u=(0,a.uriToString)(e);if(u in this.pool){for(let e of this.pool[u])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,r.channelOptionsEqual)(n,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let c=new i.Subchannel(e,t,n,l,new o.Http2SubchannelConnector(e));return u in this.pool||(this.pool[u]=[]),this.pool[u].push({subchannelAddress:t,channelArguments:n,channelCredentials:l,subchannel:c}),c.ref(),c}}t.SubchannelPool=u;let c=new u;function h(e){return e?c:new u}t.getSubchannelPool=h},91727:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Subchannel=void 0;let r=n(33955),i=n(84934),s=n(97504),a=n(32678),o=n(18429),l=n(23906),u=n(5993),c="subchannel",h=2147483647;class d{constructor(e,t,n,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=n,this.credentials=s,this.connector=a,this.connectivityState=r.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new u.ChannelzCallTracker,this.childrenTracker=new u.ChannelzChildrenTracker,this.streamTracker=new u.ChannelzCallTracker;let c={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},c),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!==(o=n["grpc.keepalive_time_ms"])&&void 0!==o?o:-1,0===n["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new u.ChannelzTrace,this.channelzRef=(0,u.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(n,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,c,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([r.ConnectivityState.TRANSIENT_FAILURE],r.ConnectivityState.CONNECTING):this.transitionToState([r.ConnectivityState.TRANSIENT_FAILURE],r.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,h);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([r.ConnectivityState.CONNECTING],r.ConnectivityState.READY)&&(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([r.ConnectivityState.READY],r.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))}))},e=>{this.transitionToState([r.ConnectivityState.CONNECTING],r.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,n){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(r.ConnectivityState[this.connectivityState]+" -> "+r.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+r.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case r.ConnectivityState.READY:this.stopBackoff();break;case r.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case r.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(i=this.transport)||void 0===i||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case r.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(s=this.transport)||void 0===s||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,n);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,u.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([r.ConnectivityState.CONNECTING,r.ConnectivityState.READY],r.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,n,r){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,n,r,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([r.ConnectivityState.IDLE],r.ConnectivityState.CONNECTING)||this.connectivityState!==r.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([r.ConnectivityState.TRANSIENT_FAILURE],r.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}t.Subchannel=d},43009:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultRootsData=t.CIPHER_SUITES=void 0;let r=n(57147);t.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;function a(){return i?(null===s&&(s=r.readFileSync(i)),s):null}t.getDefaultRootsData=a},62869:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelConnector=void 0;let r=n(85158),i=n(24404),s=n(5993),a=n(32678),o=n(82039),l=n(97504),u=n(40492),c=n(23906),h=n(18429),d=n(41808),f=n(87060),p=n(38445),g="transport",m="transport_flowctrl",y=n(81513).i8,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:S,HTTP2_HEADER_PATH:T,HTTP2_HEADER_TE:C,HTTP2_HEADER_USER_AGENT:w}=r.constants,E=2e4,I=Buffer.from("too_many_pings","ascii");class _{constructor(e,t,n,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=E,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,c.subchannelAddressToString)(t),0===n["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[n["grpc.primary_user_agent"],`grpc-node-js/${y}`,n["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in n&&(this.keepaliveTimeMs=n["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in n&&(this.keepaliveTimeoutMs=n["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in n?this.keepaliveWithoutCalls=1===n["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,n)=>{let i=!1;e===r.constants.NGHTTP2_ENHANCE_YOUR_CALM&&n.equals(I)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(g)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,n;let r;let i=this.session.socket,s=i.remoteAddress?(0,c.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,c.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,n=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();r={cipherSuiteStandardName:null!==(e=n.standardName)&&void 0!==e?e:null,cipherSuiteOtherName:n.standardName?null:n.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else r=null;return{remoteAddress:s,localAddress:a,security:r,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(t=this.session.state.localWindowSize)&&void 0!==t?t:null,remoteFlowControlWindow:null!==(n=this.session.state.remoteWindowSize)&&void 0!==n?n:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(t=(e=this.keepaliveTimeoutId).unref)||void 0===t||t.call(e));try{this.session.ping((e,t,n)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null===(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)||void 0===t?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1!==this.activeCalls.size||(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,n,r,i){let s,a,o;let l=e.toHttp2Headers();l[v]=t,l[w]=this.userAgent,l[b]="application/grpc",l[S]="POST",l[T]=n,l[C]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{var t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}}):a={addMessageSent:()=>{var e;null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{var e;null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{var t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}},o=new f.Http2SubchannelCall(s,a,r,this,(0,p.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class R{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,g,(0,h.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,n,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,f,p;let g;s.realTarget?(g=(0,h.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,h.uriToString)(s.realTarget))):(g=null,this.trace("creating HTTP/2 session to "+(0,c.subchannelAddressToString)(e)));let m=(0,u.getDefaultAuthority)(null!==(l=s.realTarget)&&void 0!==l?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in n?y.maxSessionMemory=n["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",n["grpc.ssl_target_name_override"]){let e=n["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,n)=>(0,i.checkServerIdentity)(e,n),y.servername=e}else{let e=null!==(p=null===(f=(0,h.splitHostPort)(m))||void 0===f?void 0:f.host)&&void 0!==p?p:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,n)=>s.socket?s.socket:d.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===n["grpc-node.tls_enable_trace"]});let b=r.connect(v+m,y);this.session=b;let S="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new _(b,e,n,g)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${S} (${new Date().toISOString()})`)})}),b.once("error",e=>{S=e.message,this.trace("connection failed with error "+S)})})}connect(e,t,n){var r,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],n["grpc.ssl_target_name_override"]){let e=n["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,n)=>(0,i.checkServerIdentity)(e,n),a.servername=e}else if("grpc.http_connect_target"in n){let e=(0,u.getDefaultAuthority)(null!==(r=(0,h.parseUri)(n["grpc.http_connect_target"]))&&void 0!==r?r:{path:"localhost"}),t=(0,h.splitHostPort)(e);a.servername=null!==(s=null==t?void 0:t.host)&&void 0!==s?s:e}n["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,n,a).then(r=>this.createSession(e,t,n,r))}shutdown(){var e;this.isShutdown=!0,null===(e=this.session)||void 0===e||e.close(),this.session=null}}t.Http2SubchannelConnector=R},18429:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uriToString=t.splitHostPort=t.parseUri=void 0;let n=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function r(e){let t=n.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}}t.parseUri=r;let i=/^\d+$/;function s(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let n=e.substring(1,t);if(-1===n.indexOf(":"))return null;if(!(e.length>t+1))return{host:n};if(":"!==e[t+1])return null;{let r=e.substring(t+2);return i.test(r)?{host:n,port:+r}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}}function a(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}t.splitHostPort=s,t.uriToString=a},58715:(e,t,n)=>{var r;/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */r={value:!0},r=r=t.im=t.J_=r=r=r=void 0;let i=n(51382),s=n(25269),a=n(21725),o=n(72916);r=n(31468),r=function(e){return"@type"in e&&"string"==typeof e["@type"]};let l={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function u(e,t){return""===e?t:e+"."+t}function c(e){return e instanceof s.Service||e instanceof s.Type||e instanceof s.Enum}function h(e){return e instanceof s.Namespace||e instanceof s.Root}function d(e,t){let n=u(t,e.name);return c(e)?[[n,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>d(e.nested[t],n)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(n){return e.toObject(e.decode(n),t)}}function p(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let n=e.fromObject(t);return e.encode(n).finish()}}function g(e,t,n,r){let s=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:p(s),requestDeserialize:f(s,n),responseSerialize:p(a),responseDeserialize:f(a,n),originalName:i(e.name),requestType:y(s,r),responseType:y(a,r)}}function m(e,t,n,r){let i={};for(let s of e.methodsArray)i[s.name]=g(s,t,n,r);return i}function y(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:n.$type.toObject(n,l),fileDescriptorProtos:t}}function v(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:n.$type.toObject(n,l),fileDescriptorProtos:t}}function b(e,t,n,r){if(e instanceof s.Service)return m(e,t,n,r);if(e instanceof s.Type)return y(e,r);if(e instanceof s.Enum)return v(e,r);throw Error("Type mismatch in reflection object handling")}function S(e,t){let n={};e.resolveAll();let r=e.toDescriptor("proto3").file.map(e=>Buffer.from(a.FileDescriptorProto.encode(e).finish()));for(let[i,s]of d(e,""))n[i]=b(s,i,t,r);return n}function T(e,t){t=t||{};let n=s.Root.fromDescriptor(e);return n.resolveAll(),S(n,t)}function C(e,t){return S((0,o.loadProtosWithOptionsSync)(e,t),t)}function w(e,t){t=t||{};let n=s.Root.fromJSON(e);return n.resolveAll(),S(n,t)}r=function(e,t){return(0,o.loadProtosWithOptions)(e,t).then(e=>S(e,t))},t.J_=C,t.im=w,r=function(e,t){return T(a.FileDescriptorSet.decode(e),t)},r=function(e,t){return T(a.FileDescriptorSet.fromObject(e),t)},(0,o.addCommonProtos)()},72916:(e,t,n)=>{/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */Object.defineProperty(t,"__esModule",{value:!0}),t.addCommonProtos=t.loadProtosWithOptionsSync=t.loadProtosWithOptions=void 0;let r=n(57147),i=n(71017),s=n(25269);function a(e,t){let n=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return r.accessSync(t,r.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),n(e,s)}}async function o(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(n,t.includeDirs)}let r=await n.load(e,t);return r.resolveAll(),r}function l(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(n,t.includeDirs)}let r=n.loadSync(e,t);return r.resolveAll(),r}function u(){let e=n(56541),t=n(89987),r=n(57674),i=n(73795);s.common("api",e.nested.google.nested.protobuf.nested),s.common("descriptor",t.nested.google.nested.protobuf.nested),s.common("source_context",r.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}t.loadProtosWithOptions=o,t.loadProtosWithOptionsSync=l,t.addCommonProtos=u},70799:e=>{e.exports=t;function t(e,t){for(var n=Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,a){n[r]=function(e){if(s){if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}}};try{e.apply(t||null,n)}catch(e){s&&(s=!1,a(e))}})}},92130:(e,t)=>{var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=Array(64),i=Array(123),s=0;s<64;)i[r[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;n.encode=function(e,t,n){for(var i,s=null,a=[],o=0,l=0;t<n;){var u=e[t++];switch(l){case 0:a[o++]=r[u>>2],i=(3&u)<<4,l=1;break;case 1:a[o++]=r[i|u>>4],i=(15&u)<<2,l=2;break;case 2:a[o++]=r[i|u>>6],a[o++]=r[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=r[i],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var a="invalid encoding";n.decode=function(e,t,n){for(var r,s=n,o=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&o>1)break;if(void 0===(u=i[u]))throw Error(a);switch(o){case 0:r=u,o=1;break;case 1:t[n++]=r<<2|(48&u)>>4,r=u,o=2;break;case 2:t[n++]=(15&r)<<4|(60&u)>>2,r=u,o=3;break;case 3:t[n++]=(3&r)<<6|u,o=0}}if(1===o)throw Error(a);return n-s},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},52012:e=>{function t(e,n){"string"==typeof e&&(n=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var n=s();if(t.verbose&&console.log("codegen: "+n),n="return "+n,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),u=0;u<a.length;)o[u]=a[u],l[u]=e[a[u++]];return o[u]=n,Function.apply(null,o).apply(null,l)}return Function(n)()}for(var c=Array(arguments.length-1),h=0;h<c.length;)c[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var n=c[h++];switch(t){case"d":case"f":return String(Number(n));case"i":return String(Math.floor(n));case"j":return JSON.stringify(n);case"s":return String(n)}return"%"}),h!==c.length)throw Error("parameter count mismatch");return r.push(e),i}function s(t){return"function "+(t||n||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=s,i}e.exports=t,t.verbose=!1},80854:e=>{function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},63035:(e,t,n)=>{e.exports=s;var r=n(70799),i=n(20449)("fs");function s(e,t,n){return("function"==typeof t?(n=t,t={}):t||(t={}),n)?!t.xhr&&i&&i.readFile?i.readFile(e,function(r,i){return r&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,n):r?n(r):n(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,n):r(s,this,e,t)}s.xhr=function(e,t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){if(0!==r.status&&200!==r.status)return n(Error("status "+r.status));if(t.binary){var e=r.response;if(!e){e=[];for(var i=0;i<r.responseText.length;++i)e.push(255&r.responseText.charCodeAt(i))}return n(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return n(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}},14324:e=>{function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function s(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function o(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:s,e.writeFloatBE=r?s:i,e.readFloatLE=r?a:o,e.readFloatBE=r?o:a}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,n,r)}}function a(e,t,n){var r=e(t,n),i=(r>>31)*2+1,s=r>>>23&255,a=8388607&r;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,r),e.readFloatLE=a.bind(null,i),e.readFloatBE=a.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function s(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function o(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:s,e.writeDoubleBE=r?s:i,e.readDoubleLE=r?a:o,e.readDoubleBE=r?o:a}():function(){function t(e,t,n,r,i,s){var a,o=r<0?1:0;if(o&&(r=-r),0===r)e(0,i,s+t),e(1/r>0?0:2147483648,i,s+n);else if(isNaN(r))e(0,i,s+t),e(2146959360,i,s+n);else if(r>17976931348623157e292)e(0,i,s+t),e((o<<31|2146435072)>>>0,i,s+n);else if(r<22250738585072014e-324)e((a=r/5e-324)>>>0,i,s+t),e((o<<31|a/4294967296)>>>0,i,s+n);else{var l=Math.floor(Math.log(r)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=r*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+n)}}function a(e,t,n,r,i){var s=e(r,i+t),a=e(r,i+n),o=(a>>31)*2+1,l=a>>>20&2047,u=4294967296*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,r,4,0),e.readDoubleLE=a.bind(null,i,0,4),e.readDoubleBE=a.bind(null,s,4,0)}(),e}function n(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function r(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},20449:module=>{module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}},29986:(e,t)=>{var n=t,r=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=r(e),i="";n&&(i=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):n?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return i+t.join("/")};n.resolve=function(e,t,n){return(n||(t=i(t)),r(t))?t:(n||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}},56035:e=>{e.exports=t;function t(e,t,n){var r=n||8192,i=r>>>1,s=null,a=r;return function(n){if(n<1||n>i)return e(n);a+n>r&&(s=e(r),a=0);var o=t.call(s,a,a+=n);return 7&a&&(a=(7|a)+1),o}}},78131:(e,t)=>{var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:(64512&n)==55296&&(64512&e.charCodeAt(r+1))==56320?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,s=[],a=0;t<n;)(r=e[t++])<128?s[a++]=r:r>191&&r<224?s[a++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(r>>10),s[a++]=56320+(1023&r)):s[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.write=function(e,t,n){for(var r,i,s=n,a=0;a<e.length;++a)(r=e.charCodeAt(a))<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-s}},51382:e=>{var t=1/0,n="[object Symbol]",r=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,i=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,s="\ud800-\udfff",a="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",l="\\u2700-\\u27bf",u="a-z\\xdf-\\xf6\\xf8-\\xff",c="A-Z\\xc0-\\xd6\\xd8-\\xde",h="\\ufe0e\\ufe0f",d="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",f="[']",p="["+s+"]",g="["+d+"]",m="["+a+o+"]",y="\\d+",v="["+l+"]",b="["+u+"]",S="[^"+s+d+y+l+u+c+"]",T="\ud83c[\udffb-\udfff]",C="[^"+s+"]",w="(?:\ud83c[\udde6-\uddff]){2}",E="[\ud800-\udbff][\udc00-\udfff]",I="["+c+"]",_="\\u200d",R="(?:"+b+"|"+S+")",k="(?:"+I+"|"+S+")",A="(?:"+f+"(?:d|ll|m|re|s|t|ve))?",D="(?:"+f+"(?:D|LL|M|RE|S|T|VE))?",x="(?:"+m+"|"+T+")?",N="["+h+"]?",O="(?:"+_+"(?:"+[C,w,E].join("|")+")"+N+x+")*",M=N+x+O,P="(?:"+[v,w,E].join("|")+")"+M,L="(?:"+[C+m+"?",m,w,E,p].join("|")+")",B=RegExp(f,"g"),F=RegExp(m,"g"),j=RegExp(T+"(?="+T+")|"+L+M,"g"),U=RegExp([I+"?"+b+"+"+A+"(?="+[g,I,"$"].join("|")+")",k+"+"+D+"(?="+[g,I+R,"$"].join("|")+")",I+"?"+R+"+"+A,I+"+"+D,y,P].join("|"),"g"),V=RegExp("["+_+s+a+o+h+"]"),z=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,q={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},G="object"==typeof global&&global&&global.Object===Object&&global,K="object"==typeof self&&self&&self.Object===Object&&self,$=G||K||Function("return this")();function H(e,t,n,r){var i=-1,s=e?e.length:0;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function W(e){return e.split("")}function Q(e){return e.match(r)||[]}var Y=function(e){return function(t){return null==e?void 0:e[t]}}(q);function J(e){return V.test(e)}function X(e){return z.test(e)}function Z(e){return J(e)?ee(e):W(e)}function ee(e){return e.match(j)||[]}function et(e){return e.match(U)||[]}var en=Object.prototype.toString,er=$.Symbol,ei=er?er.prototype:void 0,es=ei?ei.toString:void 0;function ea(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function eo(e){if("string"==typeof e)return e;if(eh(e))return es?es.call(e):"";var n=e+"";return"0"==n&&1/e==-t?"-0":n}function el(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:ea(e,t,n)}function eu(e){return function(t){var n=J(t=ed(t))?Z(t):void 0,r=n?n[0]:t.charAt(0),i=n?el(n,1).join(""):t.slice(1);return r[e]()+i}}function ec(e){return!!e&&"object"==typeof e}function eh(e){return"symbol"==typeof e||ec(e)&&en.call(e)==n}function ed(e){return null==e?"":eo(e)}var ef=function(e){return function(t){return H(ey(eg(t).replace(B,"")),e,"")}}(function(e,t,n){return t=t.toLowerCase(),e+(n?ep(t):t)});function ep(e){return em(ed(e).toLowerCase())}function eg(e){return(e=ed(e))&&e.replace(i,Y).replace(F,"")}var em=eu("toUpperCase");function ey(e,t,n){return(e=ed(e),void 0===(t=n?void 0:t))?X(e)?et(e):Q(e):e.match(t)||[]}e.exports=ef},21725:(e,t,n)=>{var r=n(25269);e.exports=t=r.descriptor=r.Root.fromJSON(n(89987)).lookup(".google.protobuf");var i=r.Namespace,s=r.Root,a=r.Enum,o=r.Type,l=r.Field,u=r.MapField,c=r.OneOf,h=r.Service,d=r.Method;function f(e,n,r){var u=t.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});r&&(u.syntax=r),e instanceof s||(u.package=e.fullName.substring(1));for(var c,d=0;d<e.nestedArray.length;++d)(c=e._nestedArray[d])instanceof o?u.messageType.push(c.toDescriptor(r)):c instanceof a?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(r)):c instanceof h?u.service.push(c.toDescriptor()):c instanceof i&&f(c,n,r);u.options=E(e.options,t.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&n.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.FileDescriptorSet.decode(e));var n=new s;if(e.file)for(var r,i,u,c=0;c<e.file.length;++c){if(i=n,(r=e.file[c]).package&&r.package.length&&(i=n.define(r.package)),r.name&&r.name.length&&n.files.push(i.filename=r.name),r.messageType)for(u=0;u<r.messageType.length;++u)i.add(o.fromDescriptor(r.messageType[u],r.syntax));if(r.enumType)for(u=0;u<r.enumType.length;++u)i.add(a.fromDescriptor(r.enumType[u]));if(r.extension)for(u=0;u<r.extension.length;++u)i.add(l.fromDescriptor(r.extension[u]));if(r.service)for(u=0;u<r.service.length;++u)i.add(h.fromDescriptor(r.service[u]));var d=w(r.options,t.FileOptions);if(d){var f=Object.keys(d);for(u=0;u<f.length;++u)i.setOption(f[u],d[f[u]])}}return n},s.prototype.toDescriptor=function(e){var n=t.FileDescriptorSet.create();return f(this,n.file,e),n};var p=0;o.fromDescriptor=function(e,n){"number"==typeof e.length&&(e=t.DescriptorProto.decode(e));var r,i=new o(e.name.length?e.name:"Type"+p++,w(e.options,t.MessageOptions));if(e.oneofDecl)for(r=0;r<e.oneofDecl.length;++r)i.add(c.fromDescriptor(e.oneofDecl[r]));if(e.field)for(r=0;r<e.field.length;++r){var s=l.fromDescriptor(e.field[r],n);i.add(s),e.field[r].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[r].oneofIndex].add(s)}if(e.extension)for(r=0;r<e.extension.length;++r)i.add(l.fromDescriptor(e.extension[r],n));if(e.nestedType)for(r=0;r<e.nestedType.length;++r)i.add(o.fromDescriptor(e.nestedType[r],n)),e.nestedType[r].options&&e.nestedType[r].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(r=0;r<e.enumType.length;++r)i.add(a.fromDescriptor(e.enumType[r]));if(e.extensionRange&&e.extensionRange.length)for(r=0,i.extensions=[];r<e.extensionRange.length;++r)i.extensions.push([e.extensionRange[r].start,e.extensionRange[r].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(r=0;r<e.reservedRange.length;++r)i.reserved.push([e.reservedRange[r].start,e.reservedRange[r].end]);if(e.reservedName)for(r=0;r<e.reservedName.length;++r)i.reserved.push(e.reservedName[r])}return i},o.prototype.toDescriptor=function(e){var n,r,i=t.DescriptorProto.create({name:this.name});for(r=0;r<this.fieldsArray.length;++r)if(i.field.push(n=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof u){var s=C(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),c=C(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),h=11===c||14===c?this._fieldsArray[r].resolvedType&&I(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;i.nestedType.push(t.DescriptorProto.create({name:n.typeName,field:[t.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),t.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:h})],options:t.MessageOptions.create({mapEntry:!0})}))}for(r=0;r<this.oneofsArray.length;++r)i.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof l?i.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof o?i.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof a&&i.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)i.extensionRange.push(t.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)"string"==typeof this.reserved[r]?i.reservedName.push(this.reserved[r]):i.reservedRange.push(t.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return i.options=E(this.options,t.MessageOptions),i};var g=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,n){if("number"==typeof e.length&&(e=t.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(r=e.typeName&&e.typeName.length?e.typeName:S(e.type),e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var r,i,s=e.extendee;void 0!==e.extendee&&(s=s.length?s:void 0);var a=new l(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(a.options=w(e.options,t.FieldOptions),e.defaultValue&&e.defaultValue.length){var o=e.defaultValue;switch(o){case"true":case"TRUE":o=!0;break;case"false":case"FALSE":o=!1;break;default:g.exec(o)&&(o=parseInt(o))}a.setOption("default",o)}return T(e.type)&&("proto3"===n?e.options&&!e.options.packed&&a.setOption("packed",!1):e.options&&e.options.packed||a.setOption("packed",!1)),a},l.prototype.toDescriptor=function(e){var n=t.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)n.type=11,n.typeName=r.util.ucFirst(this.name),n.label=3;else{switch(n.type=C(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:n.typeName=this.resolvedType?I(this.parent,this.resolvedType):this.type}switch(this.rule){case"repeated":n.label=3;break;case"required":n.label=2;break;default:n.label=1}}if(n.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(n.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(n.options=E(this.options,t.FieldOptions),null!=this.options.default&&(n.defaultValue=String(this.options.default))),"proto3"===e?this.packed||((n.options||(n.options=t.FieldOptions.create())).packed=!1):this.packed&&((n.options||(n.options=t.FieldOptions.create())).packed=!0),n};var m=0;a.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.EnumDescriptorProto.decode(e));var n={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;n[i&&i.length?i:"NAME"+s]=s}return new a(e.name&&e.name.length?e.name:"Enum"+m++,n,w(e.options,t.EnumOptions))},a.prototype.toDescriptor=function(){for(var e=[],n=0,r=Object.keys(this.values);n<r.length;++n)e.push(t.EnumValueDescriptorProto.create({name:r[n],number:this.values[r[n]]}));return t.EnumDescriptorProto.create({name:this.name,value:e,options:E(this.options,t.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return t.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.ServiceDescriptorProto.decode(e));var n=new h(e.name&&e.name.length?e.name:"Service"+v++,w(e.options,t.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)n.add(d.fromDescriptor(e.method[r]));return n},h.prototype.toDescriptor=function(){for(var e=[],n=0;n<this.methodsArray.length;++n)e.push(this._methodsArray[n].toDescriptor());return t.ServiceDescriptorProto.create({name:this.name,method:e,options:E(this.options,t.ServiceOptions)})};var b=0;function S(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function T(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function C(e,t){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return t.group?10:11;throw Error("illegal type: "+e)}function w(e,t){if(e){for(var n,i,s,o=[],l=0;l<t.fieldsArray.length;++l)"uninterpretedOption"!==(i=(n=t._fieldsArray[l]).name)&&e.hasOwnProperty(i)&&(s=e[i],n.resolvedType instanceof a&&"number"==typeof s&&void 0!==n.resolvedType.valuesById[s]&&(s=n.resolvedType.valuesById[s]),o.push(_(i),s));return o.length?r.util.toObject(o):void 0}}function E(e,t){if(e){for(var n,i,s=[],a=0,o=Object.keys(e);a<o.length;++a)if(i=e[n=o[a]],"default"!==n){var l=t.fields[n];(l||(l=t.fields[n=r.util.camelCase(n)]))&&s.push(n,i)}return s.length?t.fromObject(r.util.toObject(s)):void 0}}function I(e,t){var n=e.fullName.split("."),r=t.fullName.split("."),a=0,o=0,l=r.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<n.length&&o<l&&n[a]===r[o];){var u=t.lookup(n[a++],!0);if(null!==u&&u!==t)break;++o}else for(;a<n.length&&o<l&&n[a]===r[o];++a,++o);return r.slice(o).join(".")}function _(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,w(e.options,t.MethodOptions))},d.prototype.toDescriptor=function(){return t.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:E(this.options,t.MethodOptions)})}},25269:(e,t,n)=>{e.exports=n(57954)},62516:e=>{e.exports=r;var t,n=/\/|\./;function r(e,t){n.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),r[e]=t}r("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),r("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),r("timestamp",{Timestamp:t}),r("empty",{Empty:{fields:{}}}),r("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),r("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),r("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),r.get=function(e){return r[e]||null}},5944:(e,t,n)=>{var r=t,i=n(33982),s=n(18289);function a(e,t,n,r){var s=!1;if(t.resolvedType){if(t.resolvedType instanceof i){e("switch(d%s){",r);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",r,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,n,r)}else{var u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",r,r);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,u)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":e("m%s=String(d%s)",r,r);break;case"bool":e("m%s=Boolean(d%s)",r,r)}}return e}function o(e,t,n,r){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,n,r,r,n,r,r):e("d%s=types[%i].toObject(m%s,o)",r,n,r);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,s?"true":"",r);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:e("d%s=m%s",r,r)}}return e}r.fromObject=function(e){var t=e.fieldsArray,n=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var r=0;r<t.length;++r){var o=t[r].resolve(),l=s.safeProp(o.name);o.map?(n("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(n,o,r,l+"[ks[i]]")("}")("}")):o.repeated?(n("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(n,o,r,l+"[i]")("}")("}")):(o.resolvedType instanceof i||n("if(d%s!=null){",l),a(n,o,r,l),o.resolvedType instanceof i||n("}"))}return n("return m")},r.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var n=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],a=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?r:t[u].map?a:l).push(t[u]);if(r.length){for(n("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)n("d%s=[]",s.safeProp(r[u].name));n("}")}if(a.length){for(n("if(o.objects||o.defaults){"),u=0;u<a.length;++u)n("d%s={}",s.safeProp(a[u].name));n("}")}if(l.length){for(n("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=s.safeProp(c.name);if(c.resolvedType instanceof i)n("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else n("d%s=%j",h,c.typeDefault)}n("}")}var f=!1;for(u=0;u<t.length;++u){var c=t[u],p=e._fieldsArray.indexOf(c),h=s.safeProp(c.name);c.map?(f||(f=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),o(n,c,p,h+"[ks2[j]]")("}")):c.repeated?(n("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),o(n,c,p,h+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),o(n,c,p,h),c.partOf&&n("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),n("}")}return n("return d")}},98983:(e,t,n)=>{e.exports=o;var r=n(33982),i=n(31627),s=n(18289);function a(e){return"missing required '"+e.name+"'"}function o(e){var t=s.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var n=0;n<e.fieldsArray.length;++n){var o=e._fieldsArray[n].resolve(),l=o.resolvedType instanceof r?"int32":o.type,u="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",n):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),t(void 0!==i.long[o.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",u)):o.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(o.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,n):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(o.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,n):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var c=e._fieldsArray[n];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")}},67337:(e,t,n)=>{e.exports=o;var r=n(33982),i=n(31627),s=n(18289);function a(e,t,n,r){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,(t.id<<3|2)>>>0)}function o(e){for(var t,n,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof r?"int32":u.type,d=i.basic[h];n="m"+s.safeProp(u.name),u.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",n,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",n)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===d?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,n):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,n),o("}")("}")):u.repeated?(o("if(%s!=null&&%s.length){",n,n),u.packed&&void 0!==i.packed[h]?o("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",n)("w.%s(%s[i])",h,n)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",n),void 0===d?a(o,u,c,n+"[i]"):o("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,n)),o("}")):(u.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",n,u.name),void 0===d?a(o,u,c,n):o("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,n))}return o("return w")}},33982:(e,t,n)=>{e.exports=a;var r=n(58831);((a.prototype=Object.create(r.prototype)).constructor=a).className="Enum";var i=n(44622),s=n(18289);function a(e,t,n,i,s,a){if(r.call(this,e,n),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.fromJSON=function(e,t){var n=new a(e,t.values,t.options,t.comment,t.comments);return n.reserved=t.reserved,n},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,n,r){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return r&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=r||null),this.comments[e]=n||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},92548:(e,t,n)=>{e.exports=u;var r,i=n(58831);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=n(33982),a=n(31627),o=n(18289),l=/^required|optional|repeated$/;function u(e,t,n,r,s,u,c){if(o.isObject(r)?(c=s,u=r,r=s=void 0):o.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(n))throw TypeError("type must be a string");if(void 0!==r&&!l.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===r&&(r="optional"),this.rule=r&&"optional"!==r?r:void 0,this.type=n,this.id=t,this.extend=s||void 0,this.required="required"===r,this.optional=!this.required,this.repeated="repeated"===r,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[n],this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=c}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,n){return"packed"===e&&(this._packed=null),i.prototype.setOption.call(this,e,t,n)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof r?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof r&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.d=function(e,t,n,r){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new u(s,e,t,n,{default:r}))}},u._configure=function(e){r=e}},72822:(e,t,n)=>{var r=e.exports=n(65748);function i(e,t,n){return"function"==typeof t?(n=t,t=new r.Root):t||(t=new r.Root),t.load(e,n)}function s(e,t){return t||(t=new r.Root),t.loadSync(e)}r.build="light",r.load=i,r.loadSync=s,r.encoder=n(67337),r.decoder=n(98983),r.verifier=n(31181),r.converter=n(5944),r.ReflectionObject=n(58831),r.Namespace=n(44622),r.Root=n(34955),r.Enum=n(33982),r.Type=n(69396),r.Field=n(92548),r.OneOf=n(85677),r.MapField=n(30372),r.Service=n(26962),r.Method=n(3055),r.Message=n(55326),r.wrappers=n(82969),r.types=n(31627),r.util=n(18289),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},65748:(e,t,n)=>{var r=t;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(47474),r.BufferWriter=n(96985),r.Reader=n(8645),r.BufferReader=n(2126),r.util=n(86416),r.rpc=n(84415),r.roots=n(43675),r.configure=i,i()},57954:(e,t,n)=>{var r=e.exports=n(72822);r.build="full",r.tokenize=n(89468),r.parse=n(60580),r.common=n(62516),r.Root._configure(r.Type,r.parse,r.common)},30372:(e,t,n)=>{e.exports=a;var r=n(92548);((a.prototype=Object.create(r.prototype)).constructor=a).className="MapField";var i=n(31627),s=n(18289);function a(e,t,n,i,a,o){if(r.call(this,e,t,i,void 0,void 0,a,o),!s.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},a.d=function(e,t,n){return"function"==typeof n?n=s.decorateType(n).name:n&&"object"==typeof n&&(n=s.decorateEnum(n).name),function(r,i){s.decorateType(r.constructor).add(new a(i,e,t,n))}}},55326:(e,t,n)=>{e.exports=i;var r=n(86416);function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)this[t[n]]=e[t[n]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},3055:(e,t,n)=>{e.exports=s;var r=n(58831);((s.prototype=Object.create(r.prototype)).constructor=s).className="Method";var i=n(18289);function s(e,t,n,s,a,o,l,u,c){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(n))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");r.call(this,e,l),this.type=t||"rpc",this.requestType=n,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},44622:(e,t,n)=>{e.exports=h;var r,i,s,a=n(58831);((h.prototype=Object.create(a.prototype)).constructor=h).className="Namespace";var o=n(92548),l=n(18289),u=n(85677);function c(e,t){if(e&&e.length){for(var n={},r=0;r<e.length;++r)n[e[r].name]=e[r].toJSON(t);return n}}function h(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null}function d(e){return e._nestedArray=null,e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=c,h.isReservedId=function(e,t){if(e){for(var n=0;n<e.length;++n)if("string"!=typeof e[n]&&e[n][0]<=t&&e[n][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var n=0;n<e.length;++n)if(e[n]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var n,a=Object.keys(e),l=0;l<a.length;++l)n=e[a[l]],t.add((void 0!==n.fields?r.fromJSON:void 0!==n.values?s.fromJSON:void 0!==n.methods?i.fromJSON:void 0!==n.id?o.fromJSON:h.fromJSON)(a[l],n));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof r||e instanceof u||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(t instanceof h&&e instanceof h&&!(t instanceof r||t instanceof i)){for(var n=t.nestedArray,a=0;a<n.length;++a)e.add(n[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var n=this;e.length>0;){var r=e.shift();if(n.nested&&n.nested[r]){if(!((n=n.nested[r])instanceof h))throw Error("path conflicts with non-namespace objects")}else n.add(n=new h(r))}return t&&n.addJSON(t),n},h.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this.resolve()},h.prototype.lookup=function(e,t,n){if("boolean"==typeof t?(n=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(1===e.length){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof h&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof h&&(r=this._nestedArray[i].lookup(e,t,!0)))return r;return null===this.parent||n?null:this.parent.lookup(e,t)},h.prototype.lookupType=function(e){var t=this.lookup(e,[r]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[r,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,n){r=e,i=t,s=n}},58831:(e,t,n)=>{e.exports=s,s.className="ReflectionObject";var r,i=n(18289);function s(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(s.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),s.prototype.toJSON=function(){throw Error()},s.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof r&&t._handleAdd(this)},s.prototype.onRemove=function(e){var t=e.root;t instanceof r&&t._handleRemove(this),this.parent=null,this.resolved=!1},s.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},s.prototype.getOption=function(e){if(this.options)return this.options[e]},s.prototype.setOption=function(e,t,n){return n&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},s.prototype.setParsedOption=function(e,t,n){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(n){var s=r.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(s){var a=s[e];i.setProperty(a,n,t)}else(s={})[e]=i.setProperty({},n,t),r.push(s)}else{var o={};o[e]=t,r.push(o)}return this},s.prototype.setOptions=function(e,t){if(e)for(var n=Object.keys(e),r=0;r<n.length;++r)this.setOption(n[r],e[n[r]],t);return this},s.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},s._configure=function(e){r=e}},85677:(e,t,n)=>{e.exports=a;var r=n(58831);((a.prototype=Object.create(r.prototype)).constructor=a).className="OneOf";var i=n(92548),s=n(18289);function a(e,t,n,i){if(Array.isArray(t)||(n=t,t=void 0),r.call(this,e,n),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){r.prototype.onAdd.call(this,e);for(var t=this,n=0;n<this.oneof.length;++n){var i=e.get(this.oneof[n]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,n=0;n<this.fieldsArray.length;++n)(t=this.fieldsArray[n]).parent&&t.parent.remove(t);r.prototype.onRemove.call(this,e)},a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){s.decorateType(t.constructor).add(new a(n,e)),Object.defineProperty(t,n,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},60580:(e,t,n)=>{e.exports=E,E.filename=null,E.defaults={keepCase:!1};var r=n(89468),i=n(34955),s=n(69396),a=n(92548),o=n(30372),l=n(85677),u=n(33982),c=n(26962),h=n(3055),d=n(31627),f=n(18289),p=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,m=/^0[x][0-9a-fA-F]+$/,y=/^-?0[x][0-9a-fA-F]+$/,v=/^0[0-7]+$/,b=/^-?0[0-7]+$/,S=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,T=/^[a-zA-Z_][a-zA-Z_0-9]*$/,C=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,w=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function E(e,t,n){t instanceof i||(n=t,t=new i),n||(n=E.defaults);var I,_,R,k,A,D=n.preferTrailingComment||!1,x=r(e,n.alternateCommentMode||!1),N=x.next,O=x.push,M=x.peek,P=x.skip,L=x.cmnt,B=!0,F=!1,j=t,U=n.keepCase?function(e){return e}:f.camelCase;function V(e,t,n){var r=E.filename;return n||(E.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(r?r+", ":"")+"line "+x.line+")")}function z(){var e,t=[];do{if('"'!==(e=N())&&"'"!==e)throw V(e);t.push(N()),P(e),e=M()}while('"'===e||"'"===e);return t.join("")}function q(e){var t=N();switch(t){case"'":case'"':return O(t),z();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return K(t,!0)}catch(n){if(e&&C.test(t))return t;throw V(t,"value")}}function G(e,t){var n,r;do t&&('"'===(n=M())||"'"===n)?e.push(z()):e.push([r=$(N()),P("to",!0)?$(N()):r]);while(P(",",!0));P(";")}function K(e,t){var n=1;switch("-"===e.charAt(0)&&(n=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*n;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(p.test(e))return n*parseInt(e,10);if(m.test(e))return n*parseInt(e,16);if(v.test(e))return n*parseInt(e,8);if(S.test(e))return n*parseFloat(e);throw V(e,"number",t)}function $(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw V(e,"id");if(g.test(e))return parseInt(e,10);if(y.test(e))return parseInt(e,16);if(b.test(e))return parseInt(e,8);throw V(e,"id")}function H(){if(void 0!==_)throw V("package");if(_=N(),!C.test(_))throw V(_,"name");j=j.define(_),P(";")}function W(){var e,t=M();switch(t){case"weak":e=k||(k=[]),N();break;case"public":N();default:e=R||(R=[])}t=z(),P(";"),e.push(t)}function Q(){if(P("="),!(F="proto3"===(A=z()))&&"proto2"!==A)throw V(A,"syntax");P(";")}function Y(e,t){switch(t){case"option":return es(e,t),P(";"),!0;case"message":return X(e,t),!0;case"enum":return er(e,t),!0;case"service":return ec(e,t),!0;case"extend":return ed(e,t),!0}return!1}function J(e,t,n){var r,i=x.line;if(e&&("string"!=typeof e.comment&&(e.comment=L()),e.filename=E.filename),P("{",!0)){for(;"}"!==(r=N());)t(r);P(";",!0)}else n&&n(),P(";"),e&&("string"!=typeof e.comment||D)&&(e.comment=L(i)||e.comment)}function X(e,t){if(!T.test(t=N()))throw V(t,"type name");var n=new s(t);J(n,function(e){if(!Y(n,e))switch(e){case"map":et(n,e);break;case"required":case"repeated":Z(n,e);break;case"optional":F?Z(n,"proto3_optional"):Z(n,"optional");break;case"oneof":en(n,e);break;case"extensions":G(n.extensions||(n.extensions=[]));break;case"reserved":G(n.reserved||(n.reserved=[]),!0);break;default:if(!F||!C.test(e))throw V(e);O(e),Z(n,"optional")}}),e.add(n)}function Z(e,t,n){var r=N();if("group"===r){ee(e,t);return}for(;r.endsWith(".")||M().startsWith(".");)r+=N();if(!C.test(r))throw V(r,"type");var i=N();if(!T.test(i))throw V(i,"name");i=U(i),P("=");var s=new a(i,$(N()),r,t,n);if(J(s,function(e){if("option"===e)es(s,e),P(";");else throw V(e)},function(){eu(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);!F&&s.repeated&&(void 0!==d.packed[r]||void 0===d.basic[r])&&s.setOption("packed",!1,!0)}function ee(e,t){var n=N();if(!T.test(n))throw V(n,"name");var r=f.lcFirst(n);n===r&&(n=f.ucFirst(n)),P("=");var i=$(N()),o=new s(n);o.group=!0;var l=new a(r,i,n,t);l.filename=E.filename,J(o,function(e){switch(e){case"option":es(o,e),P(";");break;case"required":case"repeated":Z(o,e);break;case"optional":F?Z(o,"proto3_optional"):Z(o,"optional");break;case"message":X(o,e);break;case"enum":er(o,e);break;default:throw V(e)}}),e.add(o).add(l)}function et(e){P("<");var t=N();if(void 0===d.mapKey[t])throw V(t,"type");P(",");var n=N();if(!C.test(n))throw V(n,"type");P(">");var r=N();if(!T.test(r))throw V(r,"name");P("=");var i=new o(U(r),$(N()),t,n);J(i,function(e){if("option"===e)es(i,e),P(";");else throw V(e)},function(){eu(i)}),e.add(i)}function en(e,t){if(!T.test(t=N()))throw V(t,"name");var n=new l(U(t));J(n,function(e){"option"===e?(es(n,e),P(";")):(O(e),Z(n,"optional"))}),e.add(n)}function er(e,t){if(!T.test(t=N()))throw V(t,"name");var n=new u(t);J(n,function(e){switch(e){case"option":es(n,e),P(";");break;case"reserved":G(n.reserved||(n.reserved=[]),!0);break;default:ei(n,e)}}),e.add(n)}function ei(e,t){if(!T.test(t))throw V(t,"name");P("=");var n=$(N(),!0),r={options:void 0};r.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},J(r,function(e){if("option"===e)es(r,e),P(";");else throw V(e)},function(){eu(r)}),e.add(t,n,r.comment,r.options)}function es(e,t){var n,r=P("(",!0);if(!C.test(t=N()))throw V(t,"name");var i=t,s=i;r&&(P(")"),s=i="("+i+")",t=M(),w.test(t)&&(n=t.slice(1),i+=t,N())),P("=");var a=ea(e,i);el(e,s,a,n)}function ea(e,t){if(P("{",!0)){for(var n={};!P("}",!0);){if(!T.test(I=N()))throw V(I,"name");if(null===I)throw V(I,"end of input");var r,i,s=I;if(P(":",!0),"{"===M())r=ea(e,t+"."+I);else if("["===M()){if(r=[],P("[",!0)){do i=q(!0),r.push(i);while(P(",",!0));P("]"),void 0!==i&&eo(e,t+"."+I,i)}}else r=q(!0),eo(e,t+"."+I,r);var a=n[s];a&&(r=[].concat(a).concat(r)),n[s]=r,P(",",!0),P(";",!0)}return n}var o=q(!0);return eo(e,t,o),o}function eo(e,t,n){e.setOption&&e.setOption(t,n)}function el(e,t,n,r){e.setParsedOption&&e.setParsedOption(t,n,r)}function eu(e){if(P("[",!0)){do es(e,"option");while(P(",",!0));P("]")}return e}function ec(e,t){if(!T.test(t=N()))throw V(t,"service name");var n=new c(t);J(n,function(e){if(!Y(n,e)){if("rpc"===e)eh(n,e);else throw V(e)}}),e.add(n)}function eh(e,t){var n=L(),r=t;if(!T.test(t=N()))throw V(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!C.test(t=N())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!C.test(t=N())))throw V(t);a=t,P(")");var u=new h(l,r,i,a,s,o);u.comment=n,J(u,function(e){if("option"===e)es(u,e),P(";");else throw V(e)}),e.add(u)}function ed(e,t){if(!C.test(t=N()))throw V(t,"reference");var n=t;J(null,function(t){switch(t){case"required":case"repeated":Z(e,t,n);break;case"optional":F?Z(e,"proto3_optional",n):Z(e,"optional",n);break;default:if(!F||!C.test(t))throw V(t);O(t),Z(e,"optional",n)}})}for(;null!==(I=N());)switch(I){case"package":if(!B)throw V(I);H();break;case"import":if(!B)throw V(I);W();break;case"syntax":if(!B)throw V(I);Q();break;case"option":es(j,I),P(";");break;default:if(Y(j,I)){B=!1;continue}throw V(I)}return E.filename=null,{package:_,imports:R,weakImports:k,syntax:A,root:t}}},8645:(e,t,n)=>{e.exports=l;var r,i=n(86416),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new r(e):u(e)})(e)}:u};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw o(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,n);if(t===n){var r=i.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,n)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){r=e,l.create=c(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},2126:(e,t,n)=>{e.exports=s;var r=n(8645);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(86416);function s(e){r.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},34955:(e,t,n)=>{e.exports=h;var r,i,s,a=n(44622);((h.prototype=Object.create(a.prototype)).constructor=h).className="Root";var o=n(92548),l=n(33982),u=n(85677),c=n(18289);function h(e){a.call(this,"",e),this.deferred=[],this.files=[]}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},h.prototype.resolvePath=c.path.resolve,h.prototype.fetch=c.fetch,h.prototype.load=function e(t,n,r){"function"==typeof n&&(r=n,n=void 0);var a=this;if(!r)return c.asPromise(e,a,t,n);var o=r===d;function l(e,t){if(r){var n=r;if(r=null,o)throw e;n(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var n=e.substring(t);if(n in s)return n}return null}function h(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var r,s=i(t,a,n),h=0;if(s.imports)for(;h<s.imports.length;++h)(r=u(s.imports[h])||a.resolvePath(e,s.imports[h]))&&f(r);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(r=u(s.weakImports[h])||a.resolvePath(e,s.weakImports[h]))&&f(r,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||p||l(null,a)}function f(e,t){if(e=u(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s){o?h(e,s[e]):(++p,setTimeout(function(){--p,h(e,s[e])}));return}if(o){var n;try{n=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,n)}else++p,a.fetch(e,function(n,i){if(--p,r){if(n){t?p||l(null,a):l(n);return}h(e,i)}})}}var p=0;c.isString(t)&&(t=[t]);for(var g,m=0;m<t.length;++m)(g=a.resolvePath("",t[m]))&&f(g);if(o)return a;p||l(null,a)},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(e,t){var n=t.parent.lookup(t.extend);if(n){var r=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!n.get(r.name)||(r.declaringField=t,t.extensionField=r,n.add(r),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||p(this,e)||this.deferred.push(e);else if(e instanceof l)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof r)for(var t=0;t<this.deferred.length;)p(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var n=0;n<e.nestedArray.length;++n)this._handleAdd(e._nestedArray[n]);f.test(e.name)&&(e.parent[e.name]=e)}},h.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend){if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}}else if(e instanceof l)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(e._nestedArray[n]);f.test(e.name)&&delete e.parent[e.name]}},h._configure=function(e,t,n){r=e,i=t,s=n}},43675:e=>{e.exports={}},84415:(e,t,n)=>{t.Service=n(49861)},49861:(e,t,n)=>{e.exports=i;var r=n(86416);function i(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return r.asPromise(e,o,t,n,i,s);if(!o.rpcImpl){setTimeout(function(){a(Error("already ended"))},0);return}try{return o.rpcImpl(t,n[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,n){if(e)return o.emit("error",e,t),a(e);if(null===n){o.end(!0);return}if(!(n instanceof i))try{n=i[o.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",n,t),a(null,n)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},26962:(e,t,n)=>{e.exports=o;var r=n(44622);((o.prototype=Object.create(r.prototype)).constructor=o).className="Service";var i=n(3055),s=n(18289),a=n(84415);function o(e,t){r.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var n=new o(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)n.add(i.fromJSON(r[s],t.methods[r[s]]));return t.nested&&n.addJSON(t.nested),n.comment=t.comment,n},o.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return s.toObject(["options",t&&t.options||void 0,"methods",r.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||r.prototype.get.call(this,e)},o.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return r.prototype.resolve.call(this)},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):r.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return r.prototype.remove.call(this,e)},o.prototype.create=function(e,t,n){for(var r,i=new a.Service(e,t,n),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((r=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return i}},89468:e=>{e.exports=h;var t=/[\s{}=;:[\],'"()<>]/g,n=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,r=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,s=/^\s*\*?\/*/,a=/\n/g,o=/\s/,l=/\\(.?)/g,u={0:"\x00",r:"\r",n:"\n",t:"	"};function c(e){return e.replace(l,function(e,t){switch(t){case"\\":case"":return t;default:return u[t]||""}})}function h(e,l){e=e.toString();var u=0,h=e.length,d=1,f=0,p={},g=[],m=null;function y(e){return Error("illegal "+e+" (line "+d+")")}function v(){var t="'"===m?r:n;t.lastIndex=u-1;var i=t.exec(e);if(!i)throw y("string");return u=t.lastIndex,E(m),m=null,c(i[1])}function b(t){return e.charAt(t)}function S(t,n,r){var o,u,c={type:e.charAt(t++),lineEmpty:!1,leading:r},h=t-(o=l?2:3);do if(--h<0||"\n"===(u=e.charAt(h))){c.lineEmpty=!0;break}while(" "===u||"	"===u);for(var g=e.substring(t,n).split(a),m=0;m<g.length;++m)g[m]=g[m].replace(l?s:i,"").trim();c.text=g.join("\n").trim(),p[d]=c,f=d}function T(t){var n=C(t),r=e.substring(t,n);return/^\s*\/\//.test(r)}function C(e){for(var t=e;t<h&&"\n"!==b(t);)t++;return t}function w(){if(g.length>0)return g.shift();if(m)return v();var n,r,i,s,a,c=0===u;do{if(u===h)return null;for(n=!1;o.test(i=b(u));)if("\n"===i&&(c=!0,++d),++u===h)return null;if("/"===b(u)){if(++u===h)throw y("comment");if("/"===b(u)){if(l){if(s=u,a=!1,T(u-1)){a=!0;do if((u=C(u))===h||(u++,!c))break;while(T(u))}else u=Math.min(h,C(u)+1);a&&(S(s,u,c),c=!0),d++,n=!0}else{for(a="/"===b(s=u+1);"\n"!==b(++u);)if(u===h)return null;++u,a&&(S(s,u-1,c),c=!0),++d,n=!0}}else{if("*"!==(i=b(u)))return"/";s=u+1,a=l||"*"===b(s);do{if("\n"===i&&++d,++u===h)throw y("comment");r=i,i=b(u)}while("*"!==r||"/"!==i);++u,a&&(S(s,u-2,c),c=!0),n=!0}}}while(n);var f=u;if(t.lastIndex=0,!t.test(b(f++)))for(;f<h&&!t.test(b(f));)++f;var p=e.substring(u,u=f);return('"'===p||"'"===p)&&(m=p),p}function E(e){g.push(e)}function I(){if(!g.length){var e=w();if(null===e)return null;E(e)}return g[0]}function _(e,t){var n=I();if(n===e)return w(),!0;if(!t)throw y("token '"+n+"', '"+e+"' expected");return!1}function R(e){var t,n=null;return void 0===e?(t=p[d-1],delete p[d-1],t&&(l||"*"===t.type||t.lineEmpty)&&(n=t.leading?t.text:null)):(f<e&&I(),t=p[e],delete p[e],t&&!t.lineEmpty&&(l||"/"===t.type)&&(n=t.leading?null:t.text)),n}return Object.defineProperty({next:w,peek:I,push:E,skip:_,cmnt:R},"line",{get:function(){return d}})}h.unescape=c},69396:(e,t,n)=>{e.exports=v;var r=n(44622);((v.prototype=Object.create(r.prototype)).constructor=v).className="Type";var i=n(33982),s=n(85677),a=n(92548),o=n(30372),l=n(26962),u=n(55326),c=n(8645),h=n(47474),d=n(18289),f=n(67337),p=n(98983),g=n(31181),m=n(5944),y=n(82969);function v(e,t){r.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var n=this.fields[e[t]],r=n.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var r={};for(n=0;n<this.oneofsArray.length;++n)r[this._oneofsArray[n].resolve().name]={get:d.oneOfGetter(this._oneofsArray[n].oneof),set:d.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(e.prototype,r)}}}),v.generateConstructor=function(e){for(var t,n=d.codegen(["p"],e.name),r=0;r<e.fieldsArray.length;++r)(t=e._fieldsArray[r]).map?n("this%s={}",d.safeProp(t.name)):t.repeated&&n("this%s=[]",d.safeProp(t.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var n=new v(e,t.options);n.extensions=t.extensions,n.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)n.add((void 0!==t.fields[u[c]].keyType?o.fromJSON:a.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)n.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];n.add((void 0!==h.id?a.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:r.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(n.extensions=t.extensions),t.reserved&&t.reserved.length&&(n.reserved=t.reserved),t.group&&(n.group=!0),t.comment&&(n.comment=t.comment),n},v.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return d.toObject(["options",t&&t.options||void 0,"oneofs",r.arrayToJSON(this.oneofsArray,e),"fields",r.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},v.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var n=this.oneofsArray;for(t=0;t<n.length;)n[t++].resolve();return r.prototype.resolveAll.call(this)},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):r.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return r.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],n=0;n<this.fieldsArray.length;++n)t.push(this._fieldsArray[n].resolve().resolvedType);this.encode=f(this)({Writer:h,types:t,util:d}),this.decode=p(this)({Reader:c,types:t,util:d}),this.verify=g(this)({types:t,util:d}),this.fromObject=m.fromObject(this)({types:t,util:d}),this.toObject=m.toObject(this)({types:t,util:d});var r=y[e];if(r){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(i),i.toObject=this.toObject,this.toObject=r.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},31627:(e,t,n)=>{var r=t,i=n(18289),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var n=0,r={};for(t|=0;n<e.length;)r[s[n+t]]=e[n++];return r}r.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),r.long=a([0,0,0,1,1],7),r.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},18289:(e,t,n)=>{var r,i,s=e.exports=n(86416),a=n(43675);s.codegen=n(52012),s.fetch=n(63035),s.path=n(29986),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),n=Array(t.length),r=0;r<t.length;)n[r]=e[t[r++]];return n}return[]},s.toObject=function(e){for(var t={},n=0;n<e.length;){var r=e[n++],i=e[n++];void 0!==i&&(t[r]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;r||(r=n(69396));var i=new r(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=n(33982));var t=new i("Enum"+c++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},s.setProperty=function(e,t,n){function r(e,t,n){var i=t.shift();if("__proto__"===i||"prototype"===i)return e;if(t.length>0)e[i]=r(e[i]||{},t,n);else{var s=e[i];s&&(n=[].concat(s).concat(n)),e[i]=n}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return r(e,t=t.split("."),n)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(n(34955)))}})},59535:(e,t,n)=>{e.exports=i;var r=n(86416);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\x00\x00\x00\x00\x00\x00\x00\x00";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},86416:function(e,t,n){var r=t;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function s(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),n&&i(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(70799),r.base64=n(92130),r.EventEmitter=n(80854),r.float=n(14324),r.inquire=n(20449),r.utf8=n(78131),r.pool=n(56035),r.LongBits=n(59535),r.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),r.global=r.isNode&&global||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!!(null!=n&&e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;if(!e){r._Buffer_from=r._Buffer_allocUnsafe=null;return}r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},31181:(e,t,n)=>{e.exports=l;var r=n(33982),i=n(18289);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,n,i){if(t.resolvedType){if(t.resolvedType instanceof r){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",n,i)("if(e)")("return%j+e",t.name+".")("}")}else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,n){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",n)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",n)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",n)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n=e.oneofsArray,r={};n.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),o(t,u,"k[i]"),a(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,u,l,c+"[i]")("}");else{if(u.partOf){var h=i.safeProp(u.partOf.name);1===r[u.partOf.name]&&t("if(p%s===1)",h)("return%j",u.partOf.name+": multiple values"),r[u.partOf.name]=1,t("p%s=1",h)}a(t,u,l,c)}u.optional&&t("}")}return t("return null")}},82969:(e,t,n)=>{var r=t,i=n(55326);r[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),n=this.lookup(t);if(n){var r="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===r.indexOf("/")&&(r="/"+r),this.create({type_url:r,value:n.encode(n.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var n="type.googleapis.com/",r="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),r=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===r&&(r=n),s=r+l,o["@type"]=s,o}return this.toObject(e,t)}}},47474:(e,t,n)=>{e.exports=h;var r,i=n(86416),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function f(e,t,n){t[n]=255&e}function p(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}function g(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function y(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new l(e,t,n),this.len+=t,this},g.prototype=Object.create(l.prototype),g.prototype.fn=p,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new g((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(f,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var n=h.alloc(t=a.length(e));a.decode(e,n,0),e=n}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},96985:(e,t,n)=>{e.exports=s;var r=n(47474);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(86416);function s(){r.call(this)}function a(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},42229:(e,t,n)=>{var r=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(n(3729)),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(e,t){var n={};for(var r in e)!(t.indexOf(r)>=0)&&Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},a=function(e){var t=e.color,n=void 0===t?"currentColor":t,a=e.size,o=void 0===a?24:a,l=(e.children,s(e,["color","size","children"])),u="remixicon-icon "+(l.className||"");return r.default.createElement("svg",i({},l,{className:u,width:o,height:o,fill:n,viewBox:"0 0 24 24"}),r.default.createElement("path",{d:"M14.828 7.757l-5.656 5.657a1 1 0 1 0 1.414 1.414l5.657-5.656A3 3 0 1 0 12 4.929l-5.657 5.657a5 5 0 1 0 7.071 7.07L19.071 12l1.414 1.414-5.657 5.657a7 7 0 1 1-9.9-9.9l5.658-5.656a5 5 0 0 1 7.07 7.07L12 16.244A3 3 0 1 1 7.757 12l5.657-5.657 1.414 1.414z"}))},o=r.default.memo?r.default.memo(a):a;e.exports=o},9385:(e,t,n)=>{var r=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(n(3729)),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(e,t){var n={};for(var r in e)!(t.indexOf(r)>=0)&&Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},a=function(e){var t=e.color,n=void 0===t?"currentColor":t,a=e.size,o=void 0===a?24:a,l=(e.children,s(e,["color","size","children"])),u="remixicon-icon "+(l.className||"");return r.default.createElement("svg",i({},l,{className:u,width:o,height:o,fill:n,viewBox:"0 0 24 24"}),r.default.createElement("path",{d:"M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z"}))},o=r.default.memo?r.default.memo(a):a;e.exports=o},33276:(e,t,n)=>{var r=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(n(3729)),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(e,t){var n={};for(var r in e)!(t.indexOf(r)>=0)&&Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},a=function(e){var t=e.color,n=void 0===t?"currentColor":t,a=e.size,o=void 0===a?24:a,l=(e.children,s(e,["color","size","children"])),u="remixicon-icon "+(l.className||"");return r.default.createElement("svg",i({},l,{className:u,width:o,height:o,fill:n,viewBox:"0 0 24 24"}),r.default.createElement("path",{d:"M15.728 9.686l-1.414-1.414L5 17.586V19h1.414l9.314-9.314zm1.414-1.414l1.414-1.414-1.414-1.414-1.414 1.414 1.414 1.414zM7.242 21H3v-4.243L16.435 3.322a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414L7.243 21z"}))},o=r.default.memo?r.default.memo(a):a;e.exports=o},67039:(e,t,n)=>{var r=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(n(3729)),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(e,t){var n={};for(var r in e)!(t.indexOf(r)>=0)&&Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},a=function(e){var t=e.color,n=void 0===t?"currentColor":t,a=e.size,o=void 0===a?24:a,l=(e.children,s(e,["color","size","children"])),u="remixicon-icon "+(l.className||"");return r.default.createElement("svg",i({},l,{className:u,width:o,height:o,fill:n,viewBox:"0 0 24 24"}),r.default.createElement("path",{d:"M14 4.5V9c5.523 0 10 4.477 10 10 0 .273-.01.543-.032.81-1.463-2.774-4.33-4.691-7.655-4.805L16 15h-2v4.5L6 12l8-7.5zm-6 0v2.737L2.92 12l5.079 4.761L8 19.5 0 12l8-7.5zm4 4.616L8.924 12 12 14.883V13h4.034l.347.007c1.285.043 2.524.31 3.676.766C18.59 12.075 16.42 11 14 11h-2V9.116z"}))},o=r.default.memo?r.default.memo(a):a;e.exports=o},22606:(e,t,n)=>{var r=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(n(3729)),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(e,t){var n={};for(var r in e)!(t.indexOf(r)>=0)&&Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},a=function(e){var t=e.color,n=void 0===t?"currentColor":t,a=e.size,o=void 0===a?24:a,l=(e.children,s(e,["color","size","children"])),u="remixicon-icon "+(l.className||"");return r.default.createElement("svg",i({},l,{className:u,width:o,height:o,fill:n,viewBox:"0 0 24 24"}),r.default.createElement("path",{d:"M1.923 9.37c-.51-.205-.504-.51.034-.689l19.086-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.475.553-.717.07L11 13 1.923 9.37zm4.89-.2l5.636 2.255 3.04 6.082 3.546-12.41L6.812 9.17z"}))},o=r.default.memo?r.default.memo(a):a;e.exports=o},31468:(e,t)=>{var n,r=function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;/**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   */var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var s={},a={};function o(e,t){var n,r,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(r=a[e]))?r:(n=u(e,0,!0),i&&(a[e]=n),n):(e|=0,(i=-128<=e&&e<128)&&(r=s[e]))?r:(n=u(e,e<0?-1:0,!1),i&&(s[e]=n),n)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=p)return w}else{if(e<=-g)return E;if(e+1>=g)return C}return e<0?l(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=l,n.fromBits=u;var c=Math.pow;function h(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((n=n||10)<2||36<n)throw RangeError("radix");if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return h(e.substring(1),t,n).neg();for(var r,i=l(c(n,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+o),n);if(o<8){var d=l(c(n,o));s=s.mul(d).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=h,n.fromValue=d;var f=4294967296,p=18446744073709552e3,g=0x7fffffffffffffff,m=o(16777216),y=o(0);n.ZERO=y;var v=o(0,!0);n.UZERO=v;var b=o(1);n.ONE=b;var S=o(1,!0);n.UONE=S;var T=o(-1);n.NEG_ONE=T;var C=u(-1,2147483647,!1);n.MAX_VALUE=C;var w=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var E=u(0,-2147483648,!1);n.MIN_VALUE=E;var I=n.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(E))return"-"+this.neg().toString(e);var t=l(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}for(var i=l(c(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),u=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return(1&this.low)==1},I.isEven=function(){return(1&this.low)==0},I.equals=function(e){return r(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return 0>this.comp(e)},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return 0>=this.comp(e)},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(r(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(b)},I.neg=I.negate,I.add=function(e){r(e)||(e=d(e));var t,n,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,g=0;return t=0+((n=0+(o+f))>>>16),n&=65535,t+=a+h,g+=t>>>16,t&=65535,g+=s+c,p+=g>>>16,g&=65535,p+=i+l,u(t<<16|n,(p&=65535)<<16|g,this.unsigned)},I.subtract=function(e){return r(e)||(e=d(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return this;if(r(e)||(e=d(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(E))return e.isOdd()?E:y;if(e.eq(E))return this.isOdd()?E:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return l(this.toNumber()*e.toNumber(),this.unsigned);var n,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,c=65535&this.low,h=e.high>>>16,f=65535&e.high,p=e.low>>>16,g=65535&e.low,b=0,S=0;return n=0+((i=0+c*g)>>>16),i&=65535,n+=o*g,S+=n>>>16,n&=65535,n+=c*p,S+=n>>>16,n&=65535,S+=a*g,b+=S>>>16,S&=65535,S+=o*p,b+=S>>>16,S&=65535,S+=c*f,b+=S>>>16,S&=65535,b+=s*g+a*p+o*f+c*h,u(n<<16|i,(b&=65535)<<16|S,this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(r(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var n,i,s;return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return S;s=v}else{if(this.eq(E))return e.eq(b)||e.eq(T)?E:e.eq(E)?b:(n=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:T:(i=this.sub(e.mul(n)),s=n.add(i.div(e)));if(e.eq(E))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(n=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:c(2,a-48),h=l(n),f=h.mul(e);f.isNegative()||f.gt(i);)n-=o,f=(h=l(n,this.unsigned)).mul(e);h.isZero()&&(h=b),s=s.add(h),i=i.sub(f)}return s},I.div=I.divide,I.modulo=function(e){return(r(e)||(e=d(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return u(~this.low,~this.high,this.unsigned)},I.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},I.clz=I.countLeadingZeros,I.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},I.ctz=I.countTrailingZeros,I.and=function(e){return r(e)||(e=d(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return r(e)||(e=d(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return r(e)||(e=d(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.rotateLeft=function(e){var t;return(r(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},I.rotl=I.rotateLeft,I.rotateRight=function(e){var t;return(r(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},I.rotr=I.rotateRight,I.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var _=n;return e.default=_,"default"in e?e.default:e}({});void 0!==(n=(function(){return r}).apply(t,[]))&&(e.exports=n)},83289:(e,t,n)=>{n.d(t,{ET:()=>v0,hJ:()=>yP,oe:()=>vZ,JU:()=>yL,QT:()=>vQ,PL:()=>vJ,ad:()=>yz,cf:()=>v1,Xo:()=>vw,IO:()=>vv,Bt:()=>v5,r7:()=>vX,ar:()=>vS,qs:()=>v7});var r,i,s,a,o,l=n(17031),u=n(47059),c=n(71954),h=n(73837),d=n(36348),f=n(6113),p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},g={},m=m||{},y=p||self;function v(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function b(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function S(e){return Object.prototype.hasOwnProperty.call(e,T)&&e[T]||(e[T]=++C)}var T="closure_uid_"+(1e9*Math.random()>>>0),C=0;function w(e,t,n){return e.call.apply(e.bind,arguments)}function E(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function I(e,t,n){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:E).apply(null,arguments)}function _(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function R(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function k(){this.s=this.s,this.o=this.o}var A=0;k.prototype.s=!1,k.prototype.sa=function(){this.s||(this.s=!0,this.N(),0==A)||S(this)},k.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let D=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function x(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function N(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(v(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function O(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}O.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{y.addEventListener("test",()=>{},t),y.removeEventListener("test",()=>{},t)}catch(e){}return e}();function P(e){return/^[\s\xa0]*$/.test(e)}function L(){var e=y.navigator;return e&&(e=e.userAgent)?e:""}function B(e){return -1!=L().indexOf(e)}function F(e){return F[" "](e),e}function j(e,t){var n=n0;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}F[" "]=function(){};var U=B("Opera"),V=B("Trident")||B("MSIE"),z=B("Edge"),q=z||V,G=B("Gecko")&&!(-1!=L().toLowerCase().indexOf("webkit")&&!B("Edge"))&&!(B("Trident")||B("MSIE"))&&!B("Edge"),K=-1!=L().toLowerCase().indexOf("webkit")&&!B("Edge");function $(){var e=y.document;return e?e.documentMode:void 0}e:{var H="",W=function(){var e=L();return G?/rv:([^\);]+)(\)|;)/.exec(e):z?/Edge\/([\d\.]+)/.exec(e):V?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):K?/WebKit\/(\S+)/.exec(e):U?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(W&&(H=W?W[1]:""),V){var Q=$();if(null!=Q&&Q>parseFloat(H)){r=String(Q);break e}}r=H}var Y=i=y.document&&V&&($()||parseInt(r,10))||void 0;function J(e,t){if(O.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(G){e:{try{F(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:X[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&J.$.h.call(this)}}R(J,O);var X={2:"touch",3:"pen",4:"mouse"};J.prototype.h=function(){J.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Z="closure_listenable_"+(1e6*Math.random()|0),ee=0;function et(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++ee,this.fa=this.ia=!1}function en(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function er(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function ei(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function es(e){let t={};for(let n in e)t[n]=e[n];return t}let ea="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function eo(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<ea.length;t++)n=ea[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function el(e){this.src=e,this.g={},this.h=0}function eu(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=D(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(en(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ec(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&!!n==s.capture&&s.la==r)return i}return -1}el.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=ec(e,t,r,i);return -1<a?(t=e[a],n||(t.ia=!1)):((t=new et(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var eh="closure_lm_"+(1e6*Math.random()|0),ed={};function ef(e,t,n,r,i){if(r&&r.once)return em(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ef(e,t[s],n,r,i);return null}return n=ew(n),e&&e[Z]?e.O(t,n,b(r)?!!r.capture:!!r,i):ep(e,t,n,!1,r,i)}function ep(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=b(i)?!!i.capture:!!i,o=eT(e);if(o||(e[eh]=o=new el(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=eg(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)M||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(eb(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function eg(){function e(n){return t.call(e.src,e.listener,n)}let t=eS;return e}function em(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)em(e,t[s],n,r,i);return null}return n=ew(n),e&&e[Z]?e.P(t,n,b(r)?!!r.capture:!!r,i):ep(e,t,n,!0,r,i)}function ey(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)ey(e,t[s],n,r,i);else(r=b(r)?!!r.capture:!!r,n=ew(n),e&&e[Z])?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=ec(s=e.g[t],n,r,i))&&(en(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=eT(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ec(t,n,r,i)),(n=-1<e?t[e]:null)&&ev(n))}function ev(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[Z])eu(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(eb(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=eT(t))?(eu(n,e),0==n.h&&(n.src=null,t[eh]=null)):en(e)}}}function eb(e){return e in ed?ed[e]:ed[e]="on"+e}function eS(e,t){if(e.fa)e=!0;else{t=new J(t,this);var n=e.listener,r=e.la||e.src;e.ia&&ev(e),e=n.call(r,t)}return e}function eT(e){return(e=e[eh])instanceof el?e:null}var eC="__closure_events_fn_"+(1e9*Math.random()>>>0);function ew(e){return"function"==typeof e?e:(e[eC]||(e[eC]=function(t){return e.handleEvent(t)}),e[eC])}function eE(){k.call(this),this.i=new el(this),this.S=this,this.J=null}function eI(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new O(t,e);else if(t instanceof O)t.target=t.target||e;else{var i=t;eo(t=new O(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=e_(a,r,!0,t)&&i}if(i=e_(a=t.g=e,r,!0,t)&&i,i=e_(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=e_(a=t.g=n[s],r,!1,t)&&i}function e_(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.fa&&a.capture==n){var o=a.listener,l=a.la||a.src;a.ia&&eu(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}R(eE,k),eE.prototype[Z]=!0,eE.prototype.removeEventListener=function(e,t,n,r){ey(this,e,t,n,r)},eE.prototype.N=function(){if(eE.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)en(n[r]);delete t.g[e],t.h--}}this.J=null},eE.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},eE.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var eR=y.JSON.stringify;class ek{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function eA(){var e=eB;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}class eD{constructor(){this.h=this.g=null}add(e,t){let n=ex.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var ex=new ek(()=>new eN,e=>e.reset());class eN{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function eO(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function eM(e){y.setTimeout(()=>{throw e},0)}let eP,eL=!1,eB=new eD,eF=()=>{let e=y.Promise.resolve(void 0);eP=()=>{e.then(ej)}};var ej=()=>{for(var e;e=eA();){try{e.h.call(e.g)}catch(e){eM(e)}var t=ex;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}eL=!1};function eU(e,t){eE.call(this),this.h=e||1,this.g=t||y,this.j=I(this.qb,this),this.l=Date.now()}function eV(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function ez(e,t,n){if("function"==typeof e)n&&(e=I(e,n));else if(e&&"function"==typeof e.handleEvent)e=I(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:y.setTimeout(e,t||0)}function eq(e){e.g=ez(()=>{e.g=null,e.i&&(e.i=!1,eq(e))},e.j);let t=e.h;e.h=null,e.m.apply(null,t)}R(eU,eE),(o=eU.prototype).ga=!1,o.T=null,o.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),eI(this,"tick"),this.ga&&(eV(this),this.start()))}},o.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},o.N=function(){eU.$.N.call(this),eV(this),delete this.g};class eG extends k{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:eq(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eK(e){k.call(this),this.h=e,this.g={}}R(eK,k);var e$=[];function eH(e,t,n,r){Array.isArray(n)||(n&&(e$[0]=n.toString()),n=e$);for(var i=0;i<n.length;i++){var s=ef(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function eW(e){er(e.g,function(e,t){this.g.hasOwnProperty(t)&&ev(e)},e),e.g={}}function eQ(){this.g=!0}function eY(e,t,n,r,i,s){e.info(function(){if(e.g){if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var c=u[0];u=u[1];var h=c.split("_");a=2<=h.length&&"type"==h[1]?a+(c+"=")+u+"&":a+(c+"=redacted&")}}else a=null}else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a})}function eJ(e,t,n,r,i,s,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a})}function eX(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+e0(e,n)+(r?" "+r:"")})}function eZ(e,t){e.info(function(){return"TIMEOUT: "+t})}function e0(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return eR(n)}catch(e){return t}}eK.prototype.N=function(){eK.$.N.call(this),eW(this)},eK.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},eQ.prototype.Ea=function(){this.g=!1},eQ.prototype.info=function(){};var e1={},e2=null;function e4(){return e2=e2||new eE}function e3(e){O.call(this,e1.Ta,e)}function e6(e){let t=e4();eI(t,new e3(t))}function e9(e,t){O.call(this,e1.STAT_EVENT,e),this.stat=t}function e5(e){let t=e4();eI(t,new e9(t,e))}function e7(e,t){O.call(this,e1.Ua,e),this.size=t}function e8(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){e()},t)}e1.Ta="serverreachability",R(e3,O),e1.STAT_EVENT="statevent",R(e9,O),e1.Ua="timingevent",R(e7,O);var te={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},tt={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function tn(){}function tr(e){return e.h||(e.h=e.i())}function ti(){}tn.prototype.h=null;var ts={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ta(){O.call(this,"d")}function to(){O.call(this,"c")}function tl(){}function tu(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new eK(this),this.P=th,e=q?125:void 0,this.V=new eU(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new tc}function tc(){this.i=null,this.g="",this.h=!1}R(ta,O),R(to,O),R(tl,tn),tl.prototype.g=function(){return new XMLHttpRequest},tl.prototype.i=function(){return{}},s=new tl;var th=45e3,td={},tf={};function tp(e,t,n){e.L=1,e.v=tL(tx(t)),e.s=n,e.S=!0,tg(e,null)}function tg(e,t){e.G=Date.now(),tb(e),e.A=tx(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),tQ(n.i,"t",r),e.C=0,n=e.l.J,e.h=new tc,e.g=nG(e.l,n?t:null,!e.s),0<e.O&&(e.M=new eG(I(e.Pa,e,e.g),e.O)),eH(e.U,e.g,"readystatechange",e.nb),t=e.I?es(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),e6(),eY(e.j,e.u,e.A,e.m,e.W,e.s)}function tm(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function ty(e,t,n){let r=!0,i;for(;!e.J&&e.C<n.length;)if((i=tv(e,n))==tf){4==t&&(e.o=4,e5(14),r=!1),eX(e.j,e.m,null,"[Incomplete Response]");break}else if(i==td){e.o=4,e5(15),eX(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else eX(e.j,e.m,i,null),tE(e,i);tm(e)&&i!=tf&&i!=td&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,e5(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),nL(t),t.M=!0,e5(11))):(eX(e.j,e.m,n,"[Invalid Chunked Response]"),tw(e),tC(e))}function tv(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?tf:isNaN(n=Number(t.substring(n,r)))?td:(r+=1)+n>t.length?tf:(t=t.slice(r,r+n),e.C=r+n,t)}function tb(e){e.Y=Date.now()+e.P,tS(e,e.P)}function tS(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=e8(I(e.lb,e),t)}function tT(e){e.B&&(y.clearTimeout(e.B),e.B=null)}function tC(e){0==e.l.H||e.J||nj(e.l,e)}function tw(e){tT(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,eV(e.V),eW(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function tE(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||t4(n.i,e))){if(!e.K&&t4(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(n.g.G+3e3<e.G)nF(n),nR(n);else break e}nP(n),e5(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=e8(I(n.ib,n),6e3));if(1>=t2(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else nV(n,11)}else if((e.K||n.g==e)&&nF(n),!P(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H){if("c"==u[0]){n.K=u[1],n.pa=u[2];let t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));let i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));let c=u[5];null!=c&&"number"==typeof c&&0<c&&(r=1.5*c,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(t3(s,s.h),s.h=null))}if(r.F){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,tP(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var a=e;if(r.wa=nq(r,r.J?r.pa:null,r.Y),a.K){t6(r.i,a);var o=a,l=r.L;l&&o.setTimeout(l),o.B&&(tT(o),tb(o)),r.g=a}else nM(r);0<n.j.length&&nA(n)}else"stop"!=u[0]&&"close"!=u[0]||nV(n,7)}else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?nV(n,7):n_(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}}e6(4)}catch(e){}}function tI(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(v(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}function t_(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(v(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}function tR(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(v(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=t_(e),r=tI(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(o=tu.prototype).setTimeout=function(e){this.P=e},o.nb=function(e){e=e.target;let t=this.M;t&&3==nb(e)?t.l():this.Pa(e)},o.Pa=function(e){try{if(e==this.g)e:{let c=nb(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>c)&&(3!=c||q||this.g&&(this.h.h||this.g.ja()||nS(this.g)))){this.J||4!=c||7==t||(8==t||0>=h?e6(3):e6(2)),tT(this);var n=this.g.da();this.ca=n;t:if(tm(this)){var r=nS(this.g);e="";var i=r.length,s=4==nb(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){tw(this),tC(this);var a="";break t}this.h.i=new y.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ja();if(this.i=200==n,eJ(this.j,this.u,this.A,this.m,this.W,c,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var o,l=this.g;if((o=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(o)){var u=o;break t}}u=null}if(n=u)eX(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,tE(this,n);else{this.i=!1,this.o=3,e5(12),tw(this),tC(this);break e}}this.S?(ty(this,c,a),q&&this.i&&3==c&&(eH(this.U,this.V,"tick",this.mb),this.V.start())):(eX(this.j,this.m,a,null),tE(this,a)),4==c&&tw(this),this.i&&!this.J&&(4==c?nj(this.l,this):(this.i=!1,tb(this)))}else nT(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.o=3,e5(12)):(this.o=0,e5(13)),tw(this),tC(this)}}}catch(e){}finally{}},o.mb=function(){if(this.g){var e=nb(this.g),t=this.g.ja();this.C<t.length&&(tT(this),ty(this,e,t),this.i&&4!=e&&tb(this))}},o.cancel=function(){this.J=!0,tw(this)},o.lb=function(){this.B=null;let e=Date.now();0<=e-this.Y?(eZ(this.j,this.A),2!=this.L&&(e6(),e5(17)),tw(this),this.o=2,tC(this)):tS(this,this.Y-e)};var tk=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tA(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function tD(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof tD){this.h=e.h,tN(this,e.j),this.s=e.s,this.g=e.g,tO(this,e.m),this.l=e.l;var t=e.i,n=new tK;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tM(this,n),this.o=e.o}else e&&(t=String(e).match(tk))?(this.h=!1,tN(this,t[1]||"",!0),this.s=tB(t[2]||""),this.g=tB(t[3]||"",!0),tO(this,t[4]),this.l=tB(t[5]||"",!0),tM(this,t[6]||"",!0),this.o=tB(t[7]||"")):(this.h=!1,this.i=new tK(null,this.h))}function tx(e){return new tD(e)}function tN(e,t,n){e.j=n?tB(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tO(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function tM(e,t,n){t instanceof tK?(e.i=t,tJ(e.i,e.h)):(n||(t=tF(t,tq)),e.i=new tK(t,e.h))}function tP(e,t,n){e.i.set(t,n)}function tL(e){return tP(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function tB(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tF(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,tj),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function tj(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}tD.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tF(t,tU,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(tF(t,tU,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tF(n,"/"==n.charAt(0)?tz:tV,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tF(n,tG)),e.join("")};var tU=/[#\/\?@]/g,tV=/[#\?:]/g,tz=/[#\?]/g,tq=/[#\?@]/g,tG=/#/g;function tK(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function t$(e){e.g||(e.g=new Map,e.h=0,e.i&&tA(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tH(e,t){t$(e),t=tY(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tW(e,t){return t$(e),t=tY(e,t),e.g.has(t)}function tQ(e,t,n){tH(e,t),0<n.length&&(e.i=null,e.g.set(tY(e,t),x(n)),e.h+=n.length)}function tY(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tJ(e,t){t&&!e.j&&(t$(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tH(this,t),tQ(this,n,e))},e)),e.j=t}(o=tK.prototype).add=function(e,t){t$(this),this.i=null,e=tY(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},o.forEach=function(e,t){t$(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},o.ta=function(){t$(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},o.Z=function(e){t$(this);let t=[];if("string"==typeof e)tW(this,e)&&(t=t.concat(this.g.get(tY(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},o.set=function(e,t){return t$(this),this.i=null,tW(this,e=tY(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},o.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},o.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")};var tX=class{constructor(e,t){this.g=e,this.map=t}};function tZ(e){this.l=e||t0,e=y.PerformanceNavigationTiming?0<(e=y.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(y.g&&y.g.Ka&&y.g.Ka()&&y.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var t0=10;function t1(e){return!!e.h||!!e.g&&e.g.size>=e.j}function t2(e){return e.h?1:e.g?e.g.size:0}function t4(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function t3(e,t){e.g?e.g.add(t):e.h=t}function t6(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function t9(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return x(e.i)}tZ.prototype.cancel=function(){if(this.i=t9(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var t5=class{stringify(e){return y.JSON.stringify(e,void 0)}parse(e){return y.JSON.parse(e,void 0)}};function t7(){this.g=new t5}function t8(e,t,n){let r=n||"";try{tR(e,function(e,n){let i=e;b(e)&&(i=eR(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function ne(e,t){let n=new eQ;if(y.Image){let r=new Image;r.onload=_(nt,n,r,"TestLoadImage: loaded",!0,t),r.onerror=_(nt,n,r,"TestLoadImage: error",!1,t),r.onabort=_(nt,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=_(nt,n,r,"TestLoadImage: timeout",!1,t),y.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function nt(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function nn(e){this.l=e.ec||null,this.j=e.ob||!1}function nr(e,t){eE.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=ni,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}R(nn,tn),nn.prototype.g=function(){return new nr(this.l,this.j)},nn.prototype.i=function(e){return function(){return e}}({}),R(nr,eE);var ni=0;function ns(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function na(e){e.readyState=4,e.l=null,e.j=null,e.A=null,no(e)}function no(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(o=nr.prototype).open=function(e,t){if(this.readyState!=ni)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,no(this)},o.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||y).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},o.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,na(this)),this.readyState=ni},o.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,no(this)),this.g&&(this.readyState=3,no(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==y.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ns(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))}},o.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?na(this):no(this),3==this.readyState&&ns(this)}},o.Za=function(e){this.g&&(this.response=this.responseText=e,na(this))},o.Ya=function(e){this.g&&(this.response=e,na(this))},o.ka=function(){this.g&&na(this)},o.setRequestHeader=function(e,t){this.v.append(e,t)},o.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},o.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(nr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var nl=y.JSON.parse;function nu(e){eE.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=nc,this.L=this.M=!1}R(nu,eE);var nc="",nh=/^https?$/i,nd=["POST","PUT"];function nf(e){return V&&"number"==typeof e.timeout&&void 0!==e.ontimeout}function np(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,ng(e),ny(e)}function ng(e){e.F||(e.F=!0,eI(e,"complete"),eI(e,"error"))}function nm(e){if(e.h&&void 0!==m&&(!e.C[1]||4!=nb(e)||2!=e.da())){if(e.v&&4==nb(e))ez(e.La,0,e);else if(eI(e,"readystatechange"),4==nb(e)){e.h=!1;try{let a=e.da();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===a){var i=String(e.I).match(tk)[1]||null;!i&&y.self&&y.self.location&&(i=y.self.location.protocol.slice(0,-1)),n=!nh.test(i?i.toLowerCase():"")}t=n}if(t)eI(e,"complete"),eI(e,"success");else{e.m=6;try{var s=2<nb(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",ng(e)}}finally{ny(e)}}}}function ny(e,t){if(e.g){nv(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||eI(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function nv(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(y.clearTimeout(e.A),e.A=null)}function nb(e){return e.g?e.g.readyState:0}function nS(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case nc:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function nT(e){let t={};e=(e.g&&2<=nb(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(P(e[r]))continue;var n=eO(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}ei(t,function(e){return e.join(", ")})}function nC(e){let t="";return er(e,function(e,n){t+=n+":"+e+"\r\n"}),t}function nw(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=nC(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tP(e,t,n))}function nE(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function nI(e){this.Ga=0,this.j=[],this.l=new eQ,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=nE("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=nE("baseRetryDelayMs",5e3,e),this.hb=nE("retryDelaySeedMs",1e4,e),this.eb=nE("forwardChannelMaxRetries",2,e),this.xa=nE("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new tZ(e&&e.concurrentRequestLimit),this.Ja=new t7,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function n_(e){if(nk(e),3==e.H){var t=e.W++,n=tx(e.I);if(tP(n,"SID",e.K),tP(n,"RID",t),tP(n,"TYPE","terminate"),nN(e,n),(t=new tu(e,e.l,t)).L=2,t.v=tL(tx(n)),n=!1,y.navigator&&y.navigator.sendBeacon)try{n=y.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&y.Image&&((new Image).src=t.v,n=!0),n||(t.g=nG(t.l,null),t.g.ha(t.v)),t.G=Date.now(),tb(t)}nz(e)}function nR(e){e.g&&(nL(e),e.g.cancel(),e.g=null)}function nk(e){nR(e),e.u&&(y.clearTimeout(e.u),e.u=null),nF(e),e.i.cancel(),e.m&&("number"==typeof e.m&&y.clearTimeout(e.m),e.m=null)}function nA(e){if(!t1(e.i)&&!e.m){e.m=!0;var t=e.Na;eP||eF(),eL||(eP(),eL=!0),eB.add(t,e),e.C=0}}function nD(e,t){return!(t2(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.j=t.F.concat(e.j),!0):1!=e.H&&2!=e.H&&!(e.C>=(e.cb?0:e.eb))&&(e.m=e8(I(e.Na,e,t),nU(e,e.C)),e.C++,!0))}function nx(e,t){var n;n=t?t.m:e.W++;let r=tx(e.I);tP(r,"SID",e.K),tP(r,"RID",n),tP(r,"AID",e.V),nN(e,r),e.o&&e.s&&nw(r,e.o,e.s),n=new tu(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=nO(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),t3(e.i,n),tp(n,r,t)}function nN(e,t){e.na&&er(e.na,function(e,n){tP(t,n,e)}),e.h&&tR({},function(e,n){tP(t,n,e)})}function nO(e,t,n){n=Math.min(e.j.length,n);var r=e.h?I(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{t8(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function nM(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;eP||eF(),eL||(eP(),eL=!0),eB.add(t,e),e.A=0}}function nP(e){return!e.g&&!e.u&&!(3<=e.A)&&(e.ba++,e.u=e8(I(e.Ma,e),nU(e,e.A)),e.A++,!0)}function nL(e){null!=e.B&&(y.clearTimeout(e.B),e.B=null)}function nB(e){e.g=new tu(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=tx(e.wa);tP(t,"RID","rpc"),tP(t,"SID",e.K),tP(t,"AID",e.V),tP(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&tP(t,"TO",e.qa),tP(t,"TYPE","xmlhttp"),nN(e,t),e.o&&e.s&&nw(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=tL(tx(t)),n.s=null,n.S=!0,tg(n,e)}function nF(e){null!=e.v&&(y.clearTimeout(e.v),e.v=null)}function nj(e,t){var n=null;if(e.g==t){nF(e),nL(e),e.g=null;var r=2}else{if(!t4(e.i,t))return;n=t.F,t6(e.i,t),r=1}if(0!=e.H){if(t.i){if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;eI(r=e4(),new e7(r,n)),nA(e)}else nM(e)}else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&nD(e,t)||2==r&&nP(e)))switch(n&&0<n.length&&((t=e.i).i=t.i.concat(n)),i){case 1:nV(e,5);break;case 4:nV(e,10);break;case 3:nV(e,6);break;default:nV(e,2)}}}function nU(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function nV(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=I(e.pb,e);n||(n=new tD("//www.google.com/images/cleardot.gif"),y.location&&"http"==y.location.protocol||tN(n,"https"),tL(n)),ne(n.toString(),r)}else e5(2);e.H=0,e.h&&e.h.za(t),nz(e),nk(e)}function nz(e){if(e.H=0,e.ma=[],e.h){let t=t9(e.i);(0!=t.length||0!=e.j.length)&&(N(e.ma,t),N(e.ma,e.j),e.i.i.length=0,x(e.j),e.j.length=0),e.h.ya()}}function nq(e,t,n){var r=n instanceof tD?tx(n):new tD(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tO(r,r.m);else{var i=y.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new tD(null);r&&tN(s,r),t&&(s.g=t),i&&tO(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&tP(r,n,t),tP(r,"VER",e.ra),nN(e,r),r}function nG(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new nu(n&&e.Ha&&!e.va?new nn({ob:!0}):e.va)).Oa(e.J),t}function nK(){}function n$(){if(V&&!(10<=Number(Y)))throw Error("Environmental error: no available transport.")}function nH(e,t){eE.call(this),this.g=new nI(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!P(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!P(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nY(this)}function nW(e){ta.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nQ(){to.call(this),this.status=1}function nY(e){this.g=e}function nJ(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function nX(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+3614090360&4294967295;a=s+(i^(t=n+(a<<7&4294967295|a>>>25))&(n^i))+r[1]+3905402710&4294967295,a=i+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+r[2]+606105819&4294967295,a=n+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+r[3]+3250441966&4294967295,a=t+(s^(n=i+(a<<22&4294967295|a>>>10))&(i^s))+r[4]+4118548399&4294967295,a=s+(i^(t=n+(a<<7&4294967295|a>>>25))&(n^i))+r[5]+1200080426&4294967295,a=i+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+r[6]+2821735955&4294967295,a=n+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+r[7]+4249261313&4294967295,a=t+(s^(n=i+(a<<22&4294967295|a>>>10))&(i^s))+r[8]+1770035416&4294967295,a=s+(i^(t=n+(a<<7&4294967295|a>>>25))&(n^i))+r[9]+2336552879&4294967295,a=i+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+r[10]+4294925233&4294967295,a=n+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+r[11]+2304563134&4294967295,a=t+(s^(n=i+(a<<22&4294967295|a>>>10))&(i^s))+r[12]+1804603682&4294967295,a=s+(i^(t=n+(a<<7&4294967295|a>>>25))&(n^i))+r[13]+4254626195&4294967295,a=i+(n^(s=t+(a<<12&4294967295|a>>>20))&(t^n))+r[14]+2792965006&4294967295,a=n+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+r[15]+1236535329&4294967295,n=i+(a<<22&4294967295|a>>>10),a=t+(i^s&(n^i))+r[1]+4129170786&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^i&(t^n))+r[6]+3225465664&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^n&(s^t))+r[11]+643717713&4294967295,i=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(i^s))+r[0]+3921069994&4294967295,n=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(n^i))+r[5]+3593408605&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^i&(t^n))+r[10]+38016083&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^n&(s^t))+r[15]+3634488961&4294967295,i=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(i^s))+r[4]+3889429448&4294967295,n=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(n^i))+r[9]+568446438&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^i&(t^n))+r[14]+3275163606&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^n&(s^t))+r[3]+4107603335&4294967295,i=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(i^s))+r[8]+1163531501&4294967295,n=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(n^i))+r[13]+2850285829&4294967295,t=n+(a<<5&4294967295|a>>>27),a=s+(n^i&(t^n))+r[2]+4243563512&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^n&(s^t))+r[7]+1735328473&4294967295,i=s+(a<<14&4294967295|a>>>18),a=n+(s^t&(i^s))+r[12]+2368359562&4294967295,a=t+((n=i+(a<<20&4294967295|a>>>12))^i^s)+r[5]+4294588738&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^i)+r[8]+2272392833&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^n)+r[11]+1839030562&4294967295,a=n+((i=s+(a<<16&4294967295|a>>>16))^s^t)+r[14]+4259657740&4294967295,a=t+((n=i+(a<<23&4294967295|a>>>9))^i^s)+r[1]+2763975236&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^i)+r[4]+1272893353&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^n)+r[7]+4139469664&4294967295,a=n+((i=s+(a<<16&4294967295|a>>>16))^s^t)+r[10]+3200236656&4294967295,a=t+((n=i+(a<<23&4294967295|a>>>9))^i^s)+r[13]+681279174&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^i)+r[0]+3936430074&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^n)+r[3]+3572445317&4294967295,a=n+((i=s+(a<<16&4294967295|a>>>16))^s^t)+r[6]+76029189&4294967295,a=t+((n=i+(a<<23&4294967295|a>>>9))^i^s)+r[9]+3654602809&4294967295,a=s+((t=n+(a<<4&4294967295|a>>>28))^n^i)+r[12]+3873151461&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^n)+r[15]+530742520&4294967295,a=n+((i=s+(a<<16&4294967295|a>>>16))^s^t)+r[2]+3299628645&4294967295,n=i+(a<<23&4294967295|a>>>9),a=t+(i^(n|~s))+r[0]+4096336452&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~i))+r[7]+1126891415&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~n))+r[14]+2878612391&4294967295,i=s+(a<<15&4294967295|a>>>17),a=n+(s^(i|~t))+r[5]+4237533241&4294967295,n=i+(a<<21&4294967295|a>>>11),a=t+(i^(n|~s))+r[12]+1700485571&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~i))+r[3]+2399980690&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~n))+r[10]+4293915773&4294967295,i=s+(a<<15&4294967295|a>>>17),a=n+(s^(i|~t))+r[1]+2240044497&4294967295,n=i+(a<<21&4294967295|a>>>11),a=t+(i^(n|~s))+r[8]+1873313359&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~i))+r[15]+4264355552&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~n))+r[6]+2734768916&4294967295,i=s+(a<<15&4294967295|a>>>17),a=n+(s^(i|~t))+r[13]+1309151649&4294967295,n=i+(a<<21&4294967295|a>>>11),a=t+(i^(n|~s))+r[4]+4149444226&4294967295,t=n+(a<<6&4294967295|a>>>26),a=s+(n^(t|~i))+r[11]+3174756917&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~n))+r[2]+718787259&4294967295,i=s+(a<<15&4294967295|a>>>17),a=n+(s^(i|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function nZ(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(o=nu.prototype).Oa=function(e){this.M=e},o.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():s.g(),this.C=this.u?tr(this.u):tr(s),this.g.onreadystatechange=I(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){np(this,e);return}if(e=n||"",n=new Map(this.headers),r){if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())n.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r))}for(let[s,a]of(r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=y.FormData&&e instanceof y.FormData,!(0<=D(nd,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{nv(this),0<this.B&&((this.L=nf(this.g))?(this.g.timeout=this.B,this.g.ontimeout=I(this.ua,this)):this.A=ez(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){np(this,e)}},o.ua=function(){void 0!==m&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,eI(this,"timeout"),this.abort(8))},o.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,eI(this,"complete"),eI(this,"abort"),ny(this))},o.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ny(this,!0)),nu.$.N.call(this)},o.La=function(){this.s||(this.G||this.v||this.l?nm(this):this.kb())},o.kb=function(){nm(this)},o.isActive=function(){return!!this.g},o.da=function(){try{return 2<nb(this)?this.g.status:-1}catch(e){return -1}},o.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},o.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),nl(t)}},o.Ia=function(){return this.m},o.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(o=nI.prototype).ra=8,o.H=1,o.Na=function(e){if(this.m){if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let i=new tu(this,this.l,e),s=this.s;if(this.U&&(s?eo(s=es(s),this.U):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=nO(this,i,t),tP(n=tx(this.I),"RID",e),tP(n,"CVER",22),this.F&&tP(n,"X-HTTP-Session-Id",this.F),nN(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(nC(s)))+"&"+t:this.o&&nw(n,this.o,s)),t3(this.i,i),this.bb&&tP(n,"TYPE","init"),this.P?(tP(n,"$req",t),tP(n,"SID","null"),i.aa=!0,tp(i,n,null)):tp(i,n,t),this.H=2}}else 3==this.H&&(e?nx(this,e):0==this.j.length||t1(this.i)||nx(this))}},o.Ma=function(){if(this.u=null,nB(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=e8(I(this.jb,this),e)}},o.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,e5(10),nR(this),nB(this))},o.ib=function(){null!=this.v&&(this.v=null,nR(this),nP(this),e5(19))},o.pb=function(e){e?(this.l.info("Successfully pinged google.com"),e5(2)):(this.l.info("Failed to ping google.com"),e5(1))},o.isActive=function(){return!!this.h&&this.h.isActive(this)},(o=nK.prototype).Ba=function(){},o.Aa=function(){},o.za=function(){},o.ya=function(){},o.isActive=function(){return!0},o.Va=function(){},n$.prototype.g=function(e,t){return new nH(e,t)},R(nH,eE),nH.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;e5(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=nq(e,null,e.Y),nA(e)},nH.prototype.close=function(){n_(this.g)},nH.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=eR(e),e=n);t.j.push(new tX(t.fb++,e)),3==t.H&&nA(t)},nH.prototype.N=function(){this.g.h=null,delete this.j,n_(this.g),delete this.g,nH.$.N.call(this)},R(nW,ta),R(nQ,to),R(nY,nK),nY.prototype.Ba=function(){eI(this.g,"a")},nY.prototype.Aa=function(e){eI(this.g,new nW(e))},nY.prototype.za=function(e){eI(this.g,new nQ)},nY.prototype.ya=function(){eI(this.g,"b")},R(nJ,function(){this.blockSize=-1}),nJ.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},nJ.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)nX(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){nX(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){nX(this,r),i=0;break}}this.h=i,this.i+=t},nJ.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var n0={};function n1(e){return -128<=e&&128>e?j(e,function(e){return new nZ([0|e],0>e?-1:0)}):new nZ([0|e],0>e?-1:0)}function n2(e){if(isNaN(e)||!isFinite(e))return n6;if(0>e)return re(n2(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=n3;return new nZ(t,0)}function n4(e,t){if(0==e.length)throw Error("number format error: empty string");if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return re(n4(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=n2(Math.pow(t,8)),r=n6,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+s),t);8>s?(s=n2(Math.pow(t,s)),r=r.R(s).add(n2(a))):r=(r=r.R(n)).add(n2(a))}return r}var n3=4294967296,n6=n1(0),n9=n1(1),n5=n1(16777216);function n7(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function n8(e){return -1==e.h}function re(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new nZ(n,~e.h).add(n9)}function rt(e,t){return e.add(re(t))}function rn(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function rr(e,t){this.g=e,this.h=t}function ri(e,t){if(n7(t))throw Error("division by zero");if(n7(e))return new rr(n6,n6);if(n8(e))return t=ri(re(e),t),new rr(re(t.g),re(t.h));if(n8(t))return t=ri(e,re(t)),new rr(re(t.g),t.h);if(30<e.g.length){if(n8(e)||n8(t))throw Error("slowDivide_ only works with positive integers.");for(var n=n9,r=t;0>=r.X(e);)n=rs(n),r=rs(r);var i=ra(n,1),s=ra(r,1);for(r=ra(r,2),n=ra(n,2);!n7(r);){var a=s.add(r);0>=a.X(e)&&(i=i.add(n),s=a),r=ra(r,1),n=ra(n,1)}return t=rt(e,i.R(t)),new rr(i,t)}for(i=n6;0<=e.X(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.ea()/t.ea())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=n2(n)).R(t);n8(a)||0<a.X(e);)n-=r,a=(s=n2(n)).R(t);n7(s)&&(s=n9),i=i.add(s),e=rt(e,a)}return new rr(i,e)}function rs(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new nZ(n,e.h)}function ra(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new nZ(i,e.h)}(o=nZ.prototype).ea=function(){if(n8(this))return-re(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:n3+r)*t,t*=n3}return e},o.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(n7(this))return"0";if(n8(this))return"-"+re(this).toString(e);for(var t=n2(Math.pow(e,6)),n=this,r="";;){var i=ri(n,t).g,s=((0<(n=rt(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(n7(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},o.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},o.X=function(e){return n8(e=rt(this,e))?-1:n7(e)?0:1},o.abs=function(){return n8(this)?re(this):this},o.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=a>>>16,s&=65535,a&=65535,n[i]=a<<16|s}return new nZ(n,-2147483648&n[n.length-1]?-1:0)},o.R=function(e){if(n7(this)||n7(e))return n6;if(n8(this))return n8(e)?re(this).R(re(e)):re(re(this).R(e));if(n8(e))return re(this.R(re(e)));if(0>this.X(n5)&&0>e.X(n5))return n2(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),o=e.D(i)>>>16,l=65535&e.D(i);n[2*r+2*i]+=a*l,rn(n,2*r+2*i),n[2*r+2*i+1]+=s*l,rn(n,2*r+2*i+1),n[2*r+2*i+1]+=a*o,rn(n,2*r+2*i+1),n[2*r+2*i+2]+=s*o,rn(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new nZ(n,0)},o.gb=function(e){return ri(this,e).h},o.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new nZ(n,this.h&e.h)},o.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new nZ(n,this.h|e.h)},o.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new nZ(n,this.h^e.h)},n$.prototype.createWebChannel=n$.prototype.g,nH.prototype.send=nH.prototype.u,nH.prototype.open=nH.prototype.m,nH.prototype.close=nH.prototype.close,te.NO_ERROR=0,te.TIMEOUT=8,te.HTTP_ERROR=6,tt.COMPLETE="complete",ti.EventType=ts,ts.OPEN="a",ts.CLOSE="b",ts.ERROR="c",ts.MESSAGE="d",eE.prototype.listen=eE.prototype.O,nu.prototype.listenOnce=nu.prototype.P,nu.prototype.getLastError=nu.prototype.Sa,nu.prototype.getLastErrorCode=nu.prototype.Ia,nu.prototype.getStatus=nu.prototype.da,nu.prototype.getResponseJson=nu.prototype.Wa,nu.prototype.getResponseText=nu.prototype.ja,nu.prototype.send=nu.prototype.ha,nu.prototype.setWithCredentials=nu.prototype.Oa,nJ.prototype.digest=nJ.prototype.l,nJ.prototype.reset=nJ.prototype.reset,nJ.prototype.update=nJ.prototype.j,nZ.prototype.add=nZ.prototype.add,nZ.prototype.multiply=nZ.prototype.R,nZ.prototype.modulo=nZ.prototype.gb,nZ.prototype.compare=nZ.prototype.X,nZ.prototype.toNumber=nZ.prototype.ea,nZ.prototype.toString=nZ.prototype.toString,nZ.prototype.getBits=nZ.prototype.D,nZ.fromNumber=n2,nZ.fromString=n4,g.createWebChannelTransport=function(){return new n$},g.getStatEventTarget=function(){return e4()},g.ErrorCode=te,g.EventType=tt,g.Event=e1,g.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},g.FetchXmlHttpFactory=nn,g.WebChannel=ti,g.XhrIo=nu;var ro=g.Md5=nJ,rl=g.Integer=nZ,ru=n(22165),rc=n(58715);let rh="@firebase/firestore",rd="4.3.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}rf.UNAUTHENTICATED=new rf(null),rf.GOOGLE_CREDENTIALS=new rf("google-credentials-uid"),rf.FIRST_PARTY=new rf("first-party-uid"),rf.MOCK_USER=new rf("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rp="10.5.2";function rg(e){rp=e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rm(e){return(0,h.inspect)(e,{depth:100})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ry=new c.Yd("@firebase/firestore");function rv(){return ry.logLevel}function rb(e,...t){if(ry.logLevel<=c.in.DEBUG){let n=t.map(rC);ry.debug(`Firestore (${rp}): ${e}`,...n)}}function rS(e,...t){if(ry.logLevel<=c.in.ERROR){let n=t.map(rC);ry.error(`Firestore (${rp}): ${e}`,...n)}}function rT(e,...t){if(ry.logLevel<=c.in.WARN){let n=t.map(rC);ry.warn(`Firestore (${rp}): ${e}`,...n)}}function rC(e){if("string"==typeof e)return e;try{return rm(e)}catch(t){return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rw(e="Unexpected state"){let t=`FIRESTORE (${rp}) INTERNAL ASSERTION FAILED: `+e;throw rS(t),Error(t)}function rE(e,t){e||rw()}function rI(e,t){return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r_={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rR extends d.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rA{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rD{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(rf.UNAUTHENTICATED))}shutdown(){}}class rx{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rN{constructor(e){this.authProvider=e,this.currentUser=rf.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.tokenCounter,r=e=>this.tokenCounter!==n?(n=this.tokenCounter,t(e)):Promise.resolve(),i=new rk;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new rk,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{rb("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.tokenListener),s()};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(rb("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rk)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(rb("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(rE("string"==typeof t.accessToken),new rA(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return rE(null===e||"string"==typeof e),new rf(e)}}class rO{constructor(e,t,n){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=n,this.type="FirstParty",this.user=rf.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class rM{constructor(e,t,n){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=n}getToken(){return Promise.resolve(new rO(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(rf.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rP{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rL{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let n=e=>{null!=e.error&&rb("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,rb("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{rb("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?r(e):rb("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(rE("string"==typeof e.token),this.latestAppCheckToken=e.token,new rP(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}}function rB(e){if(!e)return new rD;switch(e.type){case"firstParty":return new rM(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rR(r_.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rF(e){return(0,f.randomBytes)(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rj{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="",r=20;for(;n.length<r;){let i=rF(40);for(let s=0;s<i.length;++s)n.length<r&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}}function rU(e,t){return e<t?-1:e>t?1:0}function rV(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function rz(e){return e+"\x00"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rq=-62135596800,rG=1e6;class rK{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new rR(r_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<rq||e>=253402300800)throw new rR(r_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return rK.fromMillis(Date.now())}static fromDate(e){return rK.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*rG);return new rK(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/rG}_compareTo(e){return this.seconds===e.seconds?rU(this.nanoseconds,e.nanoseconds):rU(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds-rq).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r${constructor(e){this.timestamp=e}static fromTimestamp(e){return new r$(e)}static min(){return new r$(new rK(0,0))}static max(){return new r$(new rK(253402300799,1e9-1))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rH="__name__";class rW{constructor(e,t,n){void 0===t?t=0:t>e.length&&rw(),void 0===n?n=e.length-t:n>e.length-t&&rw(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===rW.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rW?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.get(r),i=t.get(r);if(n<i)return -1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class rQ extends rW{construct(e,t,n){return new rQ(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new rR(r_.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new rQ(t)}static emptyPath(){return new rQ([])}}let rY=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rJ extends rW{construct(e,t,n){return new rJ(e,t,n)}static isValidIdentifier(e){return rY.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rJ.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===rH}static keyField(){return new rJ([rH])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new rR(r_.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new rR(r_.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if(!("\\"===t||"."===t||"`"===t))throw new rR(r_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new rR(r_.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new rJ(t)}static emptyPath(){return new rJ([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rX{constructor(e){this.path=e}static fromPath(e){return new rX(rQ.fromString(e))}static fromName(e){return new rX(rQ.fromString(e).popFirst(5))}static empty(){return new rX(rQ.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rQ.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rQ.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rX(new rQ(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rZ=-1,r0=0;class r1{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function r2(e){return e.fields.find(e=>2===e.kind)}function r4(e){return e.fields.filter(e=>2!==e.kind)}function r3(e){let t=r4(e);return 0===t.length?0:t[t.length-1].kind}function r6(e,t){let n=rU(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=r7(e.fields[r],t.fields[r])))return n;return rU(e.fields.length,t.fields.length)}function r9(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}r1.UNKNOWN_ID=-1;class r5{constructor(e,t){this.fieldPath=e,this.kind=t}}function r7(e,t){let n=rJ.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:rU(e.kind,t.kind)}class r8{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r8(r0,ir.min())}}function ie(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new ir(r$.fromTimestamp(1e9===r?new rK(n+1,0):new rK(n,r)),rX.empty(),t)}function it(e){return new ir(e.readTime,e.key,rZ)}class ir{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ir(r$.min(),rX.empty(),rZ)}static max(){return new ir(r$.max(),rX.empty(),rZ)}}function ii(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=rX.comparator(e.documentKey,t.documentKey))?n:rU(e.largestBatchId,t.largestBatchId)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let is="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ia{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function io(e){if(e.code===r_.FAILED_PRECONDITION&&e.message===is)rb("LocalStore","Unexpectedly lost primary lease");else throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&rw(),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new il((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof il)return t;return il.resolve(t)}catch(e){return il.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):il.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):il.reject(t)}static resolve(e){return new il((t,n)=>{t(e)})}static reject(e){return new il((t,n)=>{n(e)})}static waitFor(e){return new il((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=il.resolve(!1);for(let n of e)t=t.next(e=>e?il.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new il((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new il((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iu="SimpleDb",ic=3;class ih{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new rk,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new ig(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let n=iS(t.target.error);this.completionDeferred.reject(new ig(e,n))}}static open(e,t,n,r){try{return new ih(t,e.transaction(r,n))}catch(e){throw new ig(t,e)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(rb(iu,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new iy(this.transaction.objectStore(e))}}class id{constructor(e,t,n){this.name=e,this.version=t,this.schemaConverter=n,12.2===id.getIOSVersion(getUA())&&rS("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return rb(iu,"Removing database:",e),iv(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!isIndexedDBAvailable())return!1;if(id.isMockPersistence())return!0;let e=getUA(),t=id.getIOSVersion(e),n=0<t&&t<10,r=id.getAndroidVersion(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!n&&!i}static isMockPersistence(){var e;return"undefined"!=typeof process&&(null===(e=process.env)||void 0===e?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}async ensureDb(e){return this.db||(rb(iu,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new ig(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new rR(r_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new rR(r_.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new ig(e,r))},r.onupgradeneeded=e=>{rb(iu,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,r.transaction,e.oldVersion,this.version).next(()=>{rb(iu,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=ih.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),il.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(n){let e=n,t="FirebaseError"!==e.name&&s<ic;if(rb(iu,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ip{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return iv(this.dbCursor.delete())}}class ig extends null{constructor(e,t){super(r_.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function im(e){return"IndexedDbTransactionError"===e.name}class iy{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(rb(iu,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(rb(iu,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),iv(n)}add(e){return rb(iu,"ADD",this.store.name,e,e),iv(this.store.add(e))}get(e){return iv(this.store.get(e)).next(t=>(void 0===t&&(t=null),rb(iu,"GET",this.store.name,e,t),t))}delete(e){return rb(iu,"DELETE",this.store.name,e),iv(this.store.delete(e))}count(){return rb(iu,"COUNT",this.store.name),iv(this.store.count())}loadAll(e,t){let n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){let e=this.cursor(n),t=[];return this.iterateCursor(e,(e,n)=>{t.push(n)}).next(()=>t)}{let e=this.store.getAll(n.range);return new il((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}loadFirst(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new il((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){rb(iu,"DELETE ALL",this.store.name);let n=this.options(e,t);n.keysOnly=!1;let r=this.cursor(n);return this.iterateCursor(r,(e,t,n)=>n.delete())}iterate(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.iterateCursor(r,t)}iterateSerial(e){let t=this.cursor({});return new il((n,r)=>{t.onerror=e=>{r(iS(e.target.error))},t.onsuccess=t=>{let r=t.target.result;if(!r){n();return}e(r.primaryKey,r.value).next(e=>{e?r.continue():n()})}})}iterateCursor(e,t){let n=[];return new il((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i){r();return}let s=new ip(i),a=t(i.primaryKey,i.value,s);if(a instanceof il){let e=a.catch(e=>(s.done(),il.reject(e)));n.push(e)}s.isDone?r():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>il.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let n=this.store.index(e.index);return e.keysOnly?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}}}function iv(e){return new il((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(iS(e.target.error))}})}let ib=!1;function iS(e){let t=id.getIOSVersion(getUA());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new rR("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ib||(ib=!0,setTimeout(()=>{throw e},0)),e}}return e}let iT="IndexBackiller",iC=null,iw=null,iE=50;class iI{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(iC)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){rb(iT,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();rb(iT,`Documents written: ${e}`)}catch(e){im(e)?rb(iT,"Ignoring IndexedDB error during index backfill: ",e):await io(e)}await this.schedule(iw)})}}class i_{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=iE){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let n=new Set,r=t,i=!0;return il.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||n.has(t)))return rb(iT,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}writeEntriesForCollectionGroup(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(r,n)).next(n=>(rb(iT,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}getNewOffset(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=it(t);ii(r,n)>0&&(n=r)}),new ir(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}iR.INVALID=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ik="\x01",iA="\x01",iD="\x10",ix="\x11";function iN(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=iM(t)),t=iO(e.get(n),t);return iM(t)}function iO(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\x00":n+=ik+iD;break;case ik:n+=ik+ix;break;default:n+=r}}return n}function iM(e){return e+ik+iA}function iP(e){let t=e.length;if(rE(t>=2),2===t)return rE(e.charAt(0)===ik&&e.charAt(1)===iA),rQ.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf(ik,s);switch((t<0||t>n)&&rw(),e.charAt(t+1)){case iA:let a;let o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case iD:i+=e.substring(s,t)+"\x00";break;case ix:i+=e.substring(s,t+1);break;default:rw()}s=t+2}return new rQ(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iL="remoteDocuments",iB="owner",iF="owner",ij="mutationQueues",iU="userId",iV="mutations",iz="batchId",iq="userMutationsIndex",iG=null;function iK(e){return[e]}function i$(e,t){return[e,iN(t)]}function iH(e,t,n){return[e,iN(t),n]}let iW={},iQ="documentMutations",iY="remoteDocumentsV14",iJ=null,iX="documentKeyIndex",iZ=null,i0="collectionGroupIndex",i1=null,i2="remoteDocumentGlobal",i4="remoteDocumentGlobalKey",i3="targets",i6="targetId",i9="queryTargetsIndex",i5=null,i7="targetDocuments",i8=null,se="documentTargetsIndex",st=null,sn="targetGlobalKey",sr="targetGlobal",si="collectionParents",ss=null,sa="clientMetadata",so="clientId",sl="bundles",su="bundleId",sc="namedQueries",sh="name",sd="indexConfiguration",sf="indexId",sp="collectionGroupIndex",sg="collectionGroup",sm="indexState",sy=null,sv="sequenceNumberIndex",sb=null,sS="indexEntries",sT=null,sC="documentKeyIndex",sw=null,sE="documentOverlays",sI=null,s_="collectionPathOverlayIndex",sR=null,sk="collectionGroupOverlayIndex",sA=null,sD=[ij,iV,iQ,iL,i3,iB,sr,i7,sa,i2,si,sl,sc],sx=[...sD,sE],sN=[ij,iV,iQ,iY,i3,iB,sr,i7,sa,i2,si,sl,sc,sE],sO=sN,sM=[...sO,sd,sm,sS];function sP(e){return 15===e?sM:14===e?sO:13===e?sN:12===e?sx:11===e?sD:void rw()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sL extends null{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function sB(e,t){let n=rI(e);return id.getStore(n.simpleDbTransaction,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sF(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function sj(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function sU(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sV{constructor(e,t){this.comparator=e,this.root=t||sq.EMPTY}insert(e,t){return new sV(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sq.BLACK,null,null))}remove(e){return new sV(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sq.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sz(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sz(this.root,e,this.comparator,!1)}getReverseIterator(){return new sz(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sz(this.root,e,this.comparator,!0)}}class sz{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sq{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:sq.RED,this.left=null!=r?r:sq.EMPTY,this.right=null!=i?i:sq.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new sq(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return sq.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n;let r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return sq.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,sq.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,sq.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw rw();let e=this.left.check();if(e===this.right.check())return e+(this.isRed()?0:1);throw rw()}}sq.EMPTY=null,sq.RED=!0,sq.BLACK=!1;class sG{constructor(){this.size=0}get key(){throw rw()}get value(){throw rw()}get color(){throw rw()}get left(){throw rw()}get right(){throw rw()}copy(e,t,n,r,i){return this}insert(e,t,n){return new sq(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}sq.EMPTY=new sG;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sK{constructor(e){this.comparator=e,this.data=new sV(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new s$(this.data.getIterator())}getIteratorFrom(e){return new s$(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof sK)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new sK(this.comparator);return t.data=e,t}}class s${constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sH(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=sW(s),l=sW(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=sW(a)):t?(i(o),o=sW(s)):(o=sW(s),l=sW(a))}}function sW(e){return e.hasNext()?e.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sQ{constructor(e){this.fields=e,e.sort(rJ.comparator)}static empty(){return new sQ([])}unionWith(e){let t=new sK(rJ.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new sQ(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rV(this.fields,e.fields,(e,t)=>e.isEqual(t))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sY(e){return Buffer.from(e,"base64").toString("binary")}function sJ(e){return Buffer.from(e,"binary").toString("base64")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sX{constructor(e){this.binaryString=e}static fromBase64String(e){return new sX(sY(e))}static fromUint8Array(e){return new sX(sZ(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return sJ(this.binaryString)}toUint8Array(){return s0(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rU(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function sZ(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}function s0(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}sX.EMPTY_BYTE_STRING=new sX("");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s1=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function s2(e){if(rE(!!e),"string"==typeof e){let t=0,n=s1.exec(e);if(rE(!!n),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:s4(e.seconds),nanos:s4(e.nanos)}}function s4(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function s3(e){return"string"==typeof e?sX.fromBase64String(e):sX.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s6="server_timestamp",s9="__type__",s5="__previous_value__",s7="__local_write_time__";function s8(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[s9])||void 0===n?void 0:n.stringValue)===s6}function ae(e,t){let n={fields:{[s9]:{stringValue:s6},[s7]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&s8(t)&&(t=at(t)),t&&(n.fields[s5]=t),{mapValue:n}}function at(e){let t=e.mapValue.fields[s5];return s8(t)?at(t):t}function an(e){let t=s2(e.mapValue.fields[s7].timestampValue);return new rK(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}let ai="(default)";class as{constructor(e,t){this.projectId=e,this.database=t||ai}static empty(){return new as("","")}get isDefaultDatabase(){return this.database===ai}isEqual(e){return e instanceof as&&e.projectId===this.projectId&&e.database===this.database}}function aa(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rR(r_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new as(e.options.projectId,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ao=-1;function al(e){return null==e}function au(e){return 0===e&&1/e==-1/0}function ac(e){return"number"==typeof e&&Number.isInteger(e)&&!au(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ah="__max__",ad={mapValue:{fields:{__type__:{stringValue:ah}}}},af={nullValue:"NULL_VALUE"};function ap(e){if("nullValue"in e)return 0;if("booleanValue"in e)return 1;if("integerValue"in e||"doubleValue"in e)return 2;if("timestampValue"in e)return 3;if("stringValue"in e)return 5;if("bytesValue"in e)return 6;if("referenceValue"in e)return 7;else if("geoPointValue"in e)return 8;else if("arrayValue"in e)return 9;else if(!("mapValue"in e))return rw();else return s8(e)?4:aY(e)?9007199254740991:10}function ag(e,t){if(e===t)return!0;let n=ap(e);if(n!==ap(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return an(e).isEqual(an(t));case 3:return am(e,t);case 5:return e.stringValue===t.stringValue;case 6:return av(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return ay(e,t);case 2:return ab(e,t);case 9:return rV(e.arrayValue.values||[],t.arrayValue.values||[],ag);case 10:return aS(e,t);default:return rw()}}function am(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=s2(e.timestampValue),r=s2(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}function ay(e,t){return s4(e.geoPointValue.latitude)===s4(t.geoPointValue.latitude)&&s4(e.geoPointValue.longitude)===s4(t.geoPointValue.longitude)}function av(e,t){return s3(e.bytesValue).isEqual(s3(t.bytesValue))}function ab(e,t){if("integerValue"in e&&"integerValue"in t)return s4(e.integerValue)===s4(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=s4(e.doubleValue),r=s4(t.doubleValue);return n===r?au(n)===au(r):isNaN(n)&&isNaN(r)}return!1}function aS(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(sF(n)!==sF(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!ag(n[e],r[e])))return!1;return!0}function aT(e,t){return void 0!==(e.values||[]).find(e=>ag(e,t))}function aC(e,t){if(e===t)return 0;let n=ap(e),r=ap(t);if(n!==r)return rU(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return rU(e.booleanValue,t.booleanValue);case 2:return aw(e,t);case 3:return aE(e.timestampValue,t.timestampValue);case 4:return aE(an(e),an(t));case 5:return rU(e.stringValue,t.stringValue);case 6:return aR(e.bytesValue,t.bytesValue);case 7:return aI(e.referenceValue,t.referenceValue);case 8:return a_(e.geoPointValue,t.geoPointValue);case 9:return ak(e.arrayValue,t.arrayValue);case 10:return aA(e.mapValue,t.mapValue);default:throw rw()}}function aw(e,t){let n=s4(e.integerValue||e.doubleValue),r=s4(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}function aE(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rU(e,t);let n=s2(e),r=s2(t),i=rU(n.seconds,r.seconds);return 0!==i?i:rU(n.nanos,r.nanos)}function aI(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=rU(n[e],r[e]);if(0!==t)return t}return rU(n.length,r.length)}function a_(e,t){let n=rU(s4(e.latitude),s4(t.latitude));return 0!==n?n:rU(s4(e.longitude),s4(t.longitude))}function aR(e,t){let n=s3(e),r=s3(t);return n.compareTo(r)}function ak(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=aC(n[e],r[e]);if(t)return t}return rU(n.length,r.length)}function aA(e,t){if(e===ad.mapValue&&t===ad.mapValue)return 0;if(e===ad.mapValue)return 1;if(t===ad.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=rU(r[e],s[e]);if(0!==t)return t;let a=aC(n[r[e]],i[s[e]]);if(0!==a)return a}return rU(r.length,s.length)}function aD(e){return ax(e)}function ax(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return aO(e.timestampValue);if("stringValue"in e)return e.stringValue;if("bytesValue"in e)return aN(e.bytesValue);else if("referenceValue"in e)return aP(e.referenceValue);else if("geoPointValue"in e)return aM(e.geoPointValue);else if("arrayValue"in e)return aB(e.arrayValue);else if("mapValue"in e)return aL(e.mapValue);else return rw()}function aN(e){return s3(e).toBase64()}function aO(e){let t=s2(e);return`time(${t.seconds},${t.nanos})`}function aM(e){return`geo(${e.latitude},${e.longitude})`}function aP(e){return rX.fromName(e).toString()}function aL(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${ax(e.fields[i])}`;return n+"}"}function aB(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=ax(r);return t+"]"}function aF(e){switch(ap(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=at(e);return t?16+aF(t):16;case 5:return 2*e.stringValue.length;case 6:return s3(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return aU(e.arrayValue);case 10:return aj(e.mapValue);default:throw rw()}}function aj(e){let t=0;return sj(e.fields,(e,n)=>{t+=e.length+aF(n)}),t}function aU(e){return(e.values||[]).reduce((e,t)=>e+aF(t),0)}function aV(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function az(e){return!!e&&"integerValue"in e}function aq(e){return!!e&&"doubleValue"in e}function aG(e){return az(e)||aq(e)}function aK(e){return!!e&&"arrayValue"in e}function a$(e){return!!e&&"nullValue"in e}function aH(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function aW(e){return!!e&&"mapValue"in e}function aQ(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return sj(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=aQ(n)),t}{if(!e.arrayValue)return Object.assign({},e);let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=aQ(e.arrayValue.values[n]);return t}}function aY(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===ah}function aJ(e){if("nullValue"in e)return af;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};if("bytesValue"in e)return{bytesValue:""};if("referenceValue"in e)return aV(as.empty(),rX.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if("mapValue"in e)return{mapValue:{}};else return rw()}function aX(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};if("bytesValue"in e)return aV(as.empty(),rX.empty());if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return{mapValue:{}};else if("mapValue"in e)return ad;else return rw()}function aZ(e,t){let n=aC(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function a0(e,t){let n=aC(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a1{constructor(e){this.value=e}static empty(){return new a1({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!aW(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=aQ(t)}setAll(e){let t=rJ.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=aQ(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());aW(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ag(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];aW(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(sj(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new a1(aQ(this.value))}}function a2(e){let t=[];return sj(e.fields,(e,n)=>{let r=new rJ([e]);if(aW(n)){let e=a2(n.mapValue).fields;if(0===e.length)t.push(r);else for(let n of e)t.push(r.child(n))}else t.push(r)}),new sQ(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a4{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new a4(e,0,r$.min(),r$.min(),r$.min(),a1.empty(),0)}static newFoundDocument(e,t,n,r){return new a4(e,1,t,r$.min(),n,r,0)}static newNoDocument(e,t){return new a4(e,2,t,r$.min(),r$.min(),a1.empty(),0)}static newUnknownDocument(e,t){return new a4(e,3,t,r$.min(),r$.min(),a1.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(r$.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=a1.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=a1.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=r$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof a4&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new a4(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function a3(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?aC(r,i):rw()}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a6{constructor(e,t){this.position=e,this.inclusive=t}}function a9(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?rX.comparator(rX.fromName(a.referenceValue),n.key):aC(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function a5(e,t,n){let r=a9(e,t,n);return e.inclusive?r>=0:r>0}function a7(e,t,n){let r=a9(e,t,n);return e.inclusive?r<=0:r<0}function a8(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ag(e.position[n],t.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oe{constructor(e,t="asc"){this.field=e,this.dir=t}}function ot(e){return e.field.canonicalString()+e.dir}function on(e){return`${e.field.canonicalString()} (${e.dir})`}function or(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{}class os extends oi{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ob(e,t,n):"array-contains"===t?new ow(e,n):"in"===t?new oE(e,n):"not-in"===t?new oI(e,n):"array-contains-any"===t?new o_(e,n):new os(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new oS(e,n):new oT(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(aC(t,this.value)):null!==t&&ap(this.value)===ap(t)&&this.matchesComparison(aC(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rw()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class oa extends oi{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new oa(e,t)}matches(e){return oo(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function oo(e){return"and"===e.op}function ol(e){return"or"===e.op}function ou(e){return oc(e)&&oo(e)}function oc(e){for(let t of e.filters)if(t instanceof oa)return!1;return!0}function oh(e){if(e instanceof os)return e.field.canonicalString()+e.op.toString()+aD(e.value);if(ou(e))return e.filters.map(e=>oh(e)).join(",");{let t=e.filters.map(e=>oh(e)).join(",");return`${e.op}(${t})`}}function od(e,t){return e instanceof os?of(e,t):e instanceof oa?op(e,t):void rw()}function of(e,t){return t instanceof os&&e.op===t.op&&e.field.isEqual(t.field)&&ag(e.value,t.value)}function op(e,t){return t instanceof oa&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&od(n,t.filters[r]),!0)}function og(e,t){let n=e.filters.concat(t);return oa.create(n,e.op)}function om(e){return e instanceof os?ov(e):e instanceof oa?oy(e):"Filter"}function oy(e){return e.op.toString()+" {"+e.getFilters().map(om).join(" ,")+"}"}function ov(e){return`${e.field.canonicalString()} ${e.op} ${aD(e.value)}`}class ob extends os{constructor(e,t,n){super(e,t,n),this.key=rX.fromName(n.referenceValue)}matches(e){let t=rX.comparator(e.key,this.key);return this.matchesComparison(t)}}class oS extends os{constructor(e,t){super(e,"in",t),this.keys=oC("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class oT extends os{constructor(e,t){super(e,"not-in",t),this.keys=oC("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function oC(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>rX.fromName(e.referenceValue))}class ow extends os{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return aK(t)&&aT(t.arrayValue,this.value)}}class oE extends os{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&aT(this.value.arrayValue,t)}}class oI extends os{constructor(e,t){super(e,"not-in",t)}matches(e){if(aT(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!aT(this.value.arrayValue,t)}}class o_ extends os{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!aK(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>aT(this.value.arrayValue,e))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function ok(e,t=null,n=[],r=[],i=null,s=null,a=null){return new oR(e,t,n,r,i,s,a)}function oA(e){let t=rI(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:"+t.filters.map(e=>oh(e)).join(",")+"|ob:"+t.orderBy.map(e=>ot(e)).join(","),al(t.limit)||(e+="|l:"+t.limit),t.startAt&&(e+="|lb:"+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(e=>aD(e)).join(",")),t.endAt&&(e+="|ub:"+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(e=>aD(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function oD(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>om(e)).join(", ")}]`),al(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>on(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+(e.startAt.inclusive?"b:":"a:")+e.startAt.position.map(e=>aD(e)).join(",")),e.endAt&&(t+=", endAt: "+(e.endAt.inclusive?"a:":"b:")+e.endAt.position.map(e=>aD(e)).join(",")),`Target(${t})`}function ox(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!or(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!od(e.filters[n],t.filters[n]))return!1;return!!(e.collectionGroup===t.collectionGroup&&e.path.isEqual(t.path)&&a8(e.startAt,t.startAt))&&a8(e.endAt,t.endAt)}function oN(e){return rX.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function oO(e,t){return e.filters.filter(e=>e instanceof os&&e.field.isEqual(t))}function oM(e,t){let n=r2(t);if(void 0===n)return null;for(let t of oO(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function oP(e,t){let n=new Map;for(let r of r4(t))for(let t of oO(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}function oL(e,t){let n=[],r=!0;for(let i of r4(t)){let t=0===i.kind?oF(e,i.fieldPath,e.startAt):oj(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new a6(n,r)}function oB(e,t){let n=[],r=!0;for(let i of r4(t)){let t=0===i.kind?oj(e,i.fieldPath,e.endAt):oF(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new a6(n,r)}function oF(e,t,n){let r=af,i=!0;for(let n of oO(e,t)){let e=af,t=!0;switch(n.op){case"<":case"<=":e=aJ(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=af}0>aZ({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>aZ({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function oj(e,t,n){let r=ad,i=!0;for(let n of oO(e,t)){let e=ad,t=!0;switch(n.op){case">=":case">":e=aX(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=ad}a0({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];a0({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function oU(e){let t=new sK(rJ.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}function oV(e){return null!==e.limit}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oz{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function oq(e,t,n,r,i,s,a,o){return new oz(e,t,n,r,i,s,a,o)}function oG(e){return new oz(e)}function oK(e,t){return new oz(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function o$(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function oH(e){let t=new sK(rJ.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function oW(e){return rX.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function oQ(e){return null!==e.collectionGroup}function oY(e){let t=rI(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let n of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(n),e.add(n.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";oH(t).forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.memoizedNormalizedOrderBy.push(new oe(r,n))}),e.has(rJ.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new oe(rJ.keyField(),n))}return t.memoizedNormalizedOrderBy}function oJ(e){let t=rI(e);return t.memoizedTarget||(t.memoizedTarget=oZ(t,oY(e))),t.memoizedTarget}function oX(e){let t=rI(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=oZ(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function oZ(e,t){if("F"===e.limitType)return ok(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new oe(e.field,t)});let n=e.endAt?new a6(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new a6(e.startAt.position,e.startAt.inclusive):null;return ok(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function o0(e,t){let n=e.filters.concat([t]);return new oz(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function o1(e,t){let n=e.explicitOrderBy.concat([t]);return new oz(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function o2(e,t,n){return new oz(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function o4(e,t){return new oz(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function o3(e,t){return new oz(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function o6(e,t){return ox(oJ(e),oJ(t))&&e.limitType===t.limitType}function o9(e){return`${oA(oJ(e))}|lt:${e.limitType}`}function o5(e){return`Query(target=${oD(oJ(e))}; limitType=${e.limitType})`}function o7(e,t){return t.isFoundDocument()&&o8(e,t)&&le(e,t)&&lt(e,t)&&ln(e,t)}function o8(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):rX.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}function le(e,t){for(let n of oY(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}function lt(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}function ln(e,t){return(!e.startAt||!!a7(e.startAt,oY(e),t))&&(!e.endAt||!!a5(e.endAt,oY(e),t))}function lr(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function li(e){return(t,n)=>{let r=!1;for(let i of oY(e)){let e=ls(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function ls(e,t,n){let r=e.field.isKeyField()?rX.comparator(t.key,n.key):a3(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return rw()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r){this.inner[n]=[[e,t]],this.innerSize++;return}for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e)){r[n]=[e,t];return}r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){sj(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return sU(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lo=new sV(rX.comparator);function ll(){return lo}let lu=new sV(rX.comparator);function lc(...e){let t=lu;for(let n of e)t=t.insert(n.key,n);return t}function lh(){return lg()}function ld(e){let t=lu;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function lf(){return lg()}function lp(){return lg()}function lg(){return new la(e=>e.toString(),(e,t)=>e.isEqual(t))}let lm=new sV(rX.comparator);function ly(){return lm}let lv=new sK(rX.comparator);function lb(...e){let t=lv;for(let n of e)t=t.add(n);return t}let lS=new sK(rU);function lT(){return lS}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lC(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:au(t)?"-0":t}}function lw(e){return{integerValue:""+e}}function lE(e,t){return ac(t)?lw(t):lC(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lI{constructor(){this._=void 0}}function l_(e,t,n){return e instanceof lD?ae(n,t):e instanceof lx?lN(e,t):e instanceof lO?lM(e,t):lL(e,t)}function lR(e,t,n){return e instanceof lx?lN(e,t):e instanceof lO?lM(e,t):n}function lk(e,t){return e instanceof lP?aG(t)?t:{integerValue:0}:null}function lA(e,t){return e instanceof lx&&t instanceof lx||e instanceof lO&&t instanceof lO?rV(e.elements,t.elements,ag):e instanceof lP&&t instanceof lP?ag(e.operand,t.operand):e instanceof lD&&t instanceof lD}class lD extends lI{}class lx extends lI{constructor(e){super(),this.elements=e}}function lN(e,t){let n=lF(t);for(let t of e.elements)n.some(e=>ag(e,t))||n.push(t);return{arrayValue:{values:n}}}class lO extends lI{constructor(e){super(),this.elements=e}}function lM(e,t){let n=lF(t);for(let t of e.elements)n=n.filter(e=>!ag(e,t));return{arrayValue:{values:n}}}class lP extends lI{constructor(e,t){super(),this.serializer=e,this.operand=t}}function lL(e,t){let n=lk(e,t),r=lB(n)+lB(e.operand);return az(n)&&az(e.operand)?lw(r):lC(e.serializer,r)}function lB(e){return s4(e.integerValue||e.doubleValue)}function lF(e){return aK(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lj{constructor(e,t){this.field=e,this.transform=t}}function lU(e,t){return e.field.isEqual(t.field)&&lA(e.transform,t.transform)}function lV(e,t){return void 0===e&&void 0===t||!!e&&!!t&&rV(e,t,(e,t)=>lU(e,t))}class lz{constructor(e,t){this.version=e,this.transformResults=t}}class lq{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new lq}static exists(e){return new lq(void 0,e)}static updateTime(e){return new lq(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function lG(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class lK{}function l$(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new l9(e.key,lq.none()):new lJ(e.key,e.data,lq.none());{let n=e.data,r=a1.empty(),i=new sK(rJ.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new l0(e.key,r,new sQ(i.toArray()),lq.none())}}function lH(e,t,n){e instanceof lJ?lX(e,t,n):e instanceof l0?l1(e,t,n):l5(e,t,n)}function lW(e,t,n,r){return e instanceof lJ?lZ(e,t,n,r):e instanceof l0?l2(e,t,n,r):l7(e,t,n)}function lQ(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=lk(r.transform,e||null);null!=i&&(null===n&&(n=a1.empty()),n.set(r.field,i))}return n||null}function lY(e,t){return!!(e.type===t.type&&e.key.isEqual(t.key)&&e.precondition.isEqual(t.precondition)&&lV(e.fieldTransforms,t.fieldTransforms))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class lJ extends lK{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}function lX(e,t,n){let r=e.value.clone(),i=l3(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}function lZ(e,t,n,r){if(!lG(e.precondition,t))return n;let i=e.value.clone(),s=l6(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class l0 extends lK{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function l1(e,t,n){if(!lG(e.precondition,t)){t.convertToUnknownDocument(n.version);return}let r=l3(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(l4(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}function l2(e,t,n,r){if(!lG(e.precondition,t))return n;let i=l6(e.fieldTransforms,r,t),s=t.data;return(s.setAll(l4(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function l4(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function l3(e,t,n){let r=new Map;rE(e.length===n.length);for(let i=0;i<n.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);r.set(s.field,lR(a,o,n[i]))}return r}function l6(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,l_(e,s,t))}return r}class l9 extends lK{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function l5(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}function l7(e,t,n){return lG(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}class l8 extends lK{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&lH(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=lW(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=lW(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=lp();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=l$(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(r$.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),lb())}isEqual(e){return this.batchId===e.batchId&&rV(this.mutations,e.mutations,(e,t)=>lY(e,t))&&rV(this.baseMutations,e.baseMutations,(e,t)=>lY(e,t))}}class ut{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){rE(e.mutations.length===n.length);let r=ly(),i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ut(e,t,n,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e,t){this.count=e,this.unchangedNames=t}}function ui(e){switch(e){case r_.OK:return rw();case r_.CANCELLED:case r_.UNKNOWN:case r_.DEADLINE_EXCEEDED:case r_.RESOURCE_EXHAUSTED:case r_.INTERNAL:case r_.UNAVAILABLE:case r_.UNAUTHENTICATED:return!1;case r_.INVALID_ARGUMENT:case r_.NOT_FOUND:case r_.ALREADY_EXISTS:case r_.PERMISSION_DENIED:case r_.FAILED_PRECONDITION:case r_.ABORTED:case r_.OUT_OF_RANGE:case r_.UNIMPLEMENTED:case r_.DATA_LOSS:return!0;default:return rw()}}function us(e){return ui(e)&&e!==r_.ABORTED}function ua(e){if(void 0===e)return rS("GRPC error has no .code"),r_.UNKNOWN;switch(e){case a.OK:return r_.OK;case a.CANCELLED:return r_.CANCELLED;case a.UNKNOWN:return r_.UNKNOWN;case a.DEADLINE_EXCEEDED:return r_.DEADLINE_EXCEEDED;case a.RESOURCE_EXHAUSTED:return r_.RESOURCE_EXHAUSTED;case a.INTERNAL:return r_.INTERNAL;case a.UNAVAILABLE:return r_.UNAVAILABLE;case a.UNAUTHENTICATED:return r_.UNAUTHENTICATED;case a.INVALID_ARGUMENT:return r_.INVALID_ARGUMENT;case a.NOT_FOUND:return r_.NOT_FOUND;case a.ALREADY_EXISTS:return r_.ALREADY_EXISTS;case a.PERMISSION_DENIED:return r_.PERMISSION_DENIED;case a.FAILED_PRECONDITION:return r_.FAILED_PRECONDITION;case a.ABORTED:return r_.ABORTED;case a.OUT_OF_RANGE:return r_.OUT_OF_RANGE;case a.UNIMPLEMENTED:return r_.UNIMPLEMENTED;case a.DATA_LOSS:return r_.DATA_LOSS;default:return rw()}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(a||(a={}));/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ul=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uu(){return new h.TextEncoder}function uc(){return new TextDecoder("utf-8")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uh=new rl([4294967295,4294967295],0);function ud(e){let t=uu().encode(e),n=new ro;return n.update(t),new Uint8Array(n.digest())}function uf(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new rl([n,r],0),new rl([i,s],0)]}class up{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ug(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new ug(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ug(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=rl.fromNumber(this.bitCount)}getBitIndex(e,t,n){let r=e.add(t.multiply(rl.fromNumber(n)));return 1===r.compare(uh)&&(r=new rl([r.getBits(0),r.getBits(1)],0)),r.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,n]=uf(ud(e));for(let e=0;e<this.hashCount;e++){let r=this.getBitIndex(t,n,e);if(!this.isBitSet(r))return!1}return!0}static create(e,t,n){let r=e%8==0?0:8-e%8,i=new up(new Uint8Array(Math.ceil(e/8)),r,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,n]=uf(ud(e));for(let e=0;e<this.hashCount;e++){let r=this.getBitIndex(t,n,e);this.setBit(r)}}setBit(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ug extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,uy.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new um(r$.min(),r,new sV(rU),ll(),lb())}}class uy{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new uy(n,t,lb(),lb(),lb())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(e,t,n,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=n,this.newDoc=r}}class ub{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class uS{constructor(e,t,n=sX.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class uT{constructor(){this.pendingResponses=0,this.documentChanges=uI(),this._resumeToken=sX.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=lb(),t=lb(),n=lb();return this.documentChanges.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:rw()}}),new uy(this._resumeToken,this._current,e,t,n)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=uI()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let uC="WatchChangeAggregator";class uw{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=ll(),this.pendingDocumentTargetMapping=uE(),this.pendingTargetResets=new sV(rU)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let n=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&n.updateResumeToken(e.resumeToken);break;case 1:n.recordTargetResponse(),n.isPending||n.clearPendingChanges(),n.updateResumeToken(e.resumeToken);break;case 2:n.recordTargetResponse(),n.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(n.markCurrent(),n.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),n.updateResumeToken(e.resumeToken));break;default:rw()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,n)=>{this.isActiveTarget(n)&&t(n)})}handleExistenceFilter(e){let t=e.targetId,n=e.existenceFilter.count,r=this.targetDataForActiveTarget(t);if(r){let i=r.target;if(oN(i)){if(0===n){let e=new rX(i.path);this.removeDocumentFromTarget(t,e,a4.newNoDocument(e,r$.min()))}else rE(1===n)}else{let r=this.getCurrentDocumentCountForTarget(t);if(r!==n){let n=this.parseBloomFilter(e),i=n?this.applyBloomFilter(n,e,r):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}null==ul||ul.notifyOnExistenceFilterMismatch(u_(r,e.existenceFilter,this.metadataProvider.getDatabaseId(),n,i))}}}}parseBloomFilter(e){let t,n;let r=e.existenceFilter.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=s3(i).toUint8Array()}catch(e){if(e instanceof uo)return rT("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new up(t,s,a)}catch(e){return e instanceof ug?rT("BloomFilter error: ",e):rT("Applying bloom filter failed: ",e),null}return 0===n.bitCount?null:n}applyBloomFilter(e,t,n){return t.existenceFilter.count===n-this.filterRemovedDocuments(e,t.targetId)?0:2}filterRemovedDocuments(e,t){let n=this.metadataProvider.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,n,null),r++)}),r}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((n,r)=>{let i=this.targetDataForActiveTarget(r);if(i){if(n.current&&oN(i.target)){let t=new rX(i.target.path);null!==this.pendingDocumentUpdates.get(t)||this.targetContainsDocument(r,t)||this.removeDocumentFromTarget(r,t,a4.newNoDocument(t,e))}n.hasPendingChanges&&(t.set(r,n.toTargetChange()),n.clearPendingChanges())}});let n=lb();this.pendingDocumentTargetMapping.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.pendingDocumentUpdates.forEach((t,n)=>n.setReadTime(e));let r=new um(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,n);return this.pendingDocumentUpdates=ll(),this.pendingDocumentTargetMapping=uE(),this.pendingTargetResets=new sV(rU),r}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let n=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,n){if(!this.isActiveTarget(e))return;let r=this.ensureTargetState(e);this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,n))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new uT,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new sK(rU),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||rb(uC,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new uT),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function uE(){return new sV(rX.comparator)}function uI(){return new sV(rX.comparator)}function u_(e,t,n,r,i){var s,a,o,l,u,c;let h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(l=null===(o=null===(a=null==d?void 0:d.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==l?l:0,padding:null!==(c=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==c?c:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uR=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),uk=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),uA=(()=>{let e={};return e.and="AND",e.or="OR",e})();class uD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ux(e){return new rR(void 0===e.code?r_.UNKNOWN:ua(e.code),e.message||"")}function uN(e,t){return e.useProto3Json||al(t)?t:{value:t}}function uO(e){let t;return al(t="object"==typeof e?e.value:e)?null:t}function uM(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),n=("000000000"+t.nanoseconds).slice(-9);return`${e}.${n}Z`}}function uP(e){let t=s2(e);return new rK(t.seconds,t.nanos)}function uL(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function uB(e,t){return e.useProto3Json?(rE(void 0===t||"string"==typeof t),sX.fromBase64String(t||"")):(rE(void 0===t||t instanceof Uint8Array),sX.fromUint8Array(t||new Uint8Array))}function uF(e,t){return uM(e,t.toTimestamp())}function uj(e){return rE(!!e),r$.fromTimestamp(uP(e))}function uU(e,t){return uH(e).child("documents").child(t).canonicalString()}function uV(e){let t=rQ.fromString(e);return rE(cF(t)),t}function uz(e,t){return uU(e.databaseId,t.path)}function uq(e,t){let n=uV(t);if(n.get(1)!==e.databaseId.projectId)throw new rR(r_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new rR(r_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new rX(uW(n))}function uG(e,t){return uU(e.databaseId,t)}function uK(e){let t=uV(e);return 4===t.length?rQ.emptyPath():uW(t)}function u$(e){return new rQ(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function uH(e){return new rQ(["projects",e.projectId,"databases",e.database])}function uW(e){return rE(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function uQ(e,t,n){return{name:uz(e,t),fields:n.value.mapValue.fields}}function uY(e,t){return{name:uz(e,t.key),fields:t.data.value.mapValue.fields,updateTime:uM(e,t.version.toTimestamp()),createTime:uM(e,t.createTime.toTimestamp())}}function uJ(e,t,n){let r=uq(e,t.name),i=uj(t.updateTime),s=t.createTime?uj(t.createTime):r$.min(),a=new a1({mapValue:{fields:t.fields}}),o=a4.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function uX(e,t){rE(!!t.found),t.found.name,t.found.updateTime;let n=uq(e,t.found.name),r=uj(t.found.updateTime),i=t.found.createTime?uj(t.found.createTime):r$.min(),s=new a1({mapValue:{fields:t.found.fields}});return a4.newFoundDocument(n,r,i,s)}function uZ(e,t){rE(!!t.missing),rE(!!t.readTime);let n=uq(e,t.missing),r=uj(t.readTime);return a4.newNoDocument(n,r)}function u0(e,t){return"found"in t?uX(e,t):"missing"in t?uZ(e,t):rw()}function u1(e,t){let n;if("targetChange"in t){t.targetChange;let r=u2(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=uB(e,t.targetChange.resumeToken),a=t.targetChange.cause;n=new uS(r,i,s,a&&ux(a)||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=uq(e,r.document.name),s=uj(r.document.updateTime),a=r.document.createTime?uj(r.document.createTime):r$.min(),o=new a1({mapValue:{fields:r.document.fields}}),l=a4.newFoundDocument(i,s,a,o);n=new uv(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=uq(e,r.document),s=r.readTime?uj(r.readTime):r$.min(),a=a4.newNoDocument(i,s);n=new uv([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=uq(e,r.document);n=new uv([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return rw();t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new ur(r,i);n=new ub(e.targetId,s)}return n}function u2(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:rw()}function u4(e){if(!("targetChange"in e))return r$.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?r$.min():uj(t.readTime)}function u3(e,t){let n;if(t instanceof lJ)n={update:uQ(e,t.key,t.value)};else if(t instanceof l9)n={delete:uz(e,t.key)};else if(t instanceof l0)n={update:uQ(e,t.key,t.data),updateMask:cL(t.fieldMask)};else{if(!(t instanceof l8))return rw();n={verify:uz(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(t=>ce(e,t))),t.precondition.isNone||(n.currentDocument=u9(e,t.precondition)),n}function u6(e,t){let n=t.currentDocument?u5(t.currentDocument):lq.none(),r=t.updateTransforms?t.updateTransforms.map(t=>ct(e,t)):[];if(t.update){t.update.name;let i=uq(e,t.update.name),s=new a1({mapValue:{fields:t.update.fields}});return t.updateMask?new l0(i,s,cB(t.updateMask),n,r):new lJ(i,s,n,r)}return t.delete?new l9(uq(e,t.delete),n):t.verify?new l8(uq(e,t.verify),n):rw()}function u9(e,t){return void 0!==t.updateTime?{updateTime:uF(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:rw()}function u5(e){return void 0!==e.updateTime?lq.updateTime(uj(e.updateTime)):void 0!==e.exists?lq.exists(e.exists):lq.none()}function u7(e,t){let n=e.updateTime?uj(e.updateTime):uj(t);return n.isEqual(r$.min())&&(n=uj(t)),new lz(n,e.transformResults||[])}function u8(e,t){return e&&e.length>0?(rE(void 0!==t),e.map(e=>u7(e,t))):[]}function ce(e,t){let n=t.transform;if(n instanceof lD)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof lx)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof lO)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof lP)return{fieldPath:t.field.canonicalString(),increment:n.operand};throw rw()}function ct(e,t){let n=null;return"setToServerValue"in t?(rE("REQUEST_TIME"===t.setToServerValue),n=new lD):"appendMissingElements"in t?n=new lx(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new lO(t.removeAllFromArray.values||[]):"increment"in t?n=new lP(e,t.increment):rw(),new lj(rJ.fromServerFormat(t.fieldPath),n)}function cn(e,t){return{documents:[uG(e,t.path)]}}function cr(e){return rE(1===e.documents.length),oJ(oG(uK(e.documents[0])))}function ci(e,t){let n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=uG(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=uG(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);let i=ch(t.filters);i&&(n.structuredQuery.where=i);let s=cp(t.orderBy);s&&(n.structuredQuery.orderBy=s);let a=uN(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=cm(t.startAt)),t.endAt&&(n.structuredQuery.endAt=cy(t.endAt)),n}function cs(e,t,n){let r=ci(e,t),i={},s=[],a=0;return n.forEach(e=>{let t=`aggregate_${a++}`;i[t]=e.alias,"count"===e.aggregateType?s.push({alias:t,count:{}}):"avg"===e.aggregateType?s.push({alias:t,avg:{field:c_(e.fieldPath)}}):"sum"===e.aggregateType&&s.push({alias:t,sum:{field:c_(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:s,structuredQuery:r.structuredQuery},parent:r.parent},aliasMap:i}}function ca(e){let t=uK(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){rE(1===r);let e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=cd(n.where));let a=[];n.orderBy&&(a=cg(n.orderBy));let o=null;n.limit&&(o=uO(n.limit));let l=null;n.startAt&&(l=cv(n.startAt));let u=null;return n.endAt&&(u=cb(n.endAt)),oq(t,i,a,s,o,"F",l,u)}function co(e){return oJ(ca(e))}function cl(e,t){let n=cu(t.purpose);return null==n?null:{"goog-listen-tags":n}}function cu(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rw()}}function cc(e,t){let n;let r=t.target;if((n=oN(r)?{documents:cn(e,r)}:{query:ci(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=uL(e,t.resumeToken);let r=uN(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(r$.min())>0){n.readTime=uM(e,t.snapshotVersion.toTimestamp());let r=uN(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}function ch(e){if(0!==e.length)return cD(oa.create(e,"and"))}function cd(e){let t=cf(e);return t instanceof oa&&ou(t)?t.getFilters():[t]}function cf(e){return void 0!==e.unaryFilter?cO(e):void 0!==e.fieldFilter?cM(e):void 0!==e.compositeFilter?cP(e):rw()}function cp(e){if(0!==e.length)return e.map(e=>ck(e))}function cg(e){return e.map(e=>cA(e))}function cm(e){return{before:e.inclusive,values:e.position}}function cy(e){return{before:!e.inclusive,values:e.position}}function cv(e){let t=!!e.before;return new a6(e.values||[],t)}function cb(e){let t=!e.before;return new a6(e.values||[],t)}function cS(e){return uR[e]}function cT(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function cC(e){return uk[e]}function cw(e){return uA[e]}function cE(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return rw()}}function cI(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rw()}}function c_(e){return{fieldPath:e.canonicalString()}}function cR(e){return rJ.fromServerFormat(e.fieldPath)}function ck(e){return{field:c_(e.field),direction:cS(e.dir)}}function cA(e){return new oe(cR(e.field),cT(e.direction))}function cD(e){return e instanceof os?cN(e):e instanceof oa?cx(e):rw()}function cx(e){let t=e.getFilters().map(e=>cD(e));return 1===t.length?t[0]:{compositeFilter:{op:cw(e.op),filters:t}}}function cN(e){if("=="===e.op){if(aH(e.value))return{unaryFilter:{field:c_(e.field),op:"IS_NAN"}};if(a$(e.value))return{unaryFilter:{field:c_(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(aH(e.value))return{unaryFilter:{field:c_(e.field),op:"IS_NOT_NAN"}};if(a$(e.value))return{unaryFilter:{field:c_(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:c_(e.field),op:cC(e.op),value:e.value}}}function cO(e){switch(e.unaryFilter.op){case"IS_NAN":let t=cR(e.unaryFilter.field);return os.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=cR(e.unaryFilter.field);return os.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=cR(e.unaryFilter.field);return os.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=cR(e.unaryFilter.field);return os.create(i,"!=",{nullValue:"NULL_VALUE"});default:return rw()}}function cM(e){return os.create(cR(e.fieldFilter.field),cE(e.fieldFilter.op),e.fieldFilter.value)}function cP(e){return oa.create(e.compositeFilter.filters.map(e=>cf(e)),cI(e.compositeFilter.op))}function cL(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function cB(e){return new sQ((e.fieldPaths||[]).map(e=>rJ.fromServerFormat(e)))}function cF(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{constructor(e,t,n,r,i=r$.min(),s=r$.min(),a=sX.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new cj(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cj(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cj(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cj(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cU{constructor(e){this.remoteSerializer=e}}function cV(e,t){let n;if(t.document)n=uJ(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rX.fromSegments(t.noDocument.path),r=c$(t.noDocument.readTime);n=a4.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return rw();let e=rX.fromSegments(t.unknownDocument.path),r=c$(t.unknownDocument.version);n=a4.newUnknownDocument(e,r)}return t.readTime&&n.setReadTime(cG(t.readTime)),n}function cz(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:cq(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=uY(e.remoteSerializer,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:cK(t.version)};else{if(!t.isUnknownDocument())return rw();r.unknownDocument={path:n.path.toArray(),version:cK(t.version)}}return r}function cq(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function cG(e){let t=new rK(e[0],e[1]);return r$.fromTimestamp(t)}function cK(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function c$(e){let t=new rK(e.seconds,e.nanoseconds);return r$.fromTimestamp(t)}function cH(e,t,n){let r=n.baseMutations.map(t=>u3(e.remoteSerializer,t)),i=n.mutations.map(t=>u3(e.remoteSerializer,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function cW(e,t){let n=(t.baseMutations||[]).map(t=>u6(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let r=t.mutations.map(t=>u6(e.remoteSerializer,t)),i=rK.fromMillis(t.localWriteTimeMs);return new ue(t.batchId,i,n,r)}function cQ(e){let t;let n=c$(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?c$(e.lastLimboFreeSnapshotVersion):r$.min();return new cj(t=cJ(e.query)?cr(e.query):co(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,sX.fromBase64String(e.resumeToken))}function cY(e,t){let n;let r=cK(t.snapshotVersion),i=cK(t.lastLimboFreeSnapshotVersion);n=oN(t.target)?cn(e.remoteSerializer,t.target):ci(e.remoteSerializer,t.target);let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:oA(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function cJ(e){return void 0!==e.documents}function cX(e){return{id:e.bundleId,createTime:c$(e.createTime),version:e.version}}function cZ(e){return{bundleId:e.id,createTime:cK(uj(e.createTime)),version:e.version}}function c0(e){return{name:e.name,query:c2(e.bundledQuery),readTime:c$(e.readTime)}}function c1(e){return{name:e.name,readTime:cK(uj(e.readTime)),bundledQuery:e.bundledQuery}}function c2(e){let t=ca({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?o2(t,t.limit,"L"):t}function c4(e){return{name:e.name,query:c2(e.bundledQuery),readTime:uj(e.readTime)}}function c3(e){return{id:e.id,version:e.version,createTime:uj(e.createTime)}}function c6(e,t){return new un(t.largestBatchId,u6(e.remoteSerializer,t.overlayMutation))}function c9(e,t,n){let[r,i,s]=c5(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:u3(e.remoteSerializer,n.mutation)}}function c5(e,t){let n=t.path.lastSegment();return[e,iN(t.path.popLast()),n]}function c7(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function c8(e,t){let n=t?new r8(t.sequenceNumber,new ir(c$(t.readTime),new rX(iP(t.documentKey)),t.largestBatchId)):r8.empty(),r=e.fields.map(([e,t])=>new r5(rJ.fromServerFormat(e),t));return new r1(e.indexId,e.collectionGroup,r,n)}function he(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:cK(r.readTime),documentKey:iN(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{getBundleMetadata(e,t){return hn(e).get(t).next(e=>{if(e)return cX(e)})}saveBundleMetadata(e,t){return hn(e).put(cZ(t))}getNamedQuery(e,t){return hr(e).get(t).next(e=>{if(e)return c0(e)})}saveNamedQuery(e,t){return hr(e).put(c1(t))}}function hn(e){return sB(e,sl)}function hr(e){return sB(e,sc)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new hi(e,t.uid||"")}getOverlay(e,t){return hs(e).get(c5(this.userId,t)).next(e=>e?c6(this.serializer,e):null)}getOverlays(e,t){let n=lf();return il.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new un(t,i);r.push(this.saveOverlay(e,s))}),il.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(iN(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(hs(e).deleteAll(s_,r))}),il.waitFor(i)}getOverlaysForCollection(e,t,n){let r=lf(),i=iN(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return hs(e).loadAll(s_,s).next(e=>{for(let t of e){let e=c6(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i;let s=lf(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return hs(e).iterate({index:sk,range:a},(e,t,n)=>{let a=c6(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}saveOverlay(e,t){return hs(e).put(c9(this.serializer,this.userId,t))}}function hs(e){return sB(e,sE)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ha=5,ho=10,hl=13,hu=15,hc=20,hh=25,hd=30,hf=37,hp=45,hg=50,hm=55,hy=60,hv=2;class hb{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,ha);else if("booleanValue"in e)this.writeValueTypeLabel(t,ho),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,hu),t.writeNumber(s4(e.integerValue));else if("doubleValue"in e){let n=s4(e.doubleValue);isNaN(n)?this.writeValueTypeLabel(t,hl):(this.writeValueTypeLabel(t,hu),au(n)?t.writeNumber(0):t.writeNumber(n))}else if("timestampValue"in e){let n=e.timestampValue;this.writeValueTypeLabel(t,hc),"string"==typeof n?t.writeString(n):(t.writeString(`${n.seconds||""}`),t.writeNumber(n.nanos||0))}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,hd),t.writeBytes(s3(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.writeValueTypeLabel(t,hp),t.writeNumber(n.latitude||0),t.writeNumber(n.longitude||0)}else"mapValue"in e?aY(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):rw()}writeIndexString(e,t){this.writeValueTypeLabel(t,hh),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let n=e.fields||{};for(let e of(this.writeValueTypeLabel(t,hm),Object.keys(n)))this.writeIndexString(e,t),this.writeIndexValueAux(n[e],t)}writeIndexArray(e,t){let n=e.values||[];for(let e of(this.writeValueTypeLabel(t,hg),n))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,hf),rX.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,hy),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(hv)}}hb.INSTANCE=new hb;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hS="\uD800",hT="\uDBFF",hC=0,hw=255,hE=1,hI=255,h_=255,hR=0,hk=64,hA=8,hD=1024;function hx(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function hN(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function hO(e){let t=0;for(let n=0;n<8;++n){let r=hN(255&e[n]);if(t+=r,8!==r)break}return t}function hM(e){return Math.ceil((hk-hO(e))/hA)}class hP{constructor(){this.buffer=new Uint8Array(hD),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.writeByteAscending(n.value),n=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.writeByteDescending(n.value),n=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<hS||hT<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<hS||hT<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),n=hM(t);this.ensureAvailable(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),n=hM(t);this.ensureAvailable(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(hI),this.writeEscapedByteAscending(h_)}writeInfinityDescending(){this.writeEscapedByteDescending(hI),this.writeEscapedByteDescending(h_)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=hx(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}writeByteAscending(e){let t=255&e;t===hC?(this.writeEscapedByteAscending(hC),this.writeEscapedByteAscending(hw)):t===hI?(this.writeEscapedByteAscending(hI),this.writeEscapedByteAscending(hR)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===hC?(this.writeEscapedByteDescending(hC),this.writeEscapedByteDescending(hw)):t===hI?(this.writeEscapedByteDescending(hI),this.writeEscapedByteDescending(hR)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(hC),this.writeEscapedByteAscending(hE)}writeSeparatorDescending(){this.writeEscapedByteDescending(hC),this.writeEscapedByteDescending(hE)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class hL{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class hB{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class hF{constructor(){this.orderedCode=new hP,this.ascending=new hL(this.orderedCode),this.descending=new hB(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hj{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}successor(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new hj(this.indexId,this.documentKey,this.arrayValue,n)}}function hU(e,t){let n=e.indexId-t.indexId;return 0!==n||0!==(n=hV(e.arrayValue,t.arrayValue))||0!==(n=hV(e.directionalValue,t.directionalValue))?n:rX.comparator(e.documentKey,t.documentKey)}function hV(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hz{constructor(e){for(let t of(this.inequalityFilters=new sK((e,t)=>rJ.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){let e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(rE(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=r2(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let n=r4(e),r=new Set,i=0,s=0;for(;i<n.length;++i)if(this.hasMatchingEqualityFilter(n[i]))r=r.add(n[i].fieldPath.canonicalString());else break;if(i===n.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new sK(rJ.comparator),t=[];for(let n of this.equalityFilters)if(!n.field.isKeyField()){if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new r5(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new r5(n.field,0))}}for(let n of this.orderBys)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new r5(n.field,"asc"===n.dir?0:1)));return new r1(r1.UNKNOWN_ID,this.collectionId,t,r8.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hq(e){var t,n;if(rE(e instanceof os||e instanceof oa),e instanceof os){if(!(e instanceof oE))return e;{let r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map(t=>os.create(e.field,"==",t)))||[];return oa.create(r,"or")}}let r=e.filters.map(e=>hq(e));return oa.create(r,e.op)}function hG(e){if(0===e.getFilters().length)return[];let t=hQ(hq(e));return(rE(hH(t)),hK(t)||h$(t))?[t]:t.getFilters()}function hK(e){return e instanceof os}function h$(e){return e instanceof oa&&ou(e)}function hH(e){return hK(e)||h$(e)||hW(e)}function hW(e){if(e instanceof oa&&ol(e)){for(let t of e.getFilters())if(!hK(t)&&!h$(t))return!1;return!0}return!1}function hQ(e){if(rE(e instanceof os||e instanceof oa),e instanceof os)return e;if(1===e.filters.length)return hQ(e.filters[0]);let t=e.filters.map(e=>hQ(e)),n=oa.create(t,e.op);return hH(n=h0(n))?n:(rE(n instanceof oa),rE(oo(n)),rE(n.filters.length>1),n.filters.reduce((e,t)=>hY(e,t)))}function hY(e,t){let n;return rE(e instanceof os||e instanceof oa),rE(t instanceof os||t instanceof oa),h0(n=e instanceof os?t instanceof os?hJ(e,t):hZ(e,t):t instanceof os?hZ(t,e):hX(e,t))}function hJ(e,t){return oa.create([e,t],"and")}function hX(e,t){if(rE(e.filters.length>0&&t.filters.length>0),oo(e)&&oo(t))return og(e,t.getFilters());let n=ol(e)?e:t,r=ol(e)?t:e,i=n.filters.map(e=>hY(e,r));return oa.create(i,"or")}function hZ(e,t){if(oo(t))return og(t,e.getFilters());{let n=t.filters.map(t=>hY(e,t));return oa.create(n,"or")}}function h0(e){if(rE(e instanceof os||e instanceof oa),e instanceof os)return e;let t=e.getFilters();if(1===t.length)return h0(t[0]);if(oc(e))return e;let n=t.map(e=>h0(e)),r=[];return(n.forEach(t=>{t instanceof os?r.push(t):t instanceof oa&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length)?r[0]:oa.create(r,e.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(){this.collectionParentIndex=new h2}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),il.resolve()}getCollectionParents(e,t){return il.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return il.resolve()}deleteFieldIndex(e,t){return il.resolve()}deleteAllFieldIndexes(e){return il.resolve()}createTargetIndexes(e,t){return il.resolve()}getDocumentsMatchingTarget(e,t){return il.resolve(null)}getIndexType(e,t){return il.resolve(0)}getFieldIndexes(e,t){return il.resolve([])}getNextCollectionGroupToUpdate(e){return il.resolve(null)}getMinOffset(e,t){return il.resolve(ir.min())}getMinOffsetFromCollectionGroup(e,t){return il.resolve(ir.min())}updateCollectionGroup(e,t,n){return il.resolve()}updateIndexEntries(e,t){return il.resolve()}}class h2{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new sK(rQ.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new sK(rQ.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let h4="IndexedDbIndexManager",h3=new Uint8Array(0);class h6{constructor(e,t){this.user=e,this.databaseId=t,this.collectionParentsCache=new h2,this.targetToDnfSubTargets=new la(e=>oA(e),(e,t)=>ox(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:n,parent:iN(r)};return h9(e).put(i)}return il.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[rz(t),""],!1,!0);return h9(e).loadAll(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(iP(r.parent))}return n})}addFieldIndex(e,t){let n=h7(e),r=c7(t);delete r.indexId;let i=n.add(r);if(!t.indexState)return i.next();{let n=h8(e);return i.next(e=>{n.put(he(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let n=h7(e),r=h8(e),i=h5(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=h7(e),n=h5(e),r=h8(e);return t.deleteAll().next(()=>n.deleteAll()).next(()=>r.deleteAll())}createTargetIndexes(e,t){return il.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new hz(t).buildTargetIndex();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=h5(e),r=!0,i=new Map;return il.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(!r)return il.resolve(null);{let e=lb(),r=[];return il.forEach(i,(i,s)=>{rb(h4,`Using index ${r9(i)} to execute ${oA(t)}`);let a=oM(s,i),o=oP(s,i),l=oL(s,i),u=oB(s,i),c=this.encodeBound(i,s,l),h=this.encodeBound(i,s,u),d=this.encodeValues(i,s,o),f=this.generateIndexRanges(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return il.forEach(f,i=>n.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let n=rX.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:hG(oa.create(e.filters,"and")).map(t=>ok(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.encodeSingleElement(t[c/l]):h3,h=this.generateLowerBound(e,o,n[c%l],r),d=this.generateUpperBound(e,o,i[c%l],s),f=a.map(t=>this.generateLowerBound(e,o,t,!0));u.push(...this.createRange(h,d,f))}return u}generateLowerBound(e,t,n,r){let i=new hj(e,rX.empty(),t,n);return r?i:i.successor()}generateUpperBound(e,t,n,r){let i=new hj(e,rX.empty(),t,n);return r?i.successor():i}getFieldIndex(e,t){let n=new hz(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.servedByIndex(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.getSubTargets(t);return il.forEach(r,t=>this.getFieldIndex(e,t).next(e=>{e?0!==n&&e.fields.length<oU(t)&&(n=1):n=0})).next(()=>oV(t)&&r.length>1&&2===n?1:n)}encodeDirectionalElements(e,t){let n=new hF;for(let r of r4(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.forKind(r.kind);hb.INSTANCE.writeIndexValue(e,i)}return n.encodedBytes()}encodeSingleElement(e){let t=new hF;return hb.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let n=new hF;return hb.INSTANCE.writeIndexValue(aV(this.databaseId,t),n.forKind(r3(e))),n.encodedBytes()}encodeValues(e,t,n){if(null===n)return[];let r=[];r.push(new hF);let i=0;for(let s of r4(e)){let e=n[i++];for(let n of r)if(this.isInFilter(t,s.fieldPath)&&aK(e))r=this.expandIndexValues(r,s,e);else{let t=n.forKind(s.kind);hb.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(r)}encodeBound(e,t,n){return this.encodeValues(e,t,n.position)}getEncodedBytes(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].encodedBytes();return t}expandIndexValues(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new hF;r.seed(n.encodedBytes()),hb.INSTANCE.writeIndexValue(e,r.forKind(t.kind)),i.push(r)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof os&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=h7(e),r=h8(e);return(t?n.loadAll(sp,IDBKeyRange.bound(t,t)):n.loadAll()).next(e=>{let t=[];return il.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(c8(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:rU(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=h7(e),i=h8(e);return this.getNextSequenceNumber(e).next(e=>r.loadAll(sp,IDBKeyRange.bound(t,t)).next(t=>il.forEach(t,t=>i.put(he(t.indexId,this.user,e,n)))))}updateIndexEntries(e,t){let n=new Map;return il.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?il.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),il.forEach(i,n=>this.getExistingIndexEntries(e,t,n).next(t=>{let i=this.computeIndexEntries(r,n);return t.isEqual(i)?il.resolve():this.updateEntries(e,r,n,t,i)}))))})}addIndexEntry(e,t,n,r){return h5(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(n,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,n,r){return h5(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.encodeDirectionalKey(n,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,n){let r=h5(e),i=new sK(hU);return r.iterate({index:sC,range:IDBKeyRange.only([n.indexId,this.uid,this.encodeDirectionalKey(n,t)])},(e,r)=>{i=i.add(new hj(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}computeIndexEntries(e,t){let n=new sK(hU),r=this.encodeDirectionalElements(t,e);if(null==r)return n;let i=r2(t);if(null!=i){let s=e.data.field(i.fieldPath);if(aK(s))for(let i of s.arrayValue.values||[])n=n.add(new hj(t.indexId,e.key,this.encodeSingleElement(i),r))}else n=n.add(new hj(t.indexId,e.key,h3,r));return n}updateEntries(e,t,n,r,i){rb(h4,"Updating index entries for document '%s'",t.key);let s=[];return sH(r,i,hU,r=>{s.push(this.addIndexEntry(e,t,n,r))},r=>{s.push(this.deleteIndexEntry(e,t,n,r))}),il.waitFor(s)}getNextSequenceNumber(e){let t=1;return h8(e).iterate({index:sv,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>hU(e,t)).filter((e,t,n)=>!t||0!==hU(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=hU(i,e),s=hU(i,t);if(0===n)r[0]=e.successor();else if(n>0&&s<0)r.push(i),r.push(i.successor());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.isRangeMatchable(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,h3,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,h3,[]];i.push(IDBKeyRange.bound(t,n))}return i}isRangeMatchable(e,t){return hU(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(de)}getMinOffset(e,t){return il.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||rw())).next(de)}}function h9(e){return sB(e,si)}function h5(e){return sB(e,sS)}function h7(e){return sB(e,sd)}function h8(e){return sB(e,sm)}function de(e){rE(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>ii(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ir(t.readTime,t.documentKey,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dt(e,t,n){let r=e.store(iV),i=e.store(iQ),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.iterate({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{rE(1===o)}));let u=[];for(let e of n.mutations){let r=iH(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return il.waitFor(s).next(()=>u)}function dn(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw rw();return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}static forUser(e,t,n,r){return rE(""!==e.uid),new dr(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return da(e).iterate({index:iq,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=dl(e),s=da(e);return s.add({}).next(a=>{rE("number"==typeof a);let o=new ue(a,t,n,r),l=cH(this.serializer,this.userId,o),u=[],c=new sK((e,t)=>rU(e.canonicalString(),t.canonicalString()));for(let e of r){let t=iH(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,iW))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),il.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return da(e).get(t).next(e=>e?(rE(e.userId===this.userId),cW(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?il.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let n=e.keys();return this.documentKeysByBatchId[t]=n,n}})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return da(e).iterate({index:iq,range:r},(e,t,r)=>{t.userId===this.userId&&(rE(t.batchId>=n),i=cW(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=ao;return da(e).iterate({index:iq,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,ao],[this.userId,Number.POSITIVE_INFINITY]);return da(e).loadAll(iq,t).next(e=>e.map(e=>cW(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=i$(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return dl(e).iterate({range:r},(n,r,s)=>{let[a,o,l]=n,u=iP(o);if(a!==this.userId||!t.path.isEqual(u)){s.done();return}return da(e).get(l).next(e=>{if(!e)throw rw();rE(e.userId===this.userId),i.push(cW(this.serializer,e))})}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new sK(rU),r=[];return t.forEach(t=>{let i=i$(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=dl(e).iterate({range:s},(e,r,i)=>{let[s,a,o]=e,l=iP(a);if(s!==this.userId||!t.path.isEqual(l)){i.done();return}n=n.add(o)});r.push(a)}),il.waitFor(r).next(()=>this.lookupMutationBatches(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=i$(this.userId,n),s=IDBKeyRange.lowerBound(i),a=new sK(rU);return dl(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,u=iP(o);if(s!==this.userId||!n.isPrefixOf(u)){i.done();return}u.length===r&&(a=a.add(l))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let n=[],r=[];return t.forEach(t=>{r.push(da(e).get(t).next(e=>{if(null===e)throw rw();rE(e.userId===this.userId),n.push(cW(this.serializer,e))}))}),il.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return dt(e.simpleDbTransaction,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),il.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return il.resolve();let n=IDBKeyRange.lowerBound(iK(this.userId)),r=[];return dl(e).iterate({range:n},(e,t,n)=>{if(e[0]!==this.userId){n.done();return}{let t=iP(e[1]);r.push(t)}}).next(()=>{rE(0===r.length)})})}containsKey(e,t){return di(e,this.userId,t)}getMutationQueueMetadata(e){return du(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:ao,lastStreamToken:""})}}function di(e,t,n){let r=i$(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return dl(e).iterate({range:s,keysOnly:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function ds(e,t){let n=!1;return du(e).iterateSerial(r=>di(e,r,t).next(e=>(e&&(n=!0),il.resolve(!e)))).next(()=>n)}function da(e){return sB(e,iV)}function dl(e){return sB(e,iQ)}function du(e){return sB(e,ij)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dc=2;class dh{constructor(e){this.lastId=e}next(){return this.lastId+=dc,this.lastId}static forTargetCache(){return new dh(2-dc)}static forSyncEngine(){return new dh(1-dc)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let n=new dh(t.highestTargetId);return t.highestTargetId=n.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>r$.fromTimestamp(new rK(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.retrieveMetadata(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.saveMetadata(e,r)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(n=>(n.targetCount+=1,this.updateMetadataFromTargetData(t,n),this.saveMetadata(e,n))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>df(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(rE(t.targetCount>0),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,n){let r=0,i=[];return df(e).iterate((s,a)=>{let o=cQ(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>il.waitFor(i)).next(()=>r)}forEachTarget(e,t){return df(e).iterate((e,n)=>{t(cQ(n))})}retrieveMetadata(e){return dp(e).get(sn).next(e=>(rE(null!==e),e))}saveMetadata(e,t){return dp(e).put(sn,t)}saveTargetData(e,t){return df(e).put(cY(this.serializer,t))}updateMetadataFromTargetData(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let n=oA(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return df(e).iterate({range:r,index:i9},(e,n,r)=>{let s=cQ(n);ox(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=dg(e);return t.forEach(t=>{let s=iN(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),il.waitFor(r)}removeMatchingKeys(e,t,n){let r=dg(e);return il.forEach(t,t=>{let i=iN(t.path);return il.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=dg(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=dg(e),i=lb();return r.iterate({range:n,keysOnly:!0},(e,t,n)=>{let r=new rX(iP(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=iN(t.path),r=IDBKeyRange.bound([n],[rz(n)],!1,!0),i=0;return dg(e).iterate({index:se,keysOnly:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return df(e).get(t).next(e=>e?cQ(e):null)}}function df(e){return sB(e,i3)}function dp(e){return sB(e,sr)}function dg(e){return sB(e,i7)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},dy=-1,dv=41943040;class db{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new db(e,db.DEFAULT_COLLECTION_PERCENTILE,db.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}db.DEFAULT_COLLECTION_PERCENTILE=10,db.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,db.DEFAULT=new db(dv,db.DEFAULT_COLLECTION_PERCENTILE,db.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),db.DISABLED=new db(dy,0,0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dS="LruGarbageCollector",dT=1048576,dC=null,dw=null;function dE([e,t],[n,r]){let i=rU(e,n);return 0===i?rU(t,r):i}class dI{constructor(e){this.maxElements=e,this.buffer=new sK(dE),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>dE(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class d_{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==dy&&this.scheduleGC(dC)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){rb(dS,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){im(e)?rb(dS,"Ignoring IndexedDB error during garbage collection: ",e):await io(e)}await this.scheduleGC(dw)})}}class dR{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return il.resolve(iR.INVALID);let n=new dI(t);return this.delegate.forEachTarget(e,e=>n.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>n.addElement(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.delegate.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===dy?(rb("LruGarbageCollector","Garbage collection skipped; disabled"),il.resolve(dm)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(rb("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dm):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let n,r,i,s,a,o,l;let u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(rb("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),rv()<=LogLevel.DEBUG&&rb("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-u}ms`),il.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}function dk(e,t){return new dR(e,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(e,t){this.db=e,this.garbageCollector=dk(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,n)=>t(n))}addReference(e,t,n){return dN(e,n)}removeReference(e,t,n){return dN(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return dN(e,t)}isPinned(e,t){return ds(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,r$.min()),dg(e).delete(dD(s))))});r.push(t)}}).next(()=>il.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return dN(e,t)}forEachOrphanedDocument(e,t){let n;let r=dg(e),i=iR.INVALID;return r.iterate({index:se},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==iR.INVALID&&t(new rX(iP(n)),i),i=a,n=s):i=iR.INVALID}).next(()=>{i!==iR.INVALID&&t(new rX(iP(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function dD(e){return[0,iN(e.path)]}function dx(e,t){return{targetId:0,path:iN(e.path),sequenceNumber:t}}function dN(e,t){return dg(e).put(dx(t,e.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dO{constructor(){this.changes=new la(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,a4.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?il.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dM{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return dF(e).put(n)}removeEntry(e,t,n){return dF(e).delete(dU(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.setMetadata(e,n)))}getEntry(e,t){let n=a4.newInvalidDocument(t);return dF(e).iterate({index:iX,range:IDBKeyRange.only(dj(t))},(e,r)=>{n=this.maybeDecodeDocument(t,r)}).next(()=>n)}getSizedEntry(e,t){let n={size:0,document:a4.newInvalidDocument(t)};return dF(e).iterate({index:iX,range:IDBKeyRange.only(dj(t))},(e,r)=>{n={document:this.maybeDecodeDocument(t,r),size:dn(r)}}).next(()=>n)}getEntries(e,t){let n=ll();return this.forEachDbEntry(e,t,(e,t)=>{let r=this.maybeDecodeDocument(e,t);n=n.insert(e,r)}).next(()=>n)}getSizedEntries(e,t){let n=ll(),r=new sV(rX.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);n=n.insert(e,i),r=r.insert(e,dn(t))}).next(()=>({documents:n,sizeMap:r}))}forEachDbEntry(e,t,n){if(t.isEmpty())return il.resolve();let r=new sK(dz);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(dj(r.first()),dj(r.last())),s=r.getIterator(),a=s.getNext();return dF(e).iterate({index:iX,range:i},(e,t,r)=>{let i=rX.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>dz(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.skip(dj(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),cq(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return dF(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=ll();for(let i of e){let e=this.maybeDecodeDocument(rX.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(o7(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=ll(),s=dV(t,n),a=dV(t,ir.max());return dF(e).iterate({index:i0,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.maybeDecodeDocument(rX.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new dL(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return dB(e).get(i4).next(e=>(rE(!!e),e))}setMetadata(e,t){return dB(e).put(i4,t)}maybeDecodeDocument(e,t){if(t){let e=cV(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(r$.min())))return e}return a4.newInvalidDocument(e)}}function dP(e){return new dM(e)}class dL extends null{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new la(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new sK((e,t)=>rU(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=cz(this.documentCache.serializer,s);r=r.add(i.path.popLast());let l=dn(o);n+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=cz(this.documentCache.serializer,s.convertToNoDocument(r$.min()));t.push(this.documentCache.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.documentCache.updateMetadata(e,n)),il.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,n)=>{this.documentStates.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function dB(e){return sB(e,i2)}function dF(e){return sB(e,iY)}function dj(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function dU(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],cq(t),n[n.length-1]]}function dV(e,t){let n=t.documentKey.path.toArray();return[e,cq(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function dz(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=rU(n[e],r[e]))return i;return(i=rU(n.length,r.length))||(i=rU(n[n.length-2],r[r.length-2]))?i:rU(n[n.length-1],r[r.length-1])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dq=15;/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dG{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dK{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&lW(n.mutation,e,sQ.empty(),rK.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,lb()).next(()=>t))}getLocalViewOfDocuments(e,t,n=lb()){let r=lf();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=lc();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=lf();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,lb()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=ll(),s=lg(),a=lh();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof l0)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),lW(a.mutation,t,a.mutation.getFieldMask(),rK.now())):s.set(t.key,sQ.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new dG(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=lg(),r=new sV((e,t)=>e-t),i=lb();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||sQ.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||lb()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=lp();l.forEach(e=>{if(!i.has(e)){let r=l$(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return il.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return oW(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):oQ(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):il.resolve(lf()),a=rZ,o=i;return s.next(t=>il.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t))?il.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,lb())).next(e=>({batchId:a,changes:ld(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rX(t)).next(e=>{let t=lc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=lc();return this.indexManager.getCollectionParents(e,i).next(a=>il.forEach(a,a=>{let o=oK(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,a4.newInvalidDocument(r)))});let n=lc();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&lW(s.mutation,r,sQ.empty(),rK.now()),o7(t,r)&&(n=n.insert(e,r))}),n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d${constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return il.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,c3(t)),il.resolve()}getNamedQuery(e,t){return il.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,c4(t)),il.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dH{constructor(){this.overlays=new sV(rX.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return il.resolve(this.overlays.get(t))}getOverlays(e,t){let n=lf();return il.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.saveOverlay(e,t,r)}),il.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.overlayByBatchId.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(n)),il.resolve()}getOverlaysForCollection(e,t,n){let r=lf(),i=t.length+1,s=new rX(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return il.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new sV((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=lf(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=lf(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return il.resolve(a)}saveOverlay(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.overlayByBatchId.get(r.largestBatchId).delete(n.key);this.overlayByBatchId.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new un(t,n));let i=this.overlayByBatchId.get(t);void 0===i&&(i=lb(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dW{constructor(){this.refsByKey=new sK(dQ.compareByKey),this.refsByTarget=new sK(dQ.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let n=new dQ(e,t);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new dQ(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new rX(new rQ([])),n=new dQ(t,e),r=new dQ(t,e+1),i=[];return this.refsByTarget.forEachInRange([n,r],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new rX(new rQ([])),n=new dQ(t,e),r=new dQ(t,e+1),i=lb();return this.refsByTarget.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new dQ(e,0),n=this.refsByKey.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class dQ{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return rX.comparator(e.key,t.key)||rU(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return rU(e.targetOrBatchId,t.targetOrBatchId)||rX.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dY{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new sK(dQ.compareByKey)}checkEmpty(e){return il.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ue(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new dQ(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return il.resolve(s)}lookupMutationBatch(e,t){return il.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=this.indexOfBatchId(n),i=r<0?0:r;return il.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return il.resolve(0===this.mutationQueue.length?ao:this.nextBatchId-1)}getAllMutationBatches(e){return il.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new dQ(t,0),r=new dQ(t,Number.POSITIVE_INFINITY),i=[];return this.batchesByDocumentKey.forEachInRange([n,r],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),il.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new sK(rU);return t.forEach(e=>{let t=new dQ(e,0),r=new dQ(e,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([t,r],e=>{n=n.add(e.targetOrBatchId)})}),il.resolve(this.findMutationBatches(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;rX.isDocumentKey(i)||(i=i.child(""));let s=new dQ(new rX(i),0),a=new sK(rU);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.targetOrBatchId)),!0)},s),il.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let n=this.findMutationBatch(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){rE(0===this.indexOfExistingBatchId(t.batchId,"removed")),this.mutationQueue.shift();let n=this.batchesByDocumentKey;return il.forEach(t.mutations,r=>{let i=new dQ(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.batchesByDocumentKey=n})}removeCachedMutationKeys(e){}containsKey(e,t){let n=new dQ(t,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return il.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,il.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dJ(){return new sV(rX.comparator)}class dX{constructor(e){this.sizer=e,this.docs=dJ(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.sizer(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return il.resolve(n?n.document.mutableCopy():a4.newInvalidDocument(t))}getEntries(e,t){let n=ll();return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():a4.newInvalidDocument(e))}),il.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=ll(),s=t.path,a=new rX(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=ii(it(a),n))&&(r.has(a.key)||o7(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return il.resolve(i)}getAllFromCollectionGroup(e,t,n,r){rw()}forEachDocumentKey(e,t){return il.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new d0(this)}getSize(e){return il.resolve(this.size)}}function dZ(e){return new dX(e)}class d0 extends dO{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.documentCache.addEntry(e,r)):this.documentCache.removeEntry(n)}),il.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d1{constructor(e){this.persistence=e,this.targets=new la(e=>oA(e),ox),this.lastRemoteSnapshotVersion=r$.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new dW,this.targetCount=0,this.targetIdGenerator=dh.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,n)=>t(n)),il.resolve()}getLastRemoteSnapshotVersion(e){return il.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return il.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),il.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),il.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new dh(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,il.resolve()}updateTargetData(e,t){return this.saveTargetData(t),il.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,il.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),il.waitFor(i).next(()=>r)}getTargetCount(e){return il.resolve(this.targetCount)}getTargetData(e,t){let n=this.targets.get(t)||null;return il.resolve(n)}addMatchingKeys(e,t,n){return this.references.addReferences(t,n),il.resolve()}removeMatchingKeys(e,t,n){this.references.removeReferences(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),il.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),il.resolve()}getMatchingKeysForTargetId(e,t){let n=this.references.referencesForId(t);return il.resolve(n)}containsKey(e,t){return il.resolve(this.references.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let d2="MemoryPersistence";class d4{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new iR(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new d1(this);let n=e=>this.referenceDelegate.documentSize(e);this.indexManager=new h1,this.remoteDocumentCache=dZ(n),this.serializer=new cU(t),this.bundleCache=new d$(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dH,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.mutationQueues[e.toKey()];return n||(n=new dY(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=n),n}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,n){rb(d2,"Starting transaction:",e);let r=new d3(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(r).next(e=>this.referenceDelegate.onTransactionCommitted(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return il.or(Object.values(this.mutationQueues).map(n=>()=>n.containsKey(e,t)))}}class d3 extends ia{constructor(e){super(),this.currentSequenceNumber=e}}class d6{constructor(e){this.persistence=e,this.localViewReferences=new dW,this._orphanedDocuments=null}static factory(e){return new d6(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw rw()}addReference(e,t,n){return this.localViewReferences.addReference(n,t),this.orphanedDocuments.delete(n.toString()),il.resolve()}removeReference(e,t,n){return this.localViewReferences.removeReference(n,t),this.orphanedDocuments.add(n.toString()),il.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),il.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return il.forEach(this.orphanedDocuments,n=>{let r=rX.fromPath(n);return this.isReferenced(e,r).next(e=>{e||t.removeEntry(r,r$.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return il.or([()=>il.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class d9{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new la(e=>iN(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=dk(this,t)}static factory(e,t){return new d9(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return il.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return il.forEach(this.orphanedSequenceNumbers,(n,r)=>this.isPinned(e,n,r).next(e=>e?il.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.forEachDocumentKey(e,r=>this.isPinned(e,r,t).next(e=>{e||(n++,i.removeEntry(r,r$.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),il.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.orphanedSequenceNumbers.set(n,e.currentSequenceNumber),il.resolve()}removeReference(e,t,n){return this.orphanedSequenceNumbers.set(n,e.currentSequenceNumber),il.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),il.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=aF(e.data.value)),t}isPinned(e,t,n){return il.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return il.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d5{constructor(e){this.serializer=e}createOrUpgrade(e,t,n,r){let i=new ih("createOrUpgrade",t);n<1&&r>=1&&(d8(e),fe(e),fs(e),fn(e));let s=il.resolve();return n<3&&r>=3&&(0!==n&&(fa(e),fs(e)),s=s.next(()=>fl(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>ft(e,i))),s=s.next(()=>{fu(e)})),n<5&&r>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),n<6&&r>=6&&(s=s.next(()=>(fi(e),this.addDocumentGlobal(i)))),n<7&&r>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),n<8&&r>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),n<9&&r>=9&&(s=s.next(()=>{fo(e)})),n<10&&r>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),n<11&&r>=11&&(s=s.next(()=>{fc(e),fh(e)})),n<12&&r>=12&&(s=s.next(()=>{ff(e)})),n<13&&r>=13&&(s=s.next(()=>fr(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(iL))),n<14&&r>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),n<15&&r>=15&&(s=s.next(()=>fd(e))),s}addDocumentGlobal(e){let t=0;return e.store(iL).iterate((e,n)=>{t+=dn(n)}).next(()=>{let n={byteSize:t};return e.store(i2).put(i4,n)})}removeAcknowledgedMutations(e){let t=e.store(ij),n=e.store(iV);return t.loadAll().next(t=>il.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,ao],[t.userId,t.lastAcknowledgedBatchId]);return n.loadAll(iq,r).next(n=>il.forEach(n,n=>{rE(n.userId===t.userId);let r=cW(this.serializer,n);return dt(e,t.userId,r).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(i7),n=e.store(iL);return e.store(sr).get(sn).next(e=>{let r=n=>t.put({targetId:0,path:iN(n),sequenceNumber:e.highestListenSequenceNumber}),i=[];return n.iterate((e,n)=>{let s=new rQ(e),a=d7(s);i.push(t.get(a).next(e=>e?il.resolve():r(s)))}).next(()=>il.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(si,{keyPath:ss});let n=t.store(si),r=new h2,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:iN(r)})}};return t.store(iL).iterate({keysOnly:!0},(e,t)=>i(new rQ(e).popLast())).next(()=>t.store(iQ).iterate({keysOnly:!0},([e,t,n],r)=>i(iP(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(i3);return t.iterate((e,n)=>{let r=cQ(n),i=cY(this.serializer,r);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let n=t.store(iL),r=[];return n.iterate((e,n)=>{let i=t.store(iY),s=fp(n).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>il.waitFor(r))}runOverlayMigration(e,t){let n=t.store(iV),r=dP(this.serializer),i=new d4(d6.factory,this.serializer.remoteSerializer);return n.loadAll().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:lb();cW(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),il.forEach(n,(e,n)=>{let s=new rf(n),a=hi.forUser(this.serializer,s),o=i.getIndexManager(s);return new dK(r,dr.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new sL(t,iR.INVALID),e).next()})})}}function d7(e){return[0,iN(e)]}function d8(e){e.createObjectStore(iB)}function fe(e){e.createObjectStore(ij,{keyPath:iU}),e.createObjectStore(iV,{keyPath:iz,autoIncrement:!0}).createIndex(iq,iG,{unique:!0}),e.createObjectStore(iQ)}function ft(e,t){return t.store(iV).loadAll().next(n=>{e.deleteObjectStore(iV),e.createObjectStore(iV,{keyPath:iz,autoIncrement:!0}).createIndex(iq,iG,{unique:!0});let r=t.store(iV),i=n.map(e=>r.put(e));return il.waitFor(i)})}function fn(e){e.createObjectStore(iL)}function fr(e){let t=e.createObjectStore(iY,{keyPath:iJ});t.createIndex(iX,iZ),t.createIndex(i0,i1)}function fi(e){e.createObjectStore(i2)}function fs(e){e.createObjectStore(i7,{keyPath:i8}).createIndex(se,st,{unique:!0}),e.createObjectStore(i3,{keyPath:i6}).createIndex(i9,i5,{unique:!0}),e.createObjectStore(sr)}function fa(e){e.deleteObjectStore(i7),e.deleteObjectStore(i3),e.deleteObjectStore(sr)}function fo(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function fl(e){let t=e.store(sr),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:r$.min().toTimestamp(),targetCount:0};return t.put(sn,n)}function fu(e){e.createObjectStore(sa,{keyPath:so})}function fc(e){e.createObjectStore(sl,{keyPath:su})}function fh(e){e.createObjectStore(sc,{keyPath:sh})}function fd(e){e.createObjectStore(sd,{keyPath:sf,autoIncrement:!0}).createIndex(sp,sg,{unique:!1}),e.createObjectStore(sm,{keyPath:sy}).createIndex(sv,sb,{unique:!1}),e.createObjectStore(sS,{keyPath:sT}).createIndex(sC,sw,{unique:!1})}function ff(e){let t=e.createObjectStore(sE,{keyPath:sI});t.createIndex(s_,sR,{unique:!1}),t.createIndex(sk,sA,{unique:!1})}function fp(e){return e.document?new rX(rQ.fromString(e.document.name).popFirst(5)):e.noDocument?rX.fromSegments(e.noDocument.path):e.unknownDocument?rX.fromSegments(e.unknownDocument.path):rw()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fg="IndexedDbPersistence",fm=null,fy=5e3,fv=4e3,fb=null,fS=null,fT="firestore_zombie",fC="main";class fw{constructor(e,t,n,r,i,s,a,o,l,u,c=dq){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=e=>Promise.resolve(),!fw.isAvailable())throw new rR(r_.UNIMPLEMENTED,fS);this.referenceDelegate=new dA(this,r),this.dbName=t+fC,this.serializer=new cU(o),this.simpleDb=new id(this.dbName,this.schemaVersion,new d5(this.serializer)),this.targetCache=new dd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=dP(this.serializer),this.bundleCache=new ht,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&rS(fg,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new rR(r_.FAILED_PRECONDITION,fb);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new iR(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>fI(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(im(e))return rb(fg,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return rb(fg,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return fE(e).get(iF).next(e=>il.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return fI(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,fm)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=sB(e,sa);return t.loadAll().next(e=>{let n=this.filterActiveClients(e,fm),r=e.filter(e=>-1===n.indexOf(e));return il.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",fv,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?il.resolve(!0):fE(e).get(iF).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,fy)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new rR(r_.FAILED_PRECONDITION,fb);return!1}}return!!this.networkEnabled&&!!this.inForeground||fI(e).loadAll().next(e=>void 0===this.filterActiveClients(e,fy).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&rb(fg,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[iB,sa],e=>{let t=new sL(e,iR.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>fI(e).loadAll().next(e=>this.filterActiveClients(e,fm).map(e=>e.clientId)))}get started(){return this._started}getMutationQueue(e,t){return dr.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new h6(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return hi.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,n){let r;rb(fg,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=sP(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(r=new sL(i,this.listenSequence?this.listenSequence.next():iR.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(r).next(e=>!!e||this.canActAsPrimary(r)).next(t=>{if(!t)throw rS(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new rR(r_.FAILED_PRECONDITION,is);return n(r)}).next(e=>this.acquireOrExtendPrimaryLease(r).next(()=>e)):this.verifyAllowTabSynchronization(r).next(()=>n(r))).then(e=>(r.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return fE(e).get(iF).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,fy)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new rR(r_.FAILED_PRECONDITION,fb)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return fE(e).put(iF,t)}static isAvailable(){return id.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=fE(e);return t.get(iF).next(e=>this.isLocalClient(e)?(rb(fg,"Releasing primary lease."),t.delete(iF)):il.resolve())}isWithinAge(e,t){let n=Date.now(),r=n-t,i=n;return!(e<r)&&(!(e>i)||(rS(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;isSafari()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let n=(null===(t=this.webStorage)||void 0===t?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return rb(fg,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return rS(fg,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){rS("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${fT}_${this.persistenceKey}_${e}`}}function fE(e){return sB(e,iB)}function fI(e){return sB(e,sa)}function f_(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fR(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fk="LocalStore",fA=3e8;class fD{constructor(e,t,n,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new sV(rU),this.targetIdByTarget=new la(e=>oA(e),ox),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(n)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dK(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function fx(e,t,n,r){return new fD(e,t,n,r)}async function fN(e,t){let n=rI(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.initializeUserComponents(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=lb();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return n.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function fO(e,t){let n,r;let i=rI(e),s=rK.now(),a=t.reduce((e,t)=>e.add(t.key),lb());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=ll(),l=lb();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(r=>{n=r;let a=[];for(let e of t){let t=lQ(e,n.get(e.key).overlayedDocument);null!=t&&a.push(new l0(e.key,t,a2(t.value.mapValue),lq.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{r=t;let s=t.applyToLocalDocumentSet(n,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:r.batchId,changes:ld(n)}))}function fM(e,t){let n=rI(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});return fQ(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,fP(t))).next(()=>n.localDocuments.getDocuments(e,r))})}function fP(e){let t=lb();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}function fL(e,t){let n=rI(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(rE(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}function fB(e){let t=rI(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function fF(e){let t=rI(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function fj(e,t){let n=rI(e),r=t.snapshotVersion,i=n.targetDataByTarget;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=n.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(n.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(sX.EMPTY_BYTE_STRING,r$.min()).withLastLimboFreeSnapshotVersion(r$.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(o,u),fV(l,u,s)&&a.push(n.targetCache.updateTargetData(e,u))});let o=ll(),l=lb();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(fU(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!r.isEqual(r$.min())){let t=n.targetCache.getLastRemoteSnapshotVersion(e).next(t=>n.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return il.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.targetDataByTarget=i,e))}function fU(e,t,n){let r=lb(),i=lb();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=ll();return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(r$.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):rb(fk,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:r,existenceChangedKeys:i}})}function fV(e,t,n){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=fA)||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}async function fz(e,t){let n=rI(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>il.forEach(t,t=>il.forEach(t.addedKeys,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>il.forEach(t.removedKeys,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(im(e))rb(fk,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=n.targetDataByTarget.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.targetDataByTarget=n.targetDataByTarget.insert(t,i)}}}function fq(e,t){let n=rI(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=ao),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function fG(e,t){let n=rI(e);return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}function fK(e,t){let n=rI(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.targetCache.getTargetData(e,t).next(i=>i?(r=i,il.resolve(r)):n.targetCache.allocateTargetId(e).next(i=>(r=new cj(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.targetCache.addTargetData(e,r).next(()=>r))))}).then(e=>{let r=n.targetDataByTarget.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.targetDataByTarget=n.targetDataByTarget.insert(e.targetId,e),n.targetIdByTarget.set(t,e.targetId)),e})}function f$(e,t,n){let r=rI(e),i=r.targetIdByTarget.get(n);return void 0!==i?il.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(t,n)}async function fH(e,t,n){let r=rI(e),i=r.targetDataByTarget.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(im(e))rb(fk,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}r.targetDataByTarget=r.targetDataByTarget.remove(t),r.targetIdByTarget.delete(i.target)}function fW(e,t,n){let r=rI(e),i=r$.min(),s=lb();return r.persistence.runTransaction("Execute query","readwrite",e=>f$(r,e,oJ(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(e,t,n?i:r$.min(),n?s:lb())).next(e=>(f1(r,lr(t),e),{documents:e,remoteKeys:s})))}function fQ(e,t,n,r){let i=n.batch,s=i.keys(),a=il.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);rE(null!==s),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function fY(e,t){let n=rI(e),r=rI(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.lookupMutationKeys(e,t).next(t=>t?n.localDocuments.getDocuments(e,t):il.resolve(null)))}function fJ(e,t){rI(rI(e,fD).mutationQueue).removeCachedMutationKeys(t)}function fX(e){return rI(rI(e,fD).persistence).getActiveClients()}function fZ(e,t){let n=rI(e),r=rI(n.targetCache),i=n.targetDataByTarget.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function f0(e,t){let n=rI(e),r=n.collectionGroupReadTime.get(t)||r$.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.remoteDocuments.getAllFromCollectionGroup(e,t,ie(r,rZ),Number.MAX_SAFE_INTEGER)).then(e=>(f1(n,t,e),e))}function f1(e,t,n){let r=e.collectionGroupReadTime.get(t)||r$.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.collectionGroupReadTime.set(t,r)}function f2(e){return oJ(oG(rQ.fromString(`__bundle__/docs/${e}`)))}async function f4(e,t,n,r){let i=rI(e),s=lb(),a=ll();for(let e of n){let n=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(n));let r=t.toMutableDocument(e);r.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(n,r)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await fK(i,f2(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>fU(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function f3(e,t){let n=rI(e),r=uj(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}function f6(e,t){let n=rI(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.bundleCache.saveBundleMetadata(e,t))}async function f9(e,t,n=lb()){let r=await fK(e,oJ(c2(t.bundledQuery))),i=rI(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=uj(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=r.withResumeToken(sX.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.targetCache.addMatchingKeys(e,n,r.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}function f5(e,t){rI(e).queryEngine.indexAutoCreationEnabled=t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f7{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let f8=100,pe=8;class pt{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=f8,this.relativeIndexReadCostPerDocument=pe}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new f7;return this.executeFullCollectionScan(e,t,n).next(r=>{if(i.result=r,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,n,r.size)})}).next(()=>i.result)}createCacheIndexes(e,t,n,r){return n.documentReadCount<this.indexAutoCreationMinCollectionSize?(rv()<=c.in.DEBUG&&rb("QueryEngine","SDK will not create cache indexes for query:",o5(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),il.resolve()):(rv()<=c.in.DEBUG&&rb("QueryEngine","Query:",o5(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.relativeIndexReadCostPerDocument*r)?(rv()<=c.in.DEBUG&&rb("QueryEngine","The SDK decides to create cache indexes for query:",o5(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,oJ(t))):il.resolve()}performQueryUsingIndex(e,t){if(o$(t))return il.resolve(null);let n=oJ(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=oJ(t=o2(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=lb(...r);return this.localDocumentsView.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.applyQuery(t,r);return this.needsRefill(t,s,i,n.readTime)?this.performQueryUsingIndex(e,o2(t,null,"F")):this.appendRemainingResults(e,s,t,n)}))})))}performQueryUsingRemoteKeys(e,t,n,r){return o$(t)||r.isEqual(r$.min())?il.resolve(null):this.localDocumentsView.getDocuments(e,n).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,n,r)?il.resolve(null):(rv()<=c.in.DEBUG&&rb("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),o5(t)),this.appendRemainingResults(e,s,t,ie(r,rZ)).next(e=>e))})}applyQuery(e,t){let n=new sK(li(e));return t.forEach((t,r)=>{o7(e,r)&&(n=n.add(r))}),n}needsRefill(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}executeFullCollectionScan(e,t,n){return rv()<=c.in.DEBUG&&rb("QueryEngine","Using full collection scan to execute query:",o5(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,ir.min(),n)}appendRemainingResults(e,t,n,r){return this.localDocumentsView.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pn="firestore_clients";function pr(e,t){return`${pn}_${e}_${t}`}let pi="firestore_mutations";function ps(e,t,n){let r=`${pi}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let pa="firestore_targets";function po(e,t){return`${pa}_${e}_${t}`}let pl="firestore_online_state";function pu(e){return`${pl}_${e}`}let pc="firestore_bundle_loaded_v2";function ph(e){return`${pc}_${e}`}let pd="firestore_sequence_number";function pf(e){return`${pd}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pp="SharedClientState";class pg{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static fromWebStorageEntry(e,t,n){let r;let i=JSON.parse(n),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new rR(i.error.code,i.error.message)),s)?new pg(e,t,i.state,r):(rS(pp,`Failed to parse mutation state for ID '${t}': ${n}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class pm{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static fromWebStorageEntry(e,t){let n;let r=JSON.parse(t),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return(i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new rR(r.error.code,r.error.message)),i)?new pm(e,r.state,n):(rS(pp,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class py{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=lT();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=ac(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new py(e,i):(rS(pp,`Failed to parse client data for instance '${e}': ${t}`),null)}}class pv{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new pv(t.clientId,t.onlineState):(rS(pp,`Failed to parse online state: ${e}`),null)}}class pb{constructor(){this.activeTargetIds=lT()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class pS{constructor(e,t,n,r,i){this.window=e,this.queue=t,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new sV(rU),this.started=!1,this.earlyEvents=[];let s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=pr(this.persistenceKey,this.localClientId),this.sequenceNumberKey=pf(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new pb),this.clientStateKeyRe=RegExp(`^${pn}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${pi}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${pa}_${s}_(\\d+)$`),this.onlineStateKey=pu(this.persistenceKey),this.bundleLoadedKey=ph(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(pr(this.persistenceKey,e));if(t){let n=py.fromWebStorageEntry(e,t);n&&(this.activeClients=this.activeClients.insert(n.clientId,n))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,n){this.persistMutationState(e,t,n),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(po(this.persistenceKey,e));if(n){let r=pm.fromWebStorageEntry(e,n);r&&(t=r.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(po(this.persistenceKey,e))}updateQueryState(e,t,n){this.persistQueryTargetState(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return rb(pp,"READ",e,t),t}setItem(e,t){rb(pp,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){rb(pp,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(rb(pp,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){rS("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(t);return}if(null!==t.key){if(this.clientStateKeyRe.test(t.key)){if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=pT(t.newValue);e!==iR.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,n){let r=new pg(this.currentUser,e,t,n),i=ps(this.persistenceKey,this.currentUser,e);this.setItem(i,r.toWebStorageJSON())}removeMutationState(e){let t=ps(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,n){let r=po(this.persistenceKey,e),i=new pm(e,t,n);this.setItem(r,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let n=this.fromWebStorageClientStateKey(e);return py.fromWebStorageEntry(n,t)}fromWebStorageMutationMetadata(e,t){let n=this.mutationBatchKeyRe.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return pg.fromWebStorageEntry(new rf(i),r,t)}fromWebStorageQueryTargetMetadata(e,t){let n=Number(this.queryTargetKeyRe.exec(e)[1]);return pm.fromWebStorageEntry(n,t)}fromWebStorageOnlineState(e){return pv.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){if(e.user.uid!==this.currentUser.uid){rb(pp,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let n=t?this.activeClients.insert(e,t):this.activeClients.remove(e),r=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=n})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=lT();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}function pT(e){let t=iR.INVALID;if(null!=e)try{let n=JSON.parse(e);rE("number"==typeof n),t=n}catch(e){rS(pp,"Failed to read sequence number from WebStorage",e)}return t}class pC{constructor(){this.localState=new pb,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,n){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new pb,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pw{addCallback(e){}shutdown(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pE{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pI=null;function p_(){return 268435456+Math.round(2147483648*Math.random())}function pR(){return null===pI?pI=p_():pI++,"0x"+pI.toString(16)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pk(e){return new Promise((t,n)=>{e((e,r)=>{e?n(e):t(r)})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pA="1.9.1",pD="GrpcConnection",px=`gl-node/${process.versions.node} fire/${rp} grpc/${pA}`;function pN(e,t,n,r){rE(null===t||"OAuth"===t.type);let i=new ru.SF;return t&&t.headers.forEach((e,t)=>i.set(t,e)),n&&n.headers.forEach((e,t)=>i.set(t,e)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",px),i.set("Google-Cloud-Resource-Prefix",e),i.set("x-goog-request-params",e),i}class pO{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){rb(pD,"Creating Firestore stub.");let e=this.databaseInfo.ssl?ru.K9.createSsl():ru.K9.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,n,r,i){let s=pR(),a=this.ensureActiveStub(),o=pN(this.databasePath,r,i,this.databaseInfo.appId),l=Object.assign({database:this.databasePath},n);return pk(t=>(rb(pD,`RPC '${e}' ${s} invoked with request:`,n),a[e](l,o,(n,r)=>{n?(rb(pD,`RPC '${e}' ${s} failed with error:`,n),t(new rR(ua(n.code),n.message))):(rb(pD,`RPC '${e}' ${s} completed with response:`,r),t(void 0,r))})))}invokeStreamingRPC(e,t,n,r,i,s){let a=pR(),o=[],l=new rk;rb(pD,`RPC '${e}' ${a} invoked (streaming) with request:`,n);let u=this.ensureActiveStub(),c=pN(this.databasePath,r,i,this.databaseInfo.appId),h=Object.assign(Object.assign({},n),{database:this.databasePath}),d=u[e](h,c),f=!1;return d.on("data",t=>{rb(pD,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(f=!0,l.resolve(o))}),d.on("end",()=>{rb(pD,`RPC '${e}' ${a} completed.`),f||(f=!0,l.resolve(o))}),d.on("error",t=>{rb(pD,`RPC '${e}' ${a} failed with error:`,t);let n=ua(t.code);l.reject(new rR(n,t.message))}),l.promise}openStream(e,t,n){let r=pR(),i=this.ensureActiveStub(),s=pN(this.databasePath,t,n,this.databaseInfo.appId),a=i[e](s),o=!1,l=e=>{o||(o=!0,u.callOnClose(e),a.end())},u=new pE({sendFn:t=>{if(o)rb(pD,`RPC '${e}' stream ${r} not sending because gRPC stream is closed:`,t);else{rb(pD,`RPC '${e}' stream ${r} sending:`,t);try{a.write(t)}catch(e){throw rS("Failure sending:",t),rS("Error:",e),e}}},closeFn:()=>{rb(pD,`RPC '${e}' stream ${r} closed locally via close().`),l()}});return a.on("data",t=>{o||(rb(pD,`RPC '${e}' stream ${r} received:`,t),u.callOnMessage(t))}),a.on("end",()=>{rb(pD,`RPC '${e}' stream ${r} ended.`),l()}),a.on("error",t=>{o||(rT(pD,`RPC '${e}' stream ${r} error. Code:`,t.code,"Message:",t.message),l(new rR(ua(t.code),t.message)))}),rb(pD,`Opening RPC '${e}' stream ${r} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}}let pM={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var pP={nested:pM},pL=Object.freeze({__proto__:null,nested:pM,default:pP});/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pB={longs:String,enums:String,defaults:!0,oneofs:!1};function pF(){let e=rc.im(pL,pB);return ru.Rz(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pj(e){return new pO(pF(),e)}function pU(){return new pw}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pV(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function pz(){return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pq(e){return new uD(e,!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pG="ExponentialBackoff",pK=1e3,p$=1.5,pH=6e4;class pW{constructor(e,t,n=pK,r=p$,i=pH){this.queue=e,this.timerId=t,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),n=Math.max(0,Date.now()-this.lastAttemptTime),r=Math.max(0,t-n);r>0&&rb(pG,`Backing off for ${r} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,r,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pQ="PersistentStream",pY=6e4,pJ=1e4;class pX{constructor(e,t,n,r,i,s,a,o){this.queue=e,this.idleTimerId=n,this.healthTimerId=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new pW(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(4===this.state){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,pY,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===r_.RESOURCE_EXHAUSTED?(rS(t.toString()),rS("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===r_.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.closeCount===t&&this.startStream(e,n)},t=>{e(()=>{let e=new rR(r_.UNKNOWN,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{n(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,pJ,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{n(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return rb(pQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(rb(pQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pZ extends pX{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=u1(this.serializer,e),n=u4(e);return this.listener.onWatchChange(t,n)}watch(e){let t={};t.database=u$(this.serializer),t.addTarget=cc(this.serializer,e);let n=cl(this.serializer,e);n&&(t.labels=n),this.sendRequest(t)}unwatch(e){let t={};t.database=u$(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class p0 extends pX{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(rE(!!e.streamToken),this.lastStreamToken=e.streamToken,!this.handshakeComplete_)return rE(!e.writeResults||0===e.writeResults.length),this.handshakeComplete_=!0,this.listener.onHandshakeComplete();{this.backoff.reset();let t=u8(e.writeResults,e.commitTime),n=uj(e.commitTime);return this.listener.onMutationResult(n,t)}}writeHandshake(){let e={};e.database=u$(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>u3(this.serializer,e))};this.sendRequest(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1{}class p2 extends p1{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new rR(r_.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.invokeRPC(e,t,n,r,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===r_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rR(r_.UNKNOWN,e.toString())})}invokeStreamingRPC(e,t,n,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeStreamingRPC(e,t,n,i,s,r)).catch(e=>{if("FirebaseError"===e.name)throw e.code===r_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rR(r_.UNKNOWN,e.toString())})}terminate(){this.terminated=!0}}function p4(e,t,n,r){return new p2(e,t,n,r)}async function p3(e,t){let n=rI(e),r=u$(n.serializer)+"/documents",i={writes:t.map(e=>u3(n.serializer,e))};await n.invokeRPC("Commit",r,i)}async function p6(e,t){let n=rI(e),r=u$(n.serializer)+"/documents",i={documents:t.map(e=>uz(n.serializer,e))},s=await n.invokeStreamingRPC("BatchGetDocuments",r,i,t.length),a=new Map;s.forEach(e=>{let t=u0(n.serializer,e);a.set(t.key.toString(),t)});let o=[];return t.forEach(e=>{let t=a.get(e.toString());rE(!!t),o.push(t)}),o}async function p9(e,t,n){var r;let i=rI(e),{request:s,aliasMap:a}=cs(i.serializer,oX(t),n),o=s.parent;i.connection.shouldResourcePathBeIncludedInRequest||delete s.parent;let l=(await i.invokeStreamingRPC("RunAggregationQuery",o,s,1)).filter(e=>!!e.result);rE(1===l.length);let u=null===(r=l[0].result)||void 0===r?void 0:r.aggregateFields;return Object.keys(u).reduce((e,t)=>(e[a[t]]=u[t],e),{})}function p5(e,t,n){let r=rI(e);return r.verifyInitialized(),new p0(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}function p7(e,t,n){let r=rI(e);return r.verifyInitialized(),new pZ(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let p8="OnlineStateTracker",ge=1,gt=1e4;class gn{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",gt,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${gt/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=ge&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${ge} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(rS(t),this.shouldWarnClientIsOffline=!1):rb(p8,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gr="RemoteStore",gi=10;class gs{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{n.enqueueAndForget(async()=>{gm(this)&&(rb(gr,"Restarting streams for network reachability change."),await gP(this))})}),this.onlineStateTracker=new gn(n,r)}}function ga(e,t,n,r,i){return new gs(e,t,n,r,i)}async function go(e){if(gm(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function gl(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function gu(e){let t=rI(e);rb(gr,"RemoteStore shutting down."),t.offlineCauses.add(5),await gl(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function gc(e,t){let n=rI(e);!n.listenTargets.has(t.targetId)&&(n.listenTargets.set(t.targetId,t),gg(n)?gp(n):gF(n).isOpen()&&gd(n,t))}function gh(e,t){let n=rI(e),r=gF(n);n.listenTargets.delete(t),r.isOpen()&&gf(n,t),0===n.listenTargets.size&&(r.isOpen()?r.markIdle():gm(n)&&n.onlineStateTracker.set("Unknown"))}function gd(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(r$.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}gF(e).watch(t)}function gf(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),gF(e).unwatch(t)}function gp(e){e.watchChangeAggregator=new uw({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),gF(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function gg(e){return gm(e)&&!gF(e).isStarted()&&e.listenTargets.size>0}function gm(e){return 0===rI(e).offlineCauses.size}function gy(e){e.watchChangeAggregator=void 0}async function gv(e){e.listenTargets.forEach((t,n)=>{gd(e,t)})}async function gb(e,t){gy(e),gg(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),gp(e)):e.onlineStateTracker.set("Unknown")}async function gS(e,t,n){if(e.onlineStateTracker.set("Online"),t instanceof uS&&2===t.state&&t.cause){try{await gE(e,t)}catch(n){rb(gr,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await gT(e,n)}return}if(t instanceof uv?e.watchChangeAggregator.handleDocumentChange(t):t instanceof ub?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!n.isEqual(r$.min()))try{let t=await fF(e.localStore);n.compareTo(t)>=0&&await gw(e,n)}catch(t){rb(gr,"Failed to raise snapshot:",t),await gT(e,t)}}async function gT(e,t,n){if(im(t))e.offlineCauses.add(1),await gl(e),e.onlineStateTracker.set("Offline"),n||(n=()=>fF(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{rb(gr,"Retrying IndexedDB access"),await n(),e.offlineCauses.delete(1),await go(e)});else throw t}function gC(e,t){return t().catch(n=>gT(e,n,t))}function gw(e,t){let n=e.watchChangeAggregator.createRemoteEvent(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(r);i&&e.listenTargets.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.listenTargets.get(t);r&&(e.listenTargets.set(t,r.withResumeToken(sX.EMPTY_BYTE_STRING,r.snapshotVersion)),gf(e,t),gd(e,new cj(r.target,t,n,r.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(n)}async function gE(e,t){let n=t.cause;for(let r of t.targetIds)e.listenTargets.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.listenTargets.delete(r),e.watchChangeAggregator.removeTarget(r))}async function gI(e){let t=rI(e),n=gj(t),r=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:ao;for(;g_(t);)try{let e=await fq(t.localStore,r);if(null===e){0===t.writePipeline.length&&n.markIdle();break}r=e.batchId,gR(t,e)}catch(e){await gT(t,e)}gk(t)&&gA(t)}function g_(e){return gm(e)&&e.writePipeline.length<gi}function gR(e,t){e.writePipeline.push(t);let n=gj(e);n.isOpen()&&n.handshakeComplete&&n.writeMutations(t.mutations)}function gk(e){return gm(e)&&!gj(e).isStarted()&&e.writePipeline.length>0}function gA(e){gj(e).start()}async function gD(e){gj(e).writeHandshake()}async function gx(e){let t=gj(e);for(let n of e.writePipeline)t.writeMutations(n.mutations)}async function gN(e,t,n){let r=e.writePipeline.shift(),i=ut.from(r,t,n);await gC(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await gI(e)}async function gO(e,t){t&&gj(e).handshakeComplete&&await gM(e,t),gk(e)&&gA(e)}async function gM(e,t){if(us(t.code)){let n=e.writePipeline.shift();gj(e).inhibitBackoff(),await gC(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await gI(e)}}async function gP(e){let t=rI(e);t.offlineCauses.add(4),await gl(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await go(t)}async function gL(e,t){let n=rI(e);n.asyncQueue.verifyOperationInProgress(),rb(gr,"RemoteStore received new credentials");let r=gm(n);n.offlineCauses.add(3),await gl(n),r&&n.onlineStateTracker.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.offlineCauses.delete(3),await go(n)}async function gB(e,t){let n=rI(e);t?(n.offlineCauses.delete(2),await go(n)):t||(n.offlineCauses.add(2),await gl(n),n.onlineStateTracker.set("Unknown"))}function gF(e){return e.watchStream||(e.watchStream=p7(e.datastore,e.asyncQueue,{onOpen:gv.bind(null,e),onClose:gb.bind(null,e),onWatchChange:gS.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),gg(e)?gp(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),gy(e))})),e.watchStream}function gj(e){return e.writeStream||(e.writeStream=p5(e.datastore,e.asyncQueue,{onOpen:gD.bind(null,e),onClose:gO.bind(null,e),onHandshakeComplete:gx.bind(null,e),onMutationResult:gN.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await gI(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(rb(gr,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gU="AsyncQueue";class gV{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new rk,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new gV(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rR(r_.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function gz(e,t){if(rS(gU,`${t}: ${e}`),im(e))return new rR(r_.UNAVAILABLE,`${t}: ${e}`);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gq{constructor(e){e?this.comparator=(t,n)=>e(t,n)||rX.comparator(t.key,n.key):this.comparator=(e,t)=>rX.comparator(e.key,t.key),this.keyedMap=lc(),this.sortedSet=new sV(this.comparator)}static emptySet(e){return new gq(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gq)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new gq;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gG{constructor(){this.changeMap=new sV(rX.comparator)}track(e){let t=e.doc.key,n=this.changeMap.get(t);if(!n){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===n.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==n.type?this.changeMap=this.changeMap.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):rw()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,n)=>{e.push(n)}),e}}class gK{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new gK(e,t,gq.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!o6(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g${constructor(){this.viewSnap=void 0,this.listeners=[]}}function gH(){return new gW}class gW{constructor(){this.queries=new la(e=>o9(e),o6),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}}async function gQ(e,t){let n=rI(e),r=t.query,i=!1,s=n.queries.get(r);if(s||(i=!0,s=new g$),i)try{s.viewSnap=await n.onListen(r)}catch(n){let e=gz(n,`Initialization of query '${o5(t.query)}' failed`);t.onError(e);return}n.queries.set(r,s),s.listeners.push(t),t.applyOnlineStateChange(n.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&g0(n)}async function gY(e,t){let n=rI(e),r=t.query,i=!1,s=n.queries.get(r);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function gJ(e,t){let n=rI(e),r=!1;for(let e of t){let t=e.query,i=n.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(r=!0);i.viewSnap=e}}r&&g0(n)}function gX(e,t,n){let r=rI(e),i=r.queries.get(t);if(i)for(let e of i.listeners)e.onError(n);r.queries.delete(t)}function gZ(e,t){let n=rI(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(let e of n.listeners)e.applyOnlineStateChange(t)&&(r=!0)}),r&&g0(n)}function g0(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}class g1{constructor(e,t,n){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=n||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new gK(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache)return!0;let n="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=gK.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g2{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.addedKeys=n,this.removedKeys=r}static fromSnapshot(e,t){let n=lb(),r=lb();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new g2(e,t.fromCache,n,r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4{constructor(e){this.serializer=e}toDocumentKey(e){return uq(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?uJ(this.serializer,e.document,!1):a4.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return uj(e)}}class g3{constructor(e,t,n){this.bundleMetadata=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=g6(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let n=rQ.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,n=new g4(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.toDocumentKey(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||lb()).add(e);t.set(n,r)}}return t}async complete(){let e=await f4(this.localStore,new g4(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let e of this.queries)await f9(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}}}function g6(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function g9(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5{constructor(e){this.key=e}}class g7{constructor(e){this.key=e}}class g8{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=lb(),this.mutatedKeys=lb(),this.docComparator=li(e),this.documentSet=new gq(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let n=t?t.changeSet:new gG,r=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),c=o7(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),f=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(n.track({type:3,doc:c}),f=!0):!this.shouldWaitForSyncedDocument(u,c)&&(n.track({type:2,doc:c}),f=!0,(o&&this.docComparator(c,o)>0||l&&0>this.docComparator(c,l))&&(a=!0)):!u&&c?(n.track({type:0,doc:c}),f=!0):u&&!c&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{documentSet:s,changeSet:n,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){let r=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let i=e.changeSet.getChanges();i.sort((e,t)=>me(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(n);let s=t?this.updateLimboDocuments():[],a=0===this.limboDocuments.size&&this.current?1:0,o=a!==this.syncState;return(this.syncState=a,0!==i.length||o)?{snapshot:new gK(this.query,e.documentSet,r,i,e.mutatedKeys,0===a,o,!1,!!n&&n.resumeToken.approximateByteSize()>0),limboChanges:s}:{limboChanges:s}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new gG,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=lb(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new g7(e))}),this.limboDocuments.forEach(n=>{e.has(n)||t.push(new g5(n))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=lb();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return gK.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function me(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rw()}};return n(e)-n(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mt="SyncEngine";class mn{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class mr{constructor(e){this.key=e,this.receivedDocument=!1}}class mi{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new la(e=>o9(e),o6),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new sV(rX.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new dW,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=dh.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function ms(e,t,n,r,i,s,a){let o=new mi(e,t,n,r,i,s);return a&&(o._isPrimaryClient=!0),o}async function ma(e,t){let n,r;let i=mF(e),s=i.queryViewsByQuery.get(t);if(s)n=s.targetId,i.sharedClientState.addLocalQueryTarget(n),r=s.view.computeInitialSnapshot();else{let e=await fK(i.localStore,oJ(t)),s=i.sharedClientState.addLocalQueryTarget(e.targetId);n=e.targetId,r=await mo(i,t,n,"current"===s,e.resumeToken),i.isPrimaryClient&&gc(i.remoteStore,e)}return r}async function mo(e,t,n,r,i){e.applyDocChanges=(t,n,r)=>mI(e,t,n,r);let s=await fW(e.localStore,t,!0),a=new g8(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=uy.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);mT(e,n,u.limboChanges);let c=new mn(t,n,a);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(n)?e.queriesByTarget.get(n).push(t):e.queriesByTarget.set(n,[t]),u.snapshot}async function ml(e,t){let n=rI(e),r=n.queryViewsByQuery.get(t),i=n.queriesByTarget.get(r.targetId);if(i.length>1){n.queriesByTarget.set(r.targetId,i.filter(e=>!o6(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await fH(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),gh(n.remoteStore,r.targetId),mb(n,r.targetId)}).catch(io)):(mb(n,r.targetId),await fH(n.localStore,r.targetId,!0))}async function mu(e,t,n){let r=mj(e);try{let e=await fO(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),my(r,e.batchId,n),await mE(r,e.changes),await gI(r.remoteStore)}catch(t){let e=gz(t,"Failed to persist write");n.reject(e)}}async function mc(e,t){let n=rI(e);try{let e=await fj(n.localStore,t);t.targetChanges.forEach((e,t)=>{let r=n.activeLimboResolutionsByTarget.get(t);r&&(rE(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?rE(r.receivedDocument):e.removedDocuments.size>0&&(rE(r.receivedDocument),r.receivedDocument=!1))}),await mE(n,e,t)}catch(e){await io(e)}}function mh(e,t,n){let r=rI(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){let e=[];r.queryViewsByQuery.forEach((n,r)=>{let i=r.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),gZ(r.eventManager,t),e.length&&r.syncEngineListener.onWatchChange(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function md(e,t,n){let r=rI(e);r.sharedClientState.updateQueryState(t,"rejected",n);let i=r.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new sV(rX.comparator);e=e.insert(s,a4.newNoDocument(s,r$.min()));let n=lb().add(s),i=new um(r$.min(),new Map,new sV(rU),e,n);await mc(r,i),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(t),mw(r)}else await fH(r.localStore,t,!1).then(()=>mb(r,t,n)).catch(io)}async function mf(e,t){let n=rI(e),r=t.batch.batchId;try{let e=await fM(n.localStore,t);mv(n,r,null),mg(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await mE(n,e)}catch(e){await io(e)}}async function mp(e,t,n){let r=rI(e);try{let e=await fL(r.localStore,t);mv(r,t,n),mg(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await mE(r,e)}catch(e){await io(e)}}function mg(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function mm(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new rR(r_.CANCELLED,t))})}),e.pendingWritesCallbacks.clear()}function my(e,t,n){let r=e.mutationUserCallbacks[e.currentUser.toKey()];r||(r=new sV(rU)),r=r.insert(t,n),e.mutationUserCallbacks[e.currentUser.toKey()]=r}function mv(e,t,n){let r=rI(e),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function mb(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(r),n&&e.syncEngineListener.onWatchError(r,n);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||mS(e,t)})}function mS(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let n=e.activeLimboTargetsByKey.get(t);null!==n&&(gh(e.remoteStore,n),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(n),mw(e))}function mT(e,t,n){for(let r of n)r instanceof g5?(e.limboDocumentRefs.addReference(r.key,t),mC(e,r)):r instanceof g7?(rb(mt,"Document no longer in limbo: "+r.key),e.limboDocumentRefs.removeReference(r.key,t),e.limboDocumentRefs.containsKey(r.key)||mS(e,r.key)):rw()}function mC(e,t){let n=t.key,r=n.path.canonicalString();e.activeLimboTargetsByKey.get(n)||e.enqueuedLimboResolutions.has(r)||(rb(mt,"New document in limbo: "+n),e.enqueuedLimboResolutions.add(r),mw(e))}function mw(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let n=new rX(rQ.fromString(t)),r=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(r,new mr(n)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(n,r),gc(e.remoteStore,new cj(oJ(oG(n.path)),r,"TargetPurposeLimboResolution",iR.INVALID))}}async function mE(e,t,n){let r=rI(e),i=[],s=[],a=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((e,o)=>{a.push(r.applyDocChanges(o,t,n).then(e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(o.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);let t=g2.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),r.syncEngineListener.onWatchChange(i),await fz(r.localStore,s))}async function mI(e,t,n,r){let i=t.view.computeDocChanges(n);i.needsRefill&&(i=await fW(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s);return mT(e,t.targetId,a.limboChanges),a.snapshot}async function m_(e,t){let n=rI(e);if(!n.currentUser.isEqual(t)){rb(mt,"User change. New user:",t.toKey());let e=await fN(n.localStore,t);n.currentUser=t,mm(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await mE(n,e.affectedDocuments)}}function mR(e,t){let n=rI(e),r=n.activeLimboResolutionsByTarget.get(t);if(r&&r.receivedDocument)return lb().add(r.key);{let e=lb(),r=n.queriesByTarget.get(t);if(!r)return e;for(let t of r){let r=n.queryViewsByQuery.get(t);e=e.unionWith(r.view.syncedDocuments)}return e}}async function mk(e,t){let n=rI(e),r=await fW(n.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(r);return n.isPrimaryClient&&mT(n,t.targetId,i.limboChanges),i}async function mA(e,t){let n=rI(e);return f0(n.localStore,t).then(e=>mE(n,e))}async function mD(e,t,n,r){let i=rI(e),s=await fY(i.localStore,t);if(null===s){rb(mt,"Cannot apply mutation batch with id: "+t);return}"pending"===n?await gI(i.remoteStore):"acknowledged"===n||"rejected"===n?(mv(i,t,r||null),mg(i,t),fJ(i.localStore,t)):rw(),await mE(i,s)}async function mx(e,t){let n=rI(e);if(mF(n),mj(n),!0===t&&!0!==n._isPrimaryClient){let e=n.sharedClientState.getAllActiveQueryTargets(),t=await mO(n,e.toArray());for(let e of(n._isPrimaryClient=!0,await gB(n.remoteStore,!0),t))gc(n.remoteStore,e)}else if(!1===t&&!1!==n._isPrimaryClient){let e=[],t=Promise.resolve();n.queriesByTarget.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(mb(n,i),fH(n.localStore,i,!0))),gh(n.remoteStore,i)}),await t,await mO(n,e),mN(n),n._isPrimaryClient=!1,await gB(n.remoteStore,!1)}}function mN(e){let t=rI(e);t.activeLimboResolutionsByTarget.forEach((e,n)=>{gh(t.remoteStore,n)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new sV(rX.comparator)}async function mO(e,t,n){let r=rI(e),i=[],s=[];for(let e of t){let t;let n=r.queriesByTarget.get(e);if(n&&0!==n.length)for(let e of(t=await fK(r.localStore,oJ(n[0])),n)){let t=r.queryViewsByQuery.get(e),n=await mk(r,t);n.snapshot&&s.push(n.snapshot)}else{let n=await fZ(r.localStore,e);t=await fK(r.localStore,n),await mo(r,mM(n),e,!1,t.resumeToken)}i.push(t)}return r.syncEngineListener.onWatchChange(s),i}function mM(e){return oq(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function mP(e){return fX(rI(e).localStore)}async function mL(e,t,n,r){let i=rI(e);if(i._isPrimaryClient){rb(mt,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{let e=await f0(i.localStore,lr(s[0])),r=um.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,sX.EMPTY_BYTE_STRING);await mE(i,e,r);break}case"rejected":await fH(i.localStore,t,!0),mb(i,t,r);break;default:rw()}}async function mB(e,t,n){let r=mF(e);if(r._isPrimaryClient){for(let e of t){if(r.queriesByTarget.has(e)){rb(mt,"Adding an already active target "+e);continue}let t=await fZ(r.localStore,e),n=await fK(r.localStore,t);await mo(r,mM(t),n.targetId,!1,n.resumeToken),gc(r.remoteStore,n)}for(let e of n)r.queriesByTarget.has(e)&&await fH(r.localStore,e,!1).then(()=>{gh(r.remoteStore,e),mb(r,e)}).catch(io)}}function mF(e){let t=rI(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=mc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=mR.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=md.bind(null,t),t.syncEngineListener.onWatchChange=gJ.bind(null,t.eventManager),t.syncEngineListener.onWatchError=gX.bind(null,t.eventManager),t}function mj(e){let t=rI(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=mf.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=mp.bind(null,t),t}async function mU(e,t,n){try{let r=await t.getMetadata();if(await f3(e.localStore,r))return await t.close(),n._completeWith(g9(r)),Promise.resolve(new Set);n._updateProgress(g6(r));let i=new g3(r,e.localStore,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&n._updateProgress(e),s=await t.nextElement()}let a=await i.complete();return await mE(e,a.changedDocs,void 0),await f6(e.localStore,r),n._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return rT(mt,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mV{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=pq(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return fx(this.persistence,new pt,e.initialUser,this.serializer)}createPersistence(e){return new d4(d6.factory,this.serializer)}createSharedClientState(e){return new pC}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class mz extends null{constructor(e,t,n){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await mj(this.onlineComponentProvider.syncEngine),await gI(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return fx(this.persistence,new pt,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new d_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new i_(t,this.persistence);return new iI(e.asyncQueue,n)}createPersistence(e){let t=f_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?db.withCacheSize(this.cacheSizeBytes):db.DEFAULT;return new fw(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,pV(),pz(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new pC}}class mq{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>mh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=m_.bind(null,this.syncEngine),await gB(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return gH()}createDatastore(e){let t=pq(e.databaseInfo.databaseId),n=pj(e.databaseInfo);return p4(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return ga(this.localStore,this.datastore,e.asyncQueue,e=>mh(this.syncEngine,e,0),pU())}createSyncEngine(e,t){return ms(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return gu(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mG=10240;function mK(e,t=mG){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m$(e,t,n){if(!n)throw new rR(r_.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function mH(e,t,n,r){if(!0===t&&!0===r)throw new rR(r_.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function mW(e){if(!rX.isDocumentKey(e))throw new rR(r_.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function mQ(e){if(rX.isDocumentKey(e))throw new rR(r_.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function mY(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function mJ(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{let t=mX(e);return t?`a custom ${t} object`:"an object"}}if("function"==typeof e)return"a function";return rw()}function mX(e){return e.constructor?e.constructor.name:null}function mZ(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new rR(r_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=mJ(e);throw new rR(r_.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m0(e,t){if(!(e instanceof Uint8Array))throw new rR(r_.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${mJ(e)}`);return mK(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):rS("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m2{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m4{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new rk,this.buffer=new Uint8Array,this.textDecoder=uc(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),n=Number(t);return isNaN(n)&&this.raiseError(`length string (${t}) is not valid number`),new m2(JSON.parse(await this.readJsonString(n)),e.length+n)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function m3(e,t){return new m4(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m6{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new rR(r_.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let t=await p6(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new l9(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=rX.fromPath(t);this.mutations.push(new l8(n,this.precondition(n)))}),await p3(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=r$.min();else throw rw();let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new rR(r_.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?lq.none():t.isEqual(r$.min())?lq.exists(!1):lq.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return lq.exists(!0);if(t.isEqual(r$.min()))throw new rR(r_.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return lq.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m9="FirestoreClient",m5=100,m7=11,m8=20,ye=22;class yt{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=rf.UNAUTHENTICATED,this.clientId=rj.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{rb(m9,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(rb(m9,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:m5}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new rR(r_.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rk;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=gz(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function yn(e,t){e.asyncQueue.verifyOperationInProgress(),rb(m9,"Initializing OfflineComponentProvider");let n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await fN(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function yr(e,t){e.asyncQueue.verifyOperationInProgress();let n=await ys(e);rb(m9,"Initializing OnlineComponentProvider");let r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>gL(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>gL(t.remoteStore,n)),e._onlineComponents=t}function yi(e){return"FirebaseError"===e.name?e.code===r_.FAILED_PRECONDITION||e.code===r_.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===ye||e.code===m8||e.code===m7}async function ys(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){rb(m9,"Using user provided OfflineComponentProvider");try{await yn(e,e._uninitializedComponentsProvider._offline)}catch(n){let t=n;if(!yi(t))throw t;rT("Error using user provided cache. Falling back to memory cache: "+t),await yn(e,new mV)}}else rb(m9,"Using default OfflineComponentProvider"),await yn(e,new mV)}return e._offlineComponents}async function ya(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(rb(m9,"Using user provided OnlineComponentProvider"),await yr(e,e._uninitializedComponentsProvider._online)):(rb(m9,"Using default OnlineComponentProvider"),await yr(e,new mq))),e._onlineComponents}function yo(e){return ys(e).then(e=>e.localStore)}function yl(e){return ya(e).then(e=>e.syncEngine)}function yu(e){return ya(e).then(e=>e.datastore)}async function yc(e){let t=await ya(e),n=t.eventManager;return n.onListen=ma.bind(null,t.syncEngine),n.onUnlisten=ml.bind(null,t.syncEngine),n}function yh(e,t,n,r){let i=new m1(r),s=new g1(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>gQ(await yc(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>gY(await yc(e),s))}}function yd(e,t,n={}){let r=new rk;return e.asyncQueue.enqueueAndForget(async()=>yg(await yc(e),e.asyncQueue,t,n,r)),r.promise}function yf(e,t,n={}){let r=new rk;return e.asyncQueue.enqueueAndForget(async()=>ym(await yc(e),e.asyncQueue,t,n,r)),r.promise}function yp(e,t){let n=new rk;return e.asyncQueue.enqueueAndForget(async()=>mu(await yl(e),t,n)),n.promise}function yg(e,t,n,r,i){let s=new m1({next:s=>{t.enqueueAndForget(()=>gY(e,a));let o=s.docs.has(n);!o&&s.fromCache?i.reject(new rR(r_.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&s.fromCache&&r&&"server"===r.source?i.reject(new rR(r_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),a=new g1(oG(n.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return gQ(e,a)}function ym(e,t,n,r,i){let s=new g1(n,new m1({next:n=>{t.enqueueAndForget(()=>gY(e,s)),n.fromCache&&"server"===r.source?i.reject(new rR(r_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return gQ(e,s)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yy(e,t){return e.timeoutSeconds===t.timeoutSeconds}function yv(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yb="ComponentProvider",yS=new Map;function yT(e){let t=yS.get(e);t&&(rb(yb,"Removing Datastore"),yS.delete(e),t.terminate())}function yC(e,t,n,r){return new ar(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,yv(r.experimentalLongPollingOptions),r.useFetchStreams)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yw="firestore.googleapis.com",yE=!0,yI=5,y_=30,yR=!0;class yk{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new rR(r_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=yw,this.ssl=yE}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:yE;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=dv;else{if(e.cacheSizeBytes!==dy&&e.cacheSizeBytes<dT)throw new rR(r_.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${dT}`);this.cacheSizeBytes=e.cacheSizeBytes}mH("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=yR:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yv(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),yA(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&yy(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function yA(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rR(r_.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<yI)throw new rR(r_.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${yI})`);if(e.timeoutSeconds>y_)throw new rR(r_.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${y_})`)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yk({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new rR(r_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rR(r_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yk(e),void 0!==e.credentials&&(this._authCredentials=rB(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return yT(this),Promise.resolve()}}function yx(e,t,n,r={}){var i;let s=(e=mZ(e,yD))._getSettings(),a=`${t}:${n}`;if(s.host!==yw&&s.host!==a&&rT("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=rf.MOCK_USER;else{t=(0,d.Sg)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new rR(r_.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new rf(s)}e._authCredentials=new rx(new rA(t,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new yN(this.firestore,e,this._query)}}class yO{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yM(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yO(this.firestore,e,this._key)}}class yM extends yN{constructor(e,t,n){super(e,t,oG(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new yO(this.firestore,null,new rX(e))}withConverter(e){return new yM(this.firestore,e,this._path)}}function yP(e,t,...n){if(e=(0,d.m9)(e),m$("collection","path",t),e instanceof yD){let r=rQ.fromString(t,...n);return mQ(r),new yM(e,null,r)}{if(!(e instanceof yO)&&!(e instanceof yM))throw new rR(r_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(rQ.fromString(t,...n));return mQ(r),new yM(e.firestore,null,r)}}function yL(e,t,...n){if(e=(0,d.m9)(e),1==arguments.length&&(t=rj.newId()),m$("doc","path",t),e instanceof yD){let r=rQ.fromString(t,...n);return mW(r),new yO(e,null,new rX(r))}{if(!(e instanceof yO)&&!(e instanceof yM))throw new rR(r_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(rQ.fromString(t,...n));return mW(r),new yO(e.firestore,e instanceof yM?e.converter:null,new rX(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yB="AsyncQueue";class yF{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new pW(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new rk;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(im(e))rb(yB,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,rS("INTERNAL UNHANDLED ERROR: ",yU(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,n){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let r=gV.createAndSchedule(this,e,t,n,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(r),r}verifyNotFailed(){this.failure&&rw()}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function yj(){return new yF}function yU(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class yV extends yD{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=yj(),this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||yG(this),this._firestoreClient.terminate()}}function yz(e,t){let n="object"==typeof e?e:(0,l.Mq)(),r="string"==typeof e?e:t||ai,i=(0,l.qX)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=(0,d.P0)("firestore");e&&yx(i,...e)}return i}function yq(e){return e._firestoreClient||yG(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function yG(e){var t,n,r;let i=e._freezeSettings(),s=yC(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new yt(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yK(e,t=!0){rg(l.Jn),(0,l.Xd)(new u.wA("firestore",(e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider("app").getImmediate(),s=new yV(new rN(e.getProvider("auth-internal")),new rL(e.getProvider("app-check-internal")),aa(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,l.KN)(rh,rd,e),(0,l.KN)(rh,rd,"esm2017")}class y${constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yH{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yH(sX.fromBase64String(e))}catch(e){throw new rR(r_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new yH(sX.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yW{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rR(r_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rJ(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yQ{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yY{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rR(r_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rR(r_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return rU(this._lat,e._lat)||rU(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yJ=/^__.*__$/;class yX{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new l0(e,this.data,this.fieldMask,t,this.fieldTransforms):new lJ(e,this.data,t,this.fieldTransforms)}}class yZ{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new l0(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function y0(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rw()}}class y1{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new y1(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return vc(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(y0(this.dataSource)&&yJ.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class y2{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||pq(e)}createContext(e,t,n,r=!1){return new y1({dataSource:e,methodName:t,targetDoc:n,path:rJ.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function y4(e){let t=e._freezeSettings(),n=pq(e._databaseId);return new y2(e._databaseId,!!t.ignoreUndefinedProperties,n)}function y3(e,t,n,r,i,s={}){let a,o;let l=e.createContext(s.merge||s.mergeFields?2:0,t,n,i);va("Data must be an object, but it was:",l,r);let u=vt(r,l);if(s.merge)a=new sQ(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=vo(t,r,n);if(!l.contains(i))throw new rR(r_.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);vh(e,i)||e.push(i)}a=new sQ(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new yX(new a1(u),a,o)}class y6 extends yQ{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof y6}}class y9 extends yQ{_toFieldTransform(e){return new lj(e.path,new lD)}isEqual(e){return e instanceof y9}}function y5(e,t,n,r){let i=e.createContext(1,t,n);va("Data must be an object, but it was:",i,r);let s=[],a=a1.empty();return sj(r,(e,r)=>{let o=vu(t,e,n);r=(0,d.m9)(r);let l=i.childContextForFieldPath(o);if(r instanceof y6)s.push(o);else{let e=ve(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new yZ(a,new sQ(s),i.fieldTransforms)}function y7(e,t,n,r,i,s){let a=e.createContext(1,t,n),o=[vo(t,r,n)],l=[i];if(s.length%2!=0)throw new rR(r_.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(vo(t,s[e])),l.push(s[e+1]);let u=[],c=a1.empty();for(let e=o.length-1;e>=0;--e)if(!vh(u,o[e])){let t=o[e],n=l[e];n=(0,d.m9)(n);let r=a.childContextForFieldPath(t);if(n instanceof y6)u.push(t);else{let e=ve(n,r);null!=e&&(u.push(t),c.set(t,e))}}return new yZ(c,new sQ(u),a.fieldTransforms)}function y8(e,t,n,r=!1){return ve(n,e.createContext(r?4:3,t))}function ve(e,t){if(vs(e=(0,d.m9)(e)))return va("Unsupported field value:",t,e),vt(e,t);if(e instanceof yQ)return vr(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return vi(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return vn(e,t)}function vt(e,t){let n={};return sU(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sj(e,(e,r)=>{let i=ve(r,t.childContextForField(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function vn(e,t){let n=[],r=0;for(let i of e){let e=ve(i,t.childContextForArray(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}function vr(e,t){if(!y0(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}function vi(e,t){if(null===(e=(0,d.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return lE(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=rK.fromDate(e);return{timestampValue:uM(t.serializer,n)}}if(e instanceof rK){let n=new rK(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:uM(t.serializer,n)}}if(e instanceof yY)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof yH)return{bytesValue:uL(t.serializer,e._byteString)};else if(e instanceof yO){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:uU(e.firestore._databaseId||t.databaseId,e._key.path)}}else throw t.createError(`Unsupported field value: ${mJ(e)}`)}function vs(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof rK)&&!(e instanceof yY)&&!(e instanceof yH)&&!(e instanceof yO)&&!(e instanceof yQ)}function va(e,t,n){if(!vs(n)||!mY(n)){let r=mJ(n);if("an object"===r)throw t.createError(e+" a custom object");throw t.createError(e+" "+r)}}function vo(e,t,n){if((t=(0,d.m9)(t))instanceof yW)return t._internalPath;if("string"==typeof t)return vu(e,t);throw vc("Field path arguments must be of type string or ",e,!1,void 0,n)}let vl=RegExp("[~\\*/\\[\\]]");function vu(e,t,n){if(t.search(vl)>=0)throw vc(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new yW(...t.split("."))._internalPath}catch(r){throw vc(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function vc(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new rR(r_.INVALID_ARGUMENT,o+e+l)}function vh(e,t){return e.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yO(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new vf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}get(e){if(this._document){let t=this._document.data.field(vp("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class vf extends vd{data(){return super.data()}}function vp(e,t){return"string"==typeof t?vu(e,t):t instanceof yW?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vg(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rR(r_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vm{}class vy extends vm{}function vv(e,t,...n){let r=[];for(let i of(t instanceof vm&&r.push(t),vF(r=r.concat(n)),r))e=i._apply(e);return e}class vb extends vy{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new vb(e,t,n)}_apply(e){let t=this._parse(e);return vP(e._query,t),new yN(e.firestore,e.converter,o0(e._query,t))}_parse(e){let t=y4(e.firestore);return vk(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function vS(e,t,n){let r=t,i=vp("where",e);return vb._create(i,r,n)}class vT extends vm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new vT(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:oa.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(vL(e._query,t),new yN(e.firestore,e.converter,o0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class vC extends vy{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new vC(e,t)}_apply(e){let t=vA(e._query,this._field,this._direction);return new yN(e.firestore,e.converter,o1(e._query,t))}}function vw(e,t="asc"){let n=t,r=vp("orderBy",e);return vC._create(r,n)}class vE extends null{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new vE(e,t,n)}_apply(e){return new yN(e.firestore,e.converter,o2(e._query,this._limit,this._limitType))}}class vI extends null{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new vI(e,t,n)}_apply(e){let t=vR(e,this.type,this._docOrFields,this._inclusive);return new yN(e.firestore,e.converter,o4(e._query,t))}}class v_ extends null{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new v_(e,t,n)}_apply(e){let t=vR(e,this.type,this._docOrFields,this._inclusive);return new yN(e.firestore,e.converter,o3(e._query,t))}}function vR(e,t,n,r){if(n[0]=getModularInstance(n[0]),n[0]instanceof vd)return vD(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=y4(e.firestore);return vx(e._query,e.firestore._databaseId,i,t,n,r)}}function vk(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new rR(r_.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){vO(a,s);let t=[];for(let n of a)t.push(vN(r,e,n));o={arrayValue:{values:t}}}else o=vN(r,e,a)}else("in"===s||"not-in"===s||"array-contains-any"===s)&&vO(a,s),o=y8(n,t,a,"in"===s||"not-in"===s);return os.create(i,s,o)}function vA(e,t,n){if(null!==e.startAt)throw new rR(r_.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rR(r_.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new oe(t,n)}function vD(e,t,n,r,i){if(!r)throw new rR(r_.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of oY(e))if(n.field.isKeyField())s.push(aV(t,r.key));else{let e=r.data.field(n.field);if(s8(e))throw new rR(r_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=n.field.canonicalString();throw new rR(r_.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new a6(s,i)}function vx(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new rR(r_.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new rR(r_.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!oQ(e)&&-1!==l.indexOf("/"))throw new rR(r_.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(rQ.fromString(l));if(!rX.isDocumentKey(n))throw new rR(r_.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new rX(n);o.push(aV(t,i))}else{let e=y8(n,r,l);o.push(e)}}return new a6(o,s)}function vN(e,t,n){if("string"==typeof(n=(0,d.m9)(n))){if(""===n)throw new rR(r_.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!oQ(t)&&-1!==n.indexOf("/"))throw new rR(r_.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(rQ.fromString(n));if(!rX.isDocumentKey(r))throw new rR(r_.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return aV(e,new rX(r))}if(n instanceof yO)return aV(e,n._key);throw new rR(r_.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mJ(n)}.`)}function vO(e,t){if(!Array.isArray(e)||0===e.length)throw new rR(r_.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function vM(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function vP(e,t){let n=vB(e.filters,vM(t.op));if(null!==n){if(n===t.op)throw new rR(r_.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);throw new rR(r_.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}}function vL(e,t){let n=e;for(let e of t.getFlattenedFilters())vP(n,e),n=o0(n,e)}function vB(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function vF(e){let t=e.filter(e=>e instanceof vT).length,n=e.filter(e=>e instanceof vb).length;if(t>1||t>0&&n>0)throw new rR(r_.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vj{convertValue(e,t="none"){switch(ap(e)){case 0:return null;case 1:return e.booleanValue;case 2:return s4(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(s3(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw rw()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return sj(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new yY(s4(e.latitude),s4(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=at(e);if(null==n)return null;return this.convertValue(n,t);case"estimate":return this.convertTimestamp(an(e));default:return null}}convertTimestamp(e){let t=s2(e);return new rK(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=rQ.fromString(e);rE(cF(n));let r=new as(n.get(1),n.get(3)),i=new rX(n.popFirst(5));return r.isEqual(t)||rS(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vU(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vV(e){return vz(e,["next","error","complete"])}function vz(e,t){if("object"!=typeof e||null===e)return!1;let n=e;for(let e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vq{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class vG extends vd{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new vK(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let n=this._document.data.field(vp("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class vK extends vG{data(e={}){return super.data(e)}}class v${constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new vq(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new vK(this._firestore,this._userDataWriter,n.key,n,new vq(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rR(r_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=vH(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function vH(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new vK(e._firestore,e._userDataWriter,n.doc.key,n.doc,new vq(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new vK(e._firestore,e._userDataWriter,t.doc.key,t.doc,new vq(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:vW(t.type),doc:r,oldIndex:i,newIndex:s}})}}function vW(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rw()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vQ(e){e=mZ(e,yO);let t=mZ(e.firestore,yV);return yd(yq(t),e._key).then(n=>v4(t,e,n))}class vY extends vj{constructor(e){super(),this.firestore=e}convertBytes(e){return new yH(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new yO(this.firestore,null,t)}}function vJ(e){e=mZ(e,yN);let t=mZ(e.firestore,yV),n=yq(t),r=new vY(t);return vg(e._query),yf(n,e._query).then(n=>new v$(t,r,e,n))}function vX(e,t,n,...r){let i;e=mZ(e,yO);let s=mZ(e.firestore,yV),a=y4(s);return v2(s,[(i="string"==typeof(t=(0,d.m9)(t))||t instanceof yW?y7(a,"updateDoc",e._key,t,n,r):y5(a,"updateDoc",e._key,t)).toMutation(e._key,lq.exists(!0))])}function vZ(e){return v2(mZ(e.firestore,yV),[new l9(e._key,lq.none())])}function v0(e,t){let n=mZ(e.firestore,yV),r=yL(e),i=vU(e.converter,t);return v2(n,[y3(y4(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,lq.exists(!1))]).then(()=>r)}function v1(e,...t){var n,r,i;let s,a,o;e=(0,d.m9)(e);let l={includeMetadataChanges:!1},u=0;"object"==typeof t[0]&&!vV(t[u])&&(l=t[u],u++);let c={includeMetadataChanges:l.includeMetadataChanges};if(vV(t[u])){let e=t[u];t[u]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[u+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[u+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}if(e instanceof yO)a=mZ(e.firestore,yV),o=oG(e._key.path),s={next:n=>{t[u]&&t[u](v4(a,e,n))},error:t[u+1],complete:t[u+2]};else{let n=mZ(e,yN);a=mZ(n.firestore,yV),o=n._query;let r=new vY(a);s={next:e=>{t[u]&&t[u](new v$(a,r,n,e))},error:t[u+1],complete:t[u+2]},vg(e._query)}return yh(yq(a),o,c,s)}function v2(e,t){return yp(yq(e),t)}function v4(e,t,n){let r=n.docs.get(t._key),i=new vY(e);return new vG(e,i,t._key,r,new vq(n.hasPendingWrites,n.fromCache),t.converter)}class v3{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new mq,this._offlineComponentProvider=new mz(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=y4(e)}set(e,t,n){this._verifyNotCommitted();let r=v9(e,this._firestore),i=vU(r.converter,t,n),s=y3(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,lq.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=v9(e,this._firestore);return i="string"==typeof(t=(0,d.m9)(t))||t instanceof yW?y7(this._dataReader,"WriteBatch.update",s._key,t,n,r):y5(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,lq.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=v9(e,this._firestore);return this._mutations=this._mutations.concat(new l9(t._key,lq.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new rR(r_.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function v9(e,t){if((e=(0,d.m9)(e)).firestore===t)return e;throw new rR(r_.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}function v5(){return new y9("serverTimestamp")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v7(e){return yq(e=mZ(e,yV)),new v6(e,t=>v2(e,t))}new WeakMap,/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yK("node")},69724:(e,t,n)=>{n.d(t,{v:()=>q});var r,i,s,a=n(3729),o=n(46070),l=n(84653),u=n(42107),c=n(70053),h=n(33783),d=n(3159),f=n(49824),p=n(63718),g=n(48027),m=n(9718),y=n(34857),v=n(61171),b=n(55696),S=n(11786),T=n(46138),C=n(11943),w=n(70621),E=n(14795),I=n(35113),_=((r=_||{})[r.Open=0]="Open",r[r.Closed=1]="Closed",r),R=((i=R||{})[i.Pointer=0]="Pointer",i[i.Other=1]="Other",i),k=((s=k||{})[s.OpenMenu=0]="OpenMenu",s[s.CloseMenu=1]="CloseMenu",s[s.GoToItem=2]="GoToItem",s[s.Search=3]="Search",s[s.ClearSearch=4]="ClearSearch",s[s.RegisterItem=5]="RegisterItem",s[s.UnregisterItem=6]="UnregisterItem",s);function A(e,t=e=>e){let n=null!==e.activeItemIndex?e.items[e.activeItemIndex]:null,r=(0,y.z2)(t(e.items.slice()),e=>e.dataRef.current.domRef.current),i=n?r.indexOf(n):null;return -1===i&&(i=null),{items:r,activeItemIndex:i}}let D={1:e=>1===e.menuState?e:{...e,activeItemIndex:null,menuState:1},0:e=>0===e.menuState?e:{...e,__demoMode:!1,menuState:0},2:(e,t)=>{var n;let r=A(e),i=(0,g.d)(t,{resolveItems:()=>r.items,resolveActiveIndex:()=>r.activeItemIndex,resolveId:e=>e.id,resolveDisabled:e=>e.dataRef.current.disabled});return{...e,...r,searchQuery:"",activeItemIndex:i,activationTrigger:null!=(n=t.trigger)?n:1}},3:(e,t)=>{let n=""!==e.searchQuery?0:1,r=e.searchQuery+t.value.toLowerCase(),i=(null!==e.activeItemIndex?e.items.slice(e.activeItemIndex+n).concat(e.items.slice(0,e.activeItemIndex+n)):e.items).find(e=>{var t;return(null==(t=e.dataRef.current.textValue)?void 0:t.startsWith(r))&&!e.dataRef.current.disabled}),s=i?e.items.indexOf(i):-1;return -1===s||s===e.activeItemIndex?{...e,searchQuery:r}:{...e,searchQuery:r,activeItemIndex:s,activationTrigger:1}},4:e=>""===e.searchQuery?e:{...e,searchQuery:"",searchActiveItemIndex:null},5:(e,t)=>{let n=A(e,e=>[...e,{id:t.id,dataRef:t.dataRef}]);return{...e,...n}},6:(e,t)=>{let n=A(e,e=>{let n=e.findIndex(e=>e.id===t.id);return -1!==n&&e.splice(n,1),e});return{...e,...n,activationTrigger:1}}},x=(0,a.createContext)(null);function N(e){let t=(0,a.useContext)(x);if(null===t){let t=Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,N),t}return t}function O(e,t){return(0,o.E)(t.type,D,e,t)}x.displayName="MenuContext";let M=a.Fragment;function P(e,t){let{__demoMode:n=!1,...r}=e,i=(0,a.useReducer)(O,{__demoMode:n,menuState:n?0:1,buttonRef:(0,a.createRef)(),itemsRef:(0,a.createRef)(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:s,itemsRef:u,buttonRef:c},h]=i,f=(0,d.T)(t);(0,v.O)([c,u],(e,t)=>{var n;h({type:1}),(0,y.sP)(t,y.tJ.Loose)||(e.preventDefault(),null==(n=c.current)||n.focus())},0===s);let p=(0,w.z)(()=>{h({type:1})}),g=(0,a.useMemo)(()=>({open:0===s,close:p}),[s,p]),m={ref:f};return a.createElement(x.Provider,{value:i},a.createElement(S.up,{value:(0,o.E)(s,{0:S.ZM.Open,1:S.ZM.Closed})},(0,l.sY)({ourProps:m,theirProps:r,slot:g,defaultTag:M,name:"Menu"})))}let L="button";function B(e,t){var n;let r=(0,f.M)(),{id:i=`headlessui-menu-button-${r}`,...s}=e,[o,u]=N("Menu.Button"),h=(0,d.T)(o.buttonRef,t),y=(0,c.G)(),v=(0,w.z)(e=>{switch(e.key){case p.R.Space:case p.R.Enter:case p.R.ArrowDown:e.preventDefault(),e.stopPropagation(),u({type:0}),y.nextFrame(()=>u({type:2,focus:g.T.First}));break;case p.R.ArrowUp:e.preventDefault(),e.stopPropagation(),u({type:0}),y.nextFrame(()=>u({type:2,focus:g.T.Last}))}}),b=(0,w.z)(e=>{e.key===p.R.Space&&e.preventDefault()}),S=(0,w.z)(t=>{if((0,m.P)(t.currentTarget))return t.preventDefault();e.disabled||(0===o.menuState?(u({type:1}),y.nextFrame(()=>{var e;return null==(e=o.buttonRef.current)?void 0:e.focus({preventScroll:!0})})):(t.preventDefault(),u({type:0})))}),C=(0,a.useMemo)(()=>({open:0===o.menuState}),[o]),E={ref:h,id:i,type:(0,T.f)(e,o.buttonRef),"aria-haspopup":"menu","aria-controls":null==(n=o.itemsRef.current)?void 0:n.id,"aria-expanded":0===o.menuState,onKeyDown:v,onKeyUp:b,onClick:S};return(0,l.sY)({ourProps:E,theirProps:s,slot:C,defaultTag:L,name:"Menu.Button"})}let F="div",j=l.AN.RenderStrategy|l.AN.Static;function U(e,t){var n,r;let i=(0,f.M)(),{id:s=`headlessui-menu-items-${i}`,...o}=e,[h,m]=N("Menu.Items"),v=(0,d.T)(h.itemsRef,t),T=(0,C.i)(h.itemsRef),E=(0,c.G)(),I=(0,S.oJ)(),_=null!==I?(I&S.ZM.Open)===S.ZM.Open:0===h.menuState;(0,a.useEffect)(()=>{let e=h.itemsRef.current;e&&0===h.menuState&&e!==(null==T?void 0:T.activeElement)&&e.focus({preventScroll:!0})},[h.menuState,h.itemsRef,T]),(0,b.B)({container:h.itemsRef.current,enabled:0===h.menuState,accept:e=>"menuitem"===e.getAttribute("role")?NodeFilter.FILTER_REJECT:e.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT,walk(e){e.setAttribute("role","none")}});let R=(0,w.z)(e=>{var t,n;switch(E.dispose(),e.key){case p.R.Space:if(""!==h.searchQuery)return e.preventDefault(),e.stopPropagation(),m({type:3,value:e.key});case p.R.Enter:if(e.preventDefault(),e.stopPropagation(),m({type:1}),null!==h.activeItemIndex){let{dataRef:e}=h.items[h.activeItemIndex];null==(n=null==(t=e.current)?void 0:t.domRef.current)||n.click()}(0,y.wI)(h.buttonRef.current);break;case p.R.ArrowDown:return e.preventDefault(),e.stopPropagation(),m({type:2,focus:g.T.Next});case p.R.ArrowUp:return e.preventDefault(),e.stopPropagation(),m({type:2,focus:g.T.Previous});case p.R.Home:case p.R.PageUp:return e.preventDefault(),e.stopPropagation(),m({type:2,focus:g.T.First});case p.R.End:case p.R.PageDown:return e.preventDefault(),e.stopPropagation(),m({type:2,focus:g.T.Last});case p.R.Escape:e.preventDefault(),e.stopPropagation(),m({type:1}),(0,u.k)().nextFrame(()=>{var e;return null==(e=h.buttonRef.current)?void 0:e.focus({preventScroll:!0})});break;case p.R.Tab:e.preventDefault(),e.stopPropagation(),m({type:1}),(0,u.k)().nextFrame(()=>{(0,y.EO)(h.buttonRef.current,e.shiftKey?y.TO.Previous:y.TO.Next)});break;default:1===e.key.length&&(m({type:3,value:e.key}),E.setTimeout(()=>m({type:4}),350))}}),k=(0,w.z)(e=>{e.key===p.R.Space&&e.preventDefault()}),A=(0,a.useMemo)(()=>({open:0===h.menuState}),[h]),D={"aria-activedescendant":null===h.activeItemIndex||null==(n=h.items[h.activeItemIndex])?void 0:n.id,"aria-labelledby":null==(r=h.buttonRef.current)?void 0:r.id,id:s,onKeyDown:R,onKeyUp:k,role:"menu",tabIndex:0,ref:v};return(0,l.sY)({ourProps:D,theirProps:o,slot:A,defaultTag:F,features:j,visible:_,name:"Menu.Items"})}let V=a.Fragment;function z(e,t){let n=(0,f.M)(),{id:r=`headlessui-menu-item-${n}`,disabled:i=!1,...s}=e,[o,c]=N("Menu.Item"),p=null!==o.activeItemIndex&&o.items[o.activeItemIndex].id===r,m=(0,a.useRef)(null),v=(0,d.T)(t,m);(0,h.e)(()=>{if(o.__demoMode||0!==o.menuState||!p||0===o.activationTrigger)return;let e=(0,u.k)();return e.requestAnimationFrame(()=>{var e,t;null==(t=null==(e=m.current)?void 0:e.scrollIntoView)||t.call(e,{block:"nearest"})}),e.dispose},[o.__demoMode,m,p,o.menuState,o.activationTrigger,o.activeItemIndex]);let b=(0,I.x)(m),S=(0,a.useRef)({disabled:i,domRef:m,get textValue(){return b()}});(0,h.e)(()=>{S.current.disabled=i},[S,i]),(0,h.e)(()=>(c({type:5,id:r,dataRef:S}),()=>c({type:6,id:r})),[S,r]);let T=(0,w.z)(()=>{c({type:1})}),C=(0,w.z)(e=>{if(i)return e.preventDefault();c({type:1}),(0,y.wI)(o.buttonRef.current)}),_=(0,w.z)(()=>{if(i)return c({type:2,focus:g.T.Nothing});c({type:2,focus:g.T.Specific,id:r})}),R=(0,E.g)(),k=(0,w.z)(e=>R.update(e)),A=(0,w.z)(e=>{R.wasMoved(e)&&(i||p||c({type:2,focus:g.T.Specific,id:r,trigger:0}))}),D=(0,w.z)(e=>{R.wasMoved(e)&&(i||p&&c({type:2,focus:g.T.Nothing}))}),x=(0,a.useMemo)(()=>({active:p,disabled:i,close:T}),[p,i,T]);return(0,l.sY)({ourProps:{id:r,ref:v,role:"menuitem",tabIndex:!0===i?void 0:-1,"aria-disabled":!0===i||void 0,disabled:void 0,onClick:C,onFocus:_,onPointerEnter:k,onMouseEnter:k,onPointerMove:A,onMouseMove:A,onPointerLeave:D,onMouseLeave:D},theirProps:s,slot:x,defaultTag:V,name:"Menu.Item"})}let q=Object.assign((0,l.yV)(P),{Button:(0,l.yV)(B),Items:(0,l.yV)(U),Item:(0,l.yV)(z)})},35113:(e,t,n)=>{n.d(t,{x:()=>l});var r=n(3729);let i=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function s(e){var t,n;let r=null!=(t=e.innerText)?t:"",s=e.cloneNode(!0);if(!(s instanceof HTMLElement))return r;let a=!1;for(let e of s.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))e.remove(),a=!0;let o=a?null!=(n=s.innerText)?n:"":r;return i.test(o)&&(o=o.replace(i,"")),o}function a(e){let t=e.getAttribute("aria-label");if("string"==typeof t)return t.trim();let n=e.getAttribute("aria-labelledby");if(n){let e=n.split(" ").map(e=>{let t=document.getElementById(e);if(t){let e=t.getAttribute("aria-label");return"string"==typeof e?e.trim():s(t).trim()}return null}).filter(Boolean);if(e.length>0)return e.join(", ")}return s(e).trim()}var o=n(70621);function l(e){let t=(0,r.useRef)(""),n=(0,r.useRef)("");return(0,o.z)(()=>{let r=e.current;if(!r)return"";let i=r.innerText;if(t.current===i)return n.current;let s=a(r).trim().toLowerCase();return t.current=i,n.current=s,s})}},14795:(e,t,n)=>{n.d(t,{g:()=>s});var r=n(3729);function i(e){return[e.screenX,e.screenY]}function s(){let e=(0,r.useRef)([-1,-1]);return{wasMoved(t){let n=i(t);return(e.current[0]!==n[0]||e.current[1]!==n[1])&&(e.current=n,!0)},update(t){e.current=i(t)}}}},55696:(e,t,n)=>{n.d(t,{B:()=>a});var r=n(3729),i=n(33783),s=n(51264);function a({container:e,accept:t,walk:n,enabled:a=!0}){let o=(0,r.useRef)(t),l=(0,r.useRef)(n);(0,r.useEffect)(()=>{o.current=t,l.current=n},[t,n]),(0,i.e)(()=>{if(!e||!a)return;let t=(0,s.r)(e);if(!t)return;let n=o.current,r=l.current,i=Object.assign(e=>n(e),{acceptNode:n}),u=t.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,i,!1);for(;u.nextNode();)r(u.currentNode)},[e,a,o,l])}},48027:(e,t,n)=>{function r(e){throw Error("Unexpected object: "+e)}n.d(t,{T:()=>s,d:()=>a});var i,s=((i=s||{})[i.First=0]="First",i[i.Previous=1]="Previous",i[i.Next=2]="Next",i[i.Last=3]="Last",i[i.Specific=4]="Specific",i[i.Nothing=5]="Nothing",i);function a(e,t){let n=t.resolveItems();if(n.length<=0)return null;let i=t.resolveActiveIndex(),s=null!=i?i:-1,a=(()=>{switch(e.focus){case 0:return n.findIndex(e=>!t.resolveDisabled(e));case 1:{let e=n.slice().reverse().findIndex((e,n,r)=>(-1===s||!(r.length-n-1>=s))&&!t.resolveDisabled(e));return -1===e?e:n.length-1-e}case 2:return n.findIndex((e,n)=>!(n<=s)&&!t.resolveDisabled(e));case 3:{let e=n.slice().reverse().findIndex(e=>!t.resolveDisabled(e));return -1===e?e:n.length-1-e}case 4:return n.findIndex(n=>t.resolveId(n)===e.id);case 5:return null;default:r(e)}})();return -1===a?i:a}},29127:(e,t,n)=>{n.d(t,{Bt:()=>r.Bt,IO:()=>r.IO,JU:()=>r.JU,PL:()=>r.PL,QT:()=>r.QT,Xo:()=>r.Xo,ad:()=>r.ad,ar:()=>r.ar,cf:()=>r.cf,hJ:()=>r.hJ,oe:()=>r.oe,qs:()=>r.qs});var r=n(83289)},81513:e=>{e.exports={i8:"1.9.7"}},56541:e=>{e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},89987:e=>{e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"FileDescriptorSet":{"fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}}},"FileDescriptorProto":{"fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10,"options":{"packed":false}},"weakDependency":{"rule":"repeated","type":"int32","id":11,"options":{"packed":false}},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12}}},"DescriptorProto":{"fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"FieldDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REQUIRED":2,"LABEL_REPEATED":3}}}},"OneofDescriptorProto":{"fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3}}},"EnumValueDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[8,8]]},"FieldOptions":{"fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}}}},"OneofOptions":{"fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumValueOptions":{"fields":{"deprecated":{"type":"bool","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"UninterpretedOption":{"fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"SourceCodeInfo":{"fields":{"location":{"rule":"repeated","type":"Location","id":1}},"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"span":{"rule":"repeated","type":"int32","id":2},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4}}}}}}}}}}}')},57674:e=>{e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},73795:e=>{e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};